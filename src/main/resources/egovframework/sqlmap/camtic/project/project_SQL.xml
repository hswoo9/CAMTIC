<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project">

    <select id="getProjectList" parameterType="map" resultType="map">
        SELECT * FROM CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN CAM_PJT_MNG.DJ_PJT_ENGN B
        ON A.PJT_SN = B.PJT_SN AND B.ACTIVE = "Y"
        WHERE
            1=1
        <if test='busnSubClass != null and busnSubClass != "" and !"Y".equals(busnSubClass)'>
        AND
            A.PJT_STEP = #{busnSubClass}
        AND
            A.PJT_STOP = "N"
        </if>
        <if test='busnSubClass == "Y" or "Y".equals(busnSubClass)'>
        AND
            A.PJT_STOP = "Y"
        </if>
    </select>

    <select id="getProjectStep" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_ENGN B
            ON
                A.PJT_SN = B.PJT_SN AND B.ACTIVE = "Y"
        LEFT JOIN
            CAM_INSIDE.DJ_HR_BIZ_REQ_RESULT C
            ON
                A.PJT_SN = C.PJT_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_INFO D
            ON
                A.CRM_SN = D.CRM_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_MEM CM
        ON
            D.CRM_SN = CM.CRM_SN AND CM.CRM_MEM_SN = A.CRM_MEM_SN
        WHERE
            A.PJT_SN = #{pjtSn}
    </select>

    <insert id="insProject" parameterType="map">
        /* insProject >> 프로젝트 엔지니어링 최초 등록 */
        INSERT INTO CAM_PJT_MNG.DJ_PROJECT
        (
            PJT_NM,
            EMP_SEQ,
            EMP_NAME,
            DEPT_SEQ,
            DEPT_NAME,
            BUSN_CLASS,
            BUSN_NM,
            PJT_STEP,
            PJT_STEP_NM,
            CONSULT_DT
        ) VALUES (
            #{pjtNm},
            #{empSeq},
            #{empName},
            #{deptSeq},
            #{deptName},
            #{busnClass},
            #{busnNm},
            #{pjtStep},
            #{pjtStepNm},
            #{contDt}
        )
        <selectKey keyProperty="PJT_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PROJECT'
        </selectKey>
    </insert>

    <insert id="insPjtEngn" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_ENGN
        (
            PJT_SN,
            CONT_DT,
            EXP_AMT,
            CONT_LOC,
            STEP1,
            REG_EMP_SEQ
        ) VALUES
        (
            #{PJT_SN},
            #{contDt},
            #{expAmt},
            #{contLoc},
            'R',
            #{empSeq}
        )
        <selectKey keyProperty="ENGN_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_ENGN'
        </selectKey>
    </insert>

    <delete id="delProject" parameterType="map">
        DELETE FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = #{pjtSn}
    </delete>

    <select id="getProjectData" parameterType="map" resultType="map">
        SELECT
            A.*,
            B.*,
            C.*,
            D.*,
            CM.*,
            EI.DEPT_NAME,
            EI.EMP_NAME_KR,
            EI.POSITION_NAME,
            DATE_FORMAT(STR_DT, '%Y-%m-%d') AS PJT_START_DT,
            DATE_FORMAT(END_EXP_DT, '%Y-%m-%d') AS PJT_END_DT
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_ENGN B
        ON
            A.PJT_SN = B.PJT_SN AND B.ACTIVE = "Y"
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_DELV DE
        ON
            A.PJT_SN = DE.PJT_SN
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO EI
        ON
            DE.PM_EMP_SEQ = EI.EMP_SEQ
        LEFT JOIN
            CAM_INSIDE.DJ_HR_BIZ_REQ_RESULT C
        ON
            A.PJT_SN = C.PJT_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_INFO D
        ON
            A.CRM_SN = D.CRM_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_MEM CM
        ON
            A.CRM_MEM_SN = CM.CRM_MEM_SN
        WHERE
            A.PJT_SN = #{pjtSn}
    </select>

    <insert id="insEngnEstInfo" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_EST
        (
            PJT_SN,
            EST_DE,
            EST_NM,
            CRM_NM,
            CRM_MEM,
            VAT,
            EST_TOT_AMT,
            EST_ISS,
            REG_EMP_SEQ
        ) VALUES
        (
            #{pjtSn},
            #{estDe},
            #{estNm},
            #{crmNm},
            #{crmMem},
            #{vat},
            #{estTotAmt},
            #{estIss},
            #{regEmpSeq}
        )

        <selectKey keyProperty="EST_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_EST'
        </selectKey>
    </insert>

    <insert id="insEngnEstSub" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_EST_SUB
        (
            EST_SN,
            PROD_NM,
            PROD_CNT,
            UNIT,
            UNIT_AMT,
            SUP_AMT,
            ETC
        ) VALUES
        (
            #{estSn},
            #{prodNm},
            #{prodCnt},
            #{unit},
            #{unitAmt},
            #{supAmt},
            #{etc}
        )
    </insert>

    <update id="updEstInfo" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_EST
        SET
            EST_TOT_AMT = #{goodsTotAmt}
        WHERE
            EST_SN = #{estSn}
    </update>

    <update id="updProjectStep" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_STEP = #{pjtStep},
            PJT_STEP_NM = #{pjtStepNm}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updProjectEngnStep" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_ENGN
        SET
            MOD_DT = sysdate(),
            MOD_EMP_SEQ = #{regEmpSeq},
            <choose>
                <when test="step == 2">STEP2 = 'Y', STEP3 = 'R'</when>
                <when test="step == 3">STEP3 = 'Y', STEP4 = 'R'</when>
                <when test="step == 4">STEP4 = 'Y', STEP5 = 'R'</when>
                <when test="step == 5">STEP5 = 'Y', STEP6 = 'R'</when>
                <when test="step == 6">STEP6 = 'Y', STEP7 = 'R'</when>
                <when test="step == 7">STEP7 = 'Y', STEP8 = 'R'</when>
                <when test="step == 8">STEP8 = 'Y'</when>
                <otherwise>PJT_SN = #{pjtSn}</otherwise>
            </choose>
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <select id="getStep1EstList" parameterType="map" resultType="map">
        SELECT
            A.*,
            (SELECT EMP_NAME_KR from CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = 1) AS EMP_NAME,
            (SELECT COUNT(*) FROM CAM_PJT_MNG.DJ_PJT_EST_SUB WHERE EST_SN = A.EST_SN) AS CNT,
            (SELECT SUM(SUP_AMT) FROM CAM_PJT_MNG.DJ_PJT_EST_SUB WHERE EST_SN = A.EST_SN) AS SUM_AMT
        FROM
            CAM_PJT_MNG.DJ_PJT_EST A
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <select id="getEstSubList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_EST_SUB
        WHERE
            EST_SN = #{estSn}
    </select>

    <select id="getEstData" parameterType="map" resultType="map">
        SELECT
            A.*,
            (SELECT EMP_NAME_KR from CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = 1) AS EMP_NAME
        FROM
            CAM_PJT_MNG.DJ_PJT_EST A
        WHERE
            PJT_SN = #{pjtSn}
        ORDER BY EST_SN DESC LIMIT 1
    </select>

    <delete id="delEstSub" parameterType="map">
        DELETE FROM CAM_PJT_MNG.DJ_PJT_EST_SUB
        WHERE
            EST_SN = #{estSn}
    </delete>
    <insert id="insStep2" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_DELV
        (
            PJT_SN,
            DELV_DE,
            DELV_SUMR,
            DELV_SPEC,
            DELV_ITEM,
            DELV_CNT,
            DELV_UNIT,
            DELV_LOC,
            DELV_MEAN,
            DELV_ASSU,
            DELV_TEST,
            DELV_AMT,
            DELV_DEPT,
            PM_EMP_SEQ,
            PM_EMP_NM,
            REG_EMP_SEQ
        ) VALUES
        (
            #{pjtSn},
            #{delvDe},
            #{delvSumr},
            #{delvSpec},
            #{delvItem},
            #{delvCnt},
            #{delvUnit},
            #{delvLoc},
            #{delvMean},
            #{delvAssu},
            #{delvTest},
            #{delvAmt},
            #{delvDept},
            #{pmEmpSeq},
            #{pmEmpNm},
            #{regEmpSeq}
        )
        <selectKey keyProperty="DELV_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_DELV'
        </selectKey>
    </insert>

    <insert id="insStep3" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_DEV
        (
            PJT_SN,
            INV_AMT,
            INV_PER,
            DEP_OBJ,
            ETC,
            REG_EMP_SEQ
        ) VALUES
        (
            #{pjtSn},
            #{invAmt},
            #{invPer},
            #{depObj},
            #{etc},
            #{regEmpSeq}
        )
    </insert>

    <insert id="insStep4" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_PS_FILE
        (
            PJT_SN
        )
        VALUES
        (
            #{pjtSn}
        )
    </insert>

    <select id="checkModStep4" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM CAM_PJT_MNG.DJ_PJT_PS_FILE
        WHERE PJT_SN = #{pjtSn}
    </select>

    <!--DUPLICATE-->
    <update id="updProjectDelv" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_AMT = #{delvAmt},
            STR_DT = #{estDe},
            END_EXP_DT = #{delvDe},
            PM = #{pmEmpNm},
            PJT_TMP_CD = #{pjtTmpCd}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <!-- DUPLICATE -->
    <update id="updProjectDelvFn" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_CD = #{pjtCd}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <select id="checkProjectCode" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PROJECT
        WHERE
            PJT_SN = #{pjtSn}
        AND
            PJT_CD IS NOT NULL
    </select>

    <select id="getDelvData" parameterType="map" resultType="map">
        SELECT
            A.*,
            B.DEPT_NAME,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD,
            A.STATUS AS DELV_STATUS
        FROM
            CAM_PJT_MNG.DJ_PJT_DELV A
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO B ON A.PM_EMP_SEQ = B.EMP_SEQ
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON A.DOC_ID = DI.DOC_ID
        WHERE
            PJT_SN = #{pjtSn} ORDER BY DELV_SN DESC LIMIT 1
    </select>

    <select id="getDelvFile" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_NO = #{DELV_FILE_SN}
    </select>

    <select id="getDevFile" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_NO = #{DEV_FILE_SN}
    </select>

    <select id="getEstFile" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_NO = #{EST_FILE_SN}
    </select>

    <select id="groupCodeList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_CD
        GROUP BY GRP_SN
    </select>

    <insert id="insGroupCode" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_CD
        (
            GRP_SN,
            GRP_NM
        )
        VALUES
        (
            #{grpSn},
            #{grpNm}
        )
    </insert>

    <select id="codeList" resultType="map" parameterType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_CD
        WHERE
            LG_CD IS NOT NULL
        AND
            PJT_CD IS NULL
    </select>

    <select id="selLgCode" resultType="map" parameterType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_CD
        WHERE
            GRP_SN = #{grpSn}
        AND
            LG_CD is not null
        AND
            PJT_CD is null
    </select>

    <select id="selSmCode" resultType="map" parameterType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_CD
        WHERE
            GRP_SN = #{grpSn}
          AND
            LG_CD is not null
          AND
            LG_CD = #{lgCd}
          AND
            PJT_CD is not null
    </select>

    <insert id="insSetLgCode" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_CD
        (
            GRP_SN,
            GRP_NM,
            LG_CD,
            LG_CD_NM
        )
        VALUES
        (
            #{grpSn},
            #{grpNm},
            #{lgCode},
            #{lgCodeNm}
        )
    </insert>

    <select id="smCodeList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_CD
        WHERE
            GRP_SN = #{grpSn}
        AND
            LG_CD = #{lgCd}
        AND
            PJT_CD IS NOT NULL
    </select>

    <insert id="insPjtCode" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_CD
        (
            GRP_SN,
            GRP_NM,
            LG_CD,
            LG_CD_NM,
            PJT_CD,
            PJT_CD_NM
        )
        VALUES
        (
            #{grpSn},
            #{grpNm},
            #{lgCd},
            #{lgCdNm},
            #{pjtCd},
            #{pjtCdNm}
        )
    </insert>

    <select id="cntProjectCode" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PROJECT
        WHERE
            PJT_TMP_CD = #{pjtTmpCd}
    </select>

    <select id="checkModStep1" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PJT_EST
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <select id="checkModStep2" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PJT_DELV
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <select id="checkModStep3" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PJT_DEV
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <select id="checkAddVersion" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PJT_DEV
        WHERE
            PJT_SN = #{pjtSn}
        AND
            STATUS = 0
    </select>

    <select id="getDevPjtVerList" parameterType="map" resultType="map">
        /*getDevPjtVerList*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN
            (SELECT *
             FROM
                 CAM_PJT_MNG.DJ_PJT_EST
             WHERE PJT_SN = #{pjtSn} ORDER BY EST_SN DESC LIMIT 1) B
            ON
                A.PJT_SN = B.PJT_SN
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_DEV C
        ON
            A.PJT_SN = C.PJT_SN
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON C.DOC_ID = DI.DOC_ID
        WHERE
            A.PJT_SN = #{pjtSn}
    </select>

    <select id="getStep3PmInfo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_HR.DJ_EMP_INFO
        WHERE
            EMP_SEQ = #{PM_EMP_SEQ}
    </select>

    <insert id="insPjtPs" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_PS
        (
            PJT_SN,
            PS_ROW,
            PS_PREP,
            PS_PREP_NM,
            PS_NM,
            PS_STR_DE,
            PS_END_DE,
            PS_EMP_SEQ,
            PS_EMP_NM,
            REG_EMP_SEQ
        ) VALUES
        (
            #{pjtSn},
            #{psRow},
            #{psPrep},
            #{psPrepNm},
            #{psNm},
            #{psStrDe},
            #{psEndDe},
            #{psEmpSeq},
            #{psEmpNm},
            #{regEmpSeq}
        )
        <selectKey keyProperty="PS_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_PS'
        </selectKey>
    </insert>

    <select id="getProcessList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_PS
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <update id="updProcess" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_PS
        SET
            PS_ROW = #{psRow},
            PS_PREP = #{psPrep},
            PS_PREP_NM = #{psPrepNm},
            PS_NM = #{psNm},
            PS_STR_DE = #{psStrDe},
            PS_END_DE = #{psEndDe},
            PS_EMP_NM = #{psEmpNm}
        WHERE
            PS_SN = #{psSn}
    </update>

    <delete id="delProcess" parameterType="map">
        DELETE FROM CAM_PJT_MNG.DJ_PJT_PS
        WHERE
            PS_SN = #{psSn}
    </delete>

    <insert id="insInvData" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_INV
        (
            PJT_SN,
            INV_ROW,
            DIV_CD,
            DIV_NM,
            INV_NM,
            INV_CNT,
            INV_UNIT,
            EST_TOT_AMT,
            EST_OFC,
            INV_ETC,
            REG_EMP_SEQ
        ) VALUES
        (
            #{pjtSn},
            #{invRow},
            #{divCd},
            #{divNm},
            #{invNm},
            #{invCnt},
            #{invUnit},
            #{estTotAmt},
            #{estOfc},
            #{invEtc},
            #{regEmpSeq}
        )
        <selectKey keyProperty="INV_SN" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_INV'
        </selectKey>
    </insert>

    <select id="getInvList" parameterType="map" resultType="map">
        SELECT * FROM
            CAM_PJT_MNG.DJ_PJT_INV
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <update id="updInvest" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_INV
        SET
            PJT_SN = #{pjtSn},
            INV_ROW = #{invRow},
            DIV_CD = #{divCd},
            DIV_NM = #{divNm},
            INV_NM = #{invNm},
            INV_CNT = #{invCnt},
            INV_UNIT = #{invUnit},
            EST_TOT_AMT = #{estTotAmt},
            EST_OFC = #{estOfc},
            INV_ETC = #{invEtc}
        WHERE
            INV_SN = #{invSn}
    </update>

    <delete id="delInvest" parameterType="map">
        DELETE FROM CAM_PJT_MNG.DJ_PJT_INV
        WHERE
            INV_SN = #{invSn}
    </delete>

    <select id="getDevelopPlan" parameterType="map" resultType="map">
        SELECT * FROM CAM_PJT_MNG.DJ_PJT_DEV
        WHERE PJT_SN = #{pjtSn}
        ORDER BY DEV_SN DESC LIMIT 1
    </select>

    <select id="getPjtSnToDev" parameterType="map" resultType="map">
        SELECT PJT_SN FROM CAM_PJT_MNG.DJ_PJT_DEV
        WHERE DEV_SN = #{devSn}
    </select>

    <select id="getPsList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_PS A
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_PS_FILE B
        ON
            A.PJT_SN = B.PJT_SN
        WHERE
            A.PJT_SN = #{pjtSn}
    </select>

    <select id="getPsFile1" parameterType="map" resultType="map">
        /*getPsFile1*/
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_CD = "engnPsFile1"
        AND
            CONTENT_ID = #{psFileSn}
    </select>

    <select id="getPsFile2" parameterType="map" resultType="map">
        /*getPsFile2*/
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_CD = "engnPsFile2"
          AND
            CONTENT_ID = #{psFileSn}
    </select>

    <select id="getPsFile3" parameterType="map" resultType="map">
        /*getPsFile3*/
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_CD = "engnPsFile3"
          AND
            CONTENT_ID = #{psFileSn}
    </select>

    <update id="updStep5" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            DELV_DE = #{delvDe},
            PJT_AMT = #{estTotAmt}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updStepEst5" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_EST
        SET
            EST_ISS = #{estIss},
            EST_TOT_AMT = #{estTotAmt}
        WHERE
            EST_SN = #{estSn}
    </update>

    <delete id="delStepEstSub5" parameterType="map">
        DELETE FROM CAM_PJT_MNG.DJ_PJT_EST_SUB
        WHERE EST_SN = #{estSn}
    </delete>

    <select id="checkDelvStat" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_PJT_MNG.DJ_PROJECT
        WHERE
            PJT_SN = #{pjtSn} AND DELV_STAT = 'Y'
    </select>

    <update id="updEngnCrmInfo" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            CRM_SN = #{crmSn},
            CRM_MEM_SN = #{crmMemSn}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updProject" parameterType="map">
        /* updProject */
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_STEP = #{step}
        WHERE
            PJT_SN = #{pjtSn}
        AND
        <![CDATA[
            PJT_STEP < #{step}
        ]]>
    </update>

    <update id="updEngn" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PJT_ENGN
        SET
            ${stepColumn} = #{stepValue},
            ${nextStepColumn} = #{nextStepValue},
            MOD_DT = now()
        WHERE
            ENGN_SN = #{engnSn} AND ${stepColumn} = 'N'
    </update>

    <update id="updateDelvApprStat" parameterType="map">
        /* updateDelvApprStat */
        UPDATE CAM_PJT_MNG.DJ_PJT_DELV
        SET
            STATUS = #{approveStatCode},
            DOC_ID = #{docId}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updateDelvFinalApprStat" parameterType="map">
        /* updateDelvFinalApprStat */
        UPDATE CAM_PJT_MNG.DJ_PJT_DELV
        SET
            STATUS = #{approveStatCode},
            APPROVAL_DATE = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            APPROVAL_EMP_SEQ = #{empSeq}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updateDevApprStat" parameterType="map">
        /* updateDevApprStat */
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            STATUS = #{approveStatCode},
            DOC_ID = #{docId}
        WHERE
            DEV_SN = #{devSn}
    </update>

    <update id="updateDevFinalApprStat" parameterType="map">
        /* updateDevFinalApprStat */
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            STATUS = #{approveStatCode},
            APPROVAL_DATE = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            APPROVAL_EMP_SEQ = #{empSeq}
        WHERE
            DEV_SN = #{devSn}
    </update>

    <select id="getCrmInfo" parameterType="map" resultType="map">
        /*getCrmInfo*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PROJECT DP
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_ENGN PE
        ON
            DP.PJT_SN = PE.PJT_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_INFO CI
        ON
            DP.CRM_SN = CI.CRM_SN
        LEFT JOIN
            CAM_CRM.DJ_CRM_MEM DM
        ON
            DP.CRM_MEM_SN = DM.CRM_MEM_SN
        WHERE
            DP.PJT_SN = #{pjtSn}
    </select>

    <select id="getBustInfo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HR_BIZ_REQ_RESULT HR
        LEFT JOIN
            CAM_INSIDE.DJ_HR_BIZ_REQ HRQ
        ON
            HR.HR_BIZ_REQ_ID = HRQ.HR_BIZ_REQ_ID
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <insert id="insDelvInfo" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_DELV
            (
                PJT_SN,
                DELV_DE,
                DELV_ISSU,
                DELV_ITEM,
                DELV_CNT,
                DELV_UNIT,
                DELV_LOC,
                DELV_AMT,
                DELV_DEPT,
                PM_EMP_SEQ,
                PM_EMP_NM,
                PJT_STR_DT,
                PJT_END_DT,
                DELV_PAY,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{pjtSn},
                #{delvDe},
                #{delvIssu},
                #{delvItem},
                #{delvCnt},
                #{delvUnit},
                #{delvLoc},
                #{delvAmt},
                #{delvDept},
                #{pmEmpSeq},
                #{pmEmpNm},
                #{pjtStrDt},
                #{pjtEndDt},
                #{delvPay},
                #{empSeq}
            )

        <selectKey keyProperty="delvSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_DELV'
        </selectKey>

    </insert>

    <update id="updDelvInfo" parameterType="map">
        /*updDelvInfo*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DELV
        SET
            DELV_DE = #{delvDe},
            DELV_ISSU = #{delvIssu},
            DELV_ITEM = #{delvItem},
            DELV_CNT = #{delvCnt},
            DELV_UNIT = #{delvUnit},
            DELV_LOC = #{delvLoc},
            DELV_AMT = #{delvAmt},
            DELV_DEPT = #{delvDept},
            PM_EMP_SEQ = #{pmEmpSeq},
            PM_EMP_NM = #{pmEmpNm},
            PJT_STR_DT = #{pjtStrDt},
            PJT_END_DT = #{pjtEndDt},
            DELV_PAY = #{delvPay},
            MOD_EMP_SEQ = #{empSeq}
        WHERE
            DELV_SN = #{delvSn}
    </update>

    <insert id="insDevInfo" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_DEV
            (
                PJT_SN,
                INV_AMT,
                INV_PER,
                DEP_OBJ,
                ETC,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{pjtSn},
                #{invAmt},
                #{invPer},
                #{depObj},
                #{etc},
                #{regEmpSeq}
            )
        <selectKey keyProperty="devSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_DEV'
        </selectKey>
    </insert>

    <update id="updDevInfo" parameterType="map">
        /*updDevInfo*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            INV_AMT = #{invAmt},
            INV_PER = #{invPer},
            DEP_OBJ = #{depObj},
            ETC = #{etc},
            MOD_EMP_SEQ = #{regEmpSeq}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updProjectTmpCode" parameterType="map">
        /*updProjectTmpCode*/
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_AMT = #{delvAmt},
            PJT_TMP_CD = #{pjtTmpCd},
            DELV_STAT = 'Y',
            STR_DT = #{estDe},
            END_EXP_DT = #{delvDe},
            PM = #{pmEmpNm}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updateProjectCode" parameterType="map">
        /*updateProjectCode*/
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_CD = PJT_TMP_CD
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <update id="updInv" parameterType="map">
        /*updInv*/
        UPDATE CAM_PJT_MNG.DJ_PJT_INV
        SET
            DEV_SN = #{devSn}
        WHERE
            PJT_SN = #{pjtSn} AND DEV_SN IS NULL
    </update>

    <update id="updPs" parameterType="map">
        /*updPs*/
        UPDATE CAM_PJT_MNG.DJ_PJT_PS
        SET
            DEV_SN = #{devSn}
        WHERE
            PJT_SN = #{pjtSn} AND DEV_SN IS NULL
    </update>

    <select id="getDevData" parameterType="map" resultType="map">
        /*getDevData*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_DEV
        WHERE
            PJT_SN = #{pjtSn}
        ORDER BY DEV_SN DESC LIMIT 1
    </select>

    <update id="stopProject" parameterType="map">
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            PJT_STOP = "Y",
            PJT_STOP_RS = #{pjtStopRs}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <select id="getPsPrepInfo" parameterType="map" resultType="map">
        /*getPsPrepInfo*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PJT_PS_FILE
        WHERE
            PJT_SN = #{pjtSn}
    </select>

    <insert id="insPsPrepInfo" parameterType="map">
        /*insPsPrepInfo*/
        INSERT INTO CAM_PJT_MNG.DJ_PJT_PS_FILE
            (
                PJT_SN,
                FILE_ETC1,
                FILE_ETC2,
                FILE_ETC3
            )
        VALUES
            (
                #{pjtSn},
                #{fileEtc1},
                #{fileEtc2},
                #{fileEtc3}
            )

        <selectKey keyProperty="psFileSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_PS_FILE'
        </selectKey>
    </insert>

    <insert id="updPsPrepInfo" parameterType="map">
        /*updPsPrepInfo*/
        UPDATE CAM_PJT_MNG.DJ_PJT_PS_FILE
        SET
            FILE_ETC1 = #{fileEtc1},
            FILE_ETC2 = #{fileEtc2},
            FILE_ETC3 = #{fileEtc3}
        WHERE
            PS_FILE_SN = #{psFileSn}
    </insert>

    <update id="updGoodInfo" parameterType="map">
        /*updGoodInfo*/
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            DELV_DE = #{delvDe},
            GOODS_ISS = #{goodsIss}
        WHERE
            PJT_SN = #{pjtSn}
    </update>

    <select id="getResultInfo" parameterType="map" resultType="map">
        /*getResultInfo*/
        SELECT
            A.*,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD
        FROM
            CAM_PJT_MNG.DJ_PJT_RESULT A
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON A.DOC_ID = DI.DOC_ID
        WHERE
            A.PJT_SN = #{pjtSn}
    </select>

    <insert id="insResultInfo" parameterType="map">
        INSERT INTO CAM_PJT_MNG.DJ_PJT_RESULT
            (
                PJT_SN,
                PROTOTYPE,
                SUP_CONT,
                RS_ISS,
                RS_ETC,
                RS_STR_DT,
                RS_END_DT,
                RS_ACT_EQUIP,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{pjtSn},
                #{prototype},
                #{supCont},
                #{rsIss},
                #{rsEtc},
                #{rsStrDt},
                #{rsEndDt},
                #{rsActEquip},
                #{empSeq}
            )
        <selectKey keyProperty="rsSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_PJT_RESULT'
        </selectKey>
    </insert>

    <update id="updResultInfo" parameterType="map">
        /*updResultInfo*/
        UPDATE CAM_PJT_MNG.DJ_PJT_RESULT
        SET
            PROTOTYPE = #{prototype},
            SUP_CONT = #{supCont},
            RS_ISS = #{rsIss},
            RS_ETC = #{rsEtc},
            RS_STR_DT = #{rsStrDt},
            RS_END_DT = #{rsEndDt},
            RS_ACT_EQUIP = #{rsActEquip},
            MOD_EMP_SEQ = #{empSeq}
        WHERE
            RS_SN = #{rsSn}
    </update>

    <update id="updResultDesignFile" parameterType="map">
        /*updResultDesignFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_RESULT
        SET
            DSGN_FILE_SN = #{file_no}
        WHERE
            RS_SN = #{rsSn}
    </update>

    <update id="updResultProdFile" parameterType="map">
        /*updResultProdFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_RESULT
        SET
            PROD_FILE_SN = #{file_no}
        WHERE
            RS_SN = #{rsSn}
    </update>

    <select id="getDesignFile" parameterType="map" resultType="map">
        /*getDesignFile*/
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_NO = #{DSGN_FILE_SN}
    </select>

    <select id="getProdFile" parameterType="map" resultType="map">
        /*getProdFile*/
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            FILE_NO = #{PROD_FILE_SN}
    </select>

    <update id="updDelvFile" parameterType="map">
        /*updDelvFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DELV
        SET
            DELV_FILE_SN = #{file_no}
        WHERE
            DELV_SN = #{delvSn}
    </update>

    <update id="updDevFile" parameterType="map">
        /*updDevFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            DEV_FILE_SN = #{file_no}
        WHERE
            DEV_SN = #{devSn}
    </update>

    <update id="updDevEstFile" parameterType="map">
        /*updDevEstFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            EST_FILE_SN = #{file_no}
        WHERE
            DEV_SN = #{devSn}
    </update>

    <update id="updDevEstFile" parameterType="map">
        /*updDevEstFile*/
        UPDATE CAM_PJT_MNG.DJ_PJT_DEV
        SET
            EST_FILE_SN = #{file_no}
        WHERE
            DEV_SN = #{devSn}
    </update>

    <update id="setDelvFileDocNm" parameterType="map">
        /* setDelvFileDocNm */
        UPDATE CAM_COMMON.DJ_FILE_INFO
        SET
            DOC_ID = #{docId}
        WHERE
            file_no = #{fileNo}
        AND file_cd = 'delvFile'
    </update>

    <update id="setDevFileDocNm" parameterType="map">
        /* setDevFileDocNm */
        UPDATE CAM_COMMON.DJ_FILE_INFO
        SET
            DOC_ID = #{docId}
        WHERE
            file_no in (${fileNo})
        AND file_cd in ('devEstFile', 'devFile')
    </update>

    <update id="setResultFileDocNm" parameterType="map">
        /* setResultFileDocNm */
        UPDATE CAM_COMMON.DJ_FILE_INFO
        SET
            DOC_ID = #{docId}
        WHERE
            file_no = #{fileNo}
          AND file_cd = 'delvFile'
    </update>
</mapper>