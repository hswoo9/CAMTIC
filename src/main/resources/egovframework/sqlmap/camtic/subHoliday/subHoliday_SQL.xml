<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="subHoliday">

    <select id="getVacCodeList" parameterType="map" resultType="map">
        /* getVacCodeList */
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_SUBHOLIDAY_CODE
        WHERE
            ACTIVE = "Y"
        AND
            SUBHOLIDAY_MC_CODE = #{mcCode}
            <if test="mdCode != null and mdCode !=''">
                AND SUBHOLIDAY_MD_CODE = #{mdCode}
            </if>
            <if test="dtCode != null and dtCode !=''">
                AND SUBHOLIDAY_DT_CODE = #{dtCode}
            </if>
            <if test="notCode != null and notCode!= ''">
                AND SUBHOLIDAY_CODE_ID != '9'
            </if>
        AND SUBHOLIDAY_CODE_ID != '11'
    </select>

    <select id="getVacUseHistoryList" parameterType="map" resultType="map">
        /* getVacUseHistoryList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    VUH.*,
                    VCD.SUBHOLIDAY_DT_CODE_NM,
                    IFNULL(DI.APPROVE_STAT_CODE,0) AS APPROVE_STAT_CODE,
                    DI.APPRO_KEY,
                    DI.DOC_MENU_CD
                FROM
                    CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST VUH
                JOIN
                    CAM_INSIDE.DJ_SUBHOLIDAY_CODE VCD ON VUH.SUBHOLIDAY_CODE_ID = VCD.SUBHOLIDAY_CODE_ID
                LEFT JOIN
                    DJ_CAMTIC.A_DOC_INFO DI ON VUH.DOC_ID = DI.DOC_ID,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                AND
                    VUH.ACTIVE = 'Y'
                AND
                    VUH.REG_EMP_SEQ = #{empSeq}
                    <if test='status != null and !"".equals(status)'>
                        <choose>
                            <when test='"W".equals(status)'>
                                AND (DI.APPROVE_STAT_CODE IS NULL OR DI.APPROVE_STAT_CODE IN (40,60))
                            </when>
                            <when test='"A".equals(status)'>
                                AND DI.APPROVE_STAT_CODE IN (10,20,50)
                            </when>
                            <when test='"R".equals(status)'>
                                AND DI.APPROVE_STAT_CODE IN (30)
                            </when>
                            <when test='"Y".equals(status)'>
                                AND DI.APPROVE_STAT_CODE IN (100,101)
                            </when>
                        </choose>
                    </if>
                    <if test='edtHolidayKindTop != null and !"".equals(edtHolidayKindTop)'>
                        AND VUH.SUBHOLIDAY_CODE_ID = #{edtHolidayKindTop}
                    </if>
                        AND
                            #{baseYear} = DATE_FORMAT(VUH.SUBHOLIDAY_EN_DT, '%Y')
                ORDER BY VUH.APPLY_DATE
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <insert id="setVacUseHist" parameterType="map">
        /* setVacUseHist */
        INSERT INTO CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
            (
                SUBHOLIDAY_CODE_ID,
                APPLY_SEQ,
                APPLY_DATE,
                SAVE_SEQ,
                SUBHOLIDAY_ST_DT,
                SUBHOLIDAY_ST_TIME,
                SUBHOLIDAY_EN_DT,
                SUBHOLIDAY_EN_TIME,
                RMK,
                SUBHOLIDAY_TARGET_SEQ,
                RMK_OTHER,
                REG_EMP_SEQ,
                OHTER_EMP,
                OTHER_EMP_SEQ,
                SUBHOLIDAY_WORK_DAY,
                SUBHOLIDAY_ALTERNATIVE_DAY,
                SUBHOLIDAY_USE_DAY
                <if test="approvalReason != null and approvalReason != ''">
                    , APPROVAL_REASON
                </if>
                <if test="holidayWorkMasterSn != null and holidayWorkMasterSn != ''">
                    , HOLIDAY_WORK_MASTER_SN
                </if>
                <if test='targetId != null and !"".equals(targetId)'>
                    , TARGET_ID
                </if>
            )
        VALUES
            (
                #{vacCodeId},
                #{applySeq},
                #{applyDate},
                #{saveSeq},
                #{vacUseStDt},
                #{vacUseStTime},
                #{vacUseEnDt},
                #{vacUseEnTime},
                #{rmk},
                #{vacTargetSeq},
                #{rmkOther},
                #{saveSeq},
                #{otherEmp},
                #{otherEmpSeq},
                #{vacWorkDt},
                #{vacUseAlDt},
                #{useDay}
                <if test="approvalReason != null and approvalReason != ''">
                    , #{approvalReason}
                </if>
                <if test="holidayWorkMasterSn != null and holidayWorkMasterSn != ''">
                    , #{holidayWorkMasterSn}
                </if>
                <if test='targetId != null and !"".equals(targetId)'>
                    , #{targetId}
                </if>
            )
        <selectKey keyProperty="vacUseHistId" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_INSIDE' AND TABLE_NAME = 'DJ_SUBHOLIDAY_USE_HIST'
        </selectKey>
    </insert>

    <update id="updateVacUseHist" parameterType="map">
        UPDATE CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
        SUBHOLIDAY_CODE_ID = #{vacCodeId},
        SUBHOLIDAY_ST_DT = #{vacUseStDt},
        SUBHOLIDAY_ST_TIME = #{vacUseStTime},
        SUBHOLIDAY_EN_DT = #{vacUseEnDt},
        SUBHOLIDAY_EN_TIME = #{vacUseEnTime},
        SUBHOLIDAY_USE_DAY = #{useDay},
        SUBHOLIDAY_WORK_DAY = #{vacWorkDt},
        SUBHOLIDAY_ALTERNATIVE_DAY = #{vacUseAlDt},
        OHTER_EMP = #{otherEmp},
        OTHER_EMP_SEQ = #{otherEmpSeq},
        RMK = #{rmk},
        RMK_OTHER = #{rmkOther},
        MOD_DATE = NOW(),
        MOD_EMP_SEQ = #{saveSeq}
        <if test="approvalReason != null and approvalReason != ''">
            , APPROVAL_REASON = #{approvalReason}
        </if>
        <if test='targetId != null and !"".equals(targetId)'>
            , TARGET_ID = #{targetId}
        </if>
        <if test='"Y".equals(targetReset)'>
            , TARGET_ID = null
        </if>
        WHERE
        SUBHOLIDAY_USE_ID = #{vacUseHistId}
    </update>

    <update id="updateVacUseHistWork" parameterType="map">
        UPDATE CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            SUBHOLIDAY_WORK_DAY_YN = 'Y'
        WHERE
            SUBHOLIDAY_WORK_DAY = #{vacWorkDt}
        AND
            SUBHOLIDAY_CODE_ID = '11'
        AND
            REG_EMP_SEQ = #{saveSeq}
    </update>

    <insert id="setHolidayWorkMasterIns" parameterType="map">
        /* setHolidayWorkMasterIns */
        INSERT INTO CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER
            (
                REG_EMP_SEQ
            )
        VALUES
            (
                #{regEmpSeq}
            )
        <selectKey keyProperty="holidayWorkMasterSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_INSIDE' AND TABLE_NAME = 'DJ_HOLIDAY_WORK_MASTER'
        </selectKey>
    </insert>

    <update id="setVacUseHistDel2" parameterType="map">
        /* setVacUseHistDel2 */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            ACTIVE = 'N'
        WHERE
            HOLIDAY_WORK_MASTER_SN = #{holidayWorkMasterSn} AND HOLIDAY_WORK_MASTER_SN IS NOT NULL
    </update>

    <update id="setVacUseHistDel" parameterType="map">
        /* setVacUseHistDel */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            ACTIVE = 'N',
            SUBHOLIDAY_WORK_DAY_YN = 'N'
        WHERE
            SUBHOLIDAY_USE_ID = #{subHolidayUseId}
    </update>

    <update id="setVacUseHistSubDel" parameterType="map">
        /* setVacUseHistSubDel */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            SUBHOLIDAY_WORK_DAY_YN = 'N'
        WHERE
            SUBHOLIDAY_USE_ID = #{TARGET_ID}
    </update>

    <delete id="deleteSubHoliDay" parameterType="map">
        /*deleteSubHoliDay*/
        DELETE FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        WHERE
            SUBHOLIDAY_USE_ID = #{subHolidayUseId}
    </delete>

    <update id="setOverWorkVacUse" parameterType="map">
        UPDATE COM_INSIDE.DJ_OVER_WORK_PLAN
        SET
        VAC_USE_HIST_USE = #{vacUseHistUse},
        VAC_USE_HIST_USE_ID = #{vacUseHistId},
        MOD_DATE = NOW()
        WHERE
        OVER_WORK_PLAN_ID IN
        (
        <foreach collection="overWorkList" item="item" separator=",">
            #{item}
        </foreach>
        )
    </update>

    <select id="getVacUseHistoryWorkList" parameterType="map" resultType="map">
        SELECT
            VUH.*,
            VCD.SUBHOLIDAY_DT_CODE_NM,
            M.STATUS AS DOC_STATUS
        FROM
            CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER M
        LEFT JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST VUH ON M.HOLIDAY_WORK_MASTER_SN = VUH.HOLIDAY_WORK_MASTER_SN AND VUH.ACTIVE = 'Y'
        LEFT JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_CODE VCD
        ON VUH.SUBHOLIDAY_CODE_ID = VCD.SUBHOLIDAY_CODE_ID
        WHERE
            VUH.SUBHOLIDAY_CODE_ID = '11'
        AND
            M.ACTIVE = 'Y'

        <if test='baseYear != null and !"".equals(baseYear)'>
        <![CDATA[
            AND
                #{baseYear} = DATE_FORMAT(VUH.SUBHOLIDAY_WORK_DAY, '%Y')
        ]]>
        </if>
        <if test="empSeq != null and empSeq != ''">
            AND VUH.APPLY_SEQ = #{empSeq}
        </if>
    </select>

    <select id="getVacUseHistoryListAdmin" parameterType="map" resultType="map">
        /* getVacUseHistoryListAdmin */
        SELECT
            HDI2.DEPT_NAME,
            DEI.DEPT_TEAM_NAME,
            DEI.EMP_NAME_KR,
            VUH.*,
            VCD.SUBHOLIDAY_DT_CODE_NM,
            DI.DOC_ID,
            IFNULL(DI.APPROVE_STAT_CODE, 0) AS APPROVE_STAT_CODE,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD,
            DATE_FORMAT(VUH.REG_DATE, '%Y-%m-%d') AS REG_DT
        FROM
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST VUH
        JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_CODE VCD
        ON VUH.SUBHOLIDAY_CODE_ID = VCD.SUBHOLIDAY_CODE_ID
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO DEI ON VUH.REG_EMP_SEQ = DEI.EMP_SEQ
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON VUH.DOC_ID = DI.DOC_ID
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI ON HDI.DEPT_SEQ = DEI.DEPT_SEQ
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI2 ON HDI.PARENT_DEPT_SEQ = HDI2.DEPT_SEQ
        where
            1=1
        AND
            VUH.APPR_STAT != 'N'
        AND
            VUH.ACTIVE = 'Y'
        AND
            (VUH.DOC_ID != 'AA' OR VUH.DOC_ID IS NULL)
        <if test='status != null and !"".equals(status)'>
            <choose>
                <when test='"W".equals(status)'>
                    AND (DI.APPROVE_STAT_CODE IS NULL OR DI.APPROVE_STAT_CODE IN (40,60))
                </when>
                <when test='"A".equals(status)'>
                    AND DI.APPROVE_STAT_CODE IN (10,20,50)
                </when>
                <when test='"R".equals(status)'>
                    AND DI.APPROVE_STAT_CODE IN (30)
                </when>
                <when test='"Y".equals(status)'>
                    AND DI.APPROVE_STAT_CODE IN (100,101)
                </when>
            </choose>
        </if>
        <if test='edtHolidayKindTop != null and !"".equals(edtHolidayKindTop)'>
            AND VUH.SUBHOLIDAY_CODE_ID = #{edtHolidayKindTop}
        </if>
        <choose>
            <when test='searchType == "1" and searchVal != null and !"".equals(searchVal)'>
                AND DEI.EMP_NAME_KR LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <when test='searchType == "2" and searchVal != null and !"".equals(searchVal)'>
                AND HDI2.DEPT_NAME LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <when test='searchType == "3" and searchVal != null and !"".equals(searchVal)'>
                AND HDI.DEPT_NAME LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <when test='searchType == "4" and searchVal != null and !"".equals(searchVal)'>
                AND (DEI.DUTY_NAME LIKE CONCAT('%',#{searchVal},'%') OR DEI.POSITION_NAME LIKE CONCAT('%',#{searchVal},'%'))
            </when>
            <otherwise>
                AND
                (
                    DEI.EMP_NAME_KR LIKE CONCAT('%',#{searchVal},'%') OR
                    HDI2.DEPT_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    HDI.DEPT_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    DEI.DUTY_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    DEI.POSITION_NAME LIKE CONCAT('%',#{searchVal},'%')
                )
            </otherwise>
        </choose>
        <if test='startDate != null and !"".equals(startDate)'>
            <![CDATA[
            AND
                DATE_FORMAT(#{startDate}, '%Y-%m-%d') <= DATE_FORMAT(VUH.SUBHOLIDAY_ST_DT, '%Y-%m-%d')
            AND
                DATE_FORMAT(#{endDate}, '%Y-%m-%d') >= DATE_FORMAT(VUH.SUBHOLIDAY_ST_DT, '%Y-%m-%d')
            ]]>
        </if>
        ORDER BY SUBHOLIDAY_ST_DT DESC
    </select>

    <select id="getVacUseStatDetailList" parameterType="map" resultType="map">
        /* getVacUseStatDetailList */
        SELECT
            HDI2.DEPT_NAME,
            DEI.DEPT_TEAM_NAME,
            DEI.EMP_NAME_KR,
            VUH.*,
            VCD.SUBHOLIDAY_DT_CODE_NM,
            DI.DOC_ID,
            IFNULL(DI.APPROVE_STAT_CODE, 0) AS APPROVE_STAT_CODE,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD,
            DATE_FORMAT(VUH.REG_DATE, '%Y-%m-%d') AS REG_DT
        FROM
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST VUH
        JOIN CAM_INSIDE.DJ_SUBHOLIDAY_CODE VCD ON VUH.SUBHOLIDAY_CODE_ID = VCD.SUBHOLIDAY_CODE_ID
        LEFT JOIN CAM_HR.DJ_EMP_INFO DEI ON VUH.REG_EMP_SEQ = DEI.EMP_SEQ
        LEFT JOIN DJ_CAMTIC.A_DOC_INFO DI ON VUH.DOC_ID = DI.DOC_ID
        LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HDI.DEPT_SEQ = DEI.DEPT_SEQ
        LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI2 ON HDI.PARENT_DEPT_SEQ = HDI2.DEPT_SEQ
        WHERE
            VUH.APPR_STAT = 'Y'
        AND VUH.ACTIVE = 'Y'
        AND DEL_YN != 'Y'
        AND LEFT(VUH.SUBHOLIDAY_ST_DT, 4) = #{holidayYear}
        AND VUH.SUBHOLIDAY_CODE_ID IN (1, 3, 4, 5, 6, 7, 8, 9, 10)
        AND (VUH.DOC_ID != 'AA' OR VUH.DOC_ID IS NULL)
        AND VUH.SUBHOLIDAY_CODE_ID = #{holidayCode}
        AND DEI.EMP_NAME_KR LIKE CONCAT('%',#{empName},'%')
        <if test='"asc".equals(orderType)'>
            ORDER BY SUBHOLIDAY_ST_DT ASC
        </if>
    </select>

    <select id="getVacUseHistoryOne" resultType="map" parameterType="map">
        /* getVacUseHistoryOne */
        SELECT
            SUH.SUBHOLIDAY_USE_ID,
            SUH.SUBHOLIDAY_CODE_ID,
            SUH.APPLY_SEQ,
            SUH.APPLY_DATE,
            SUH.SAVE_SEQ,
            SUH.SAVE_DATE,
            SUH.SUBHOLIDAY_ST_DT,
            SUH.SUBHOLIDAY_ST_TIME,
            SUH.SUBHOLIDAY_EN_DT,
            SUH.SUBHOLIDAY_EN_TIME,
            SUH.SUBHOLIDAY_USE_DAY,
            SUH.SUBHOLIDAY_USE_HOUR,
            SUH.SUBHOLIDAY_USE_TIME,
            SUH.RMK,
            SUH.SUBHOLIDAY_WORK_DAY,
            SUH.SUBHOLIDAY_WORK_DAY_YN,
            SUH.SUBHOLIDAY_ALTERNATIVE_DAY,
            SUH.SH_WORK_STAT,
            SUH.RMK_OTHER,
            SUH.APPR_STAT,
            SUH.ADMIN_APPR_STAT,
            SUH.DOC_ID,
            SUH.ADMIN_DOC_ID,
            SUH.DOC_STS,
            SUH.APPROVAL_REASON,
            SUH.APPROVAL_EMP_SEQ,
            SUH.APPROVAL_DATE,
            SUH.APPROVAL_SEND_DATE,
            SUH.SUBHOLIDAY_TARGET_SEQ,
            SUH.OHTER_EMP,
            SUH.OTHER_EMP_SEQ,
            SUH.ACTIVE,
            SUH.REG_EMP_SEQ,
            SUH.REG_DATE,
            SUH.MOD_EMP_SEQ,
            SUH.MOD_DATE,
            SUH.HOLIDAY_WORK_MASTER_SN,
            CAM_HR.FN_GetName('DEPT', EI.DEPT_SEQ, 'KR') AS DEPT_NAME2,
            DATE_FORMAT(SUH.SAVE_DATE, '%Y-%m-%d') AS SAVE_DT,
            SCD.SUBHOLIDAY_DT_CODE_NM,
            EI.EMP_NAME_KR,
            EI.DEPT_SEQ,
            EI.DEPT_NAME,
            EI.DEPT_TEAM_NAME,
            EI.POSITION_CODE,
            IFNULL(EI.POSITION_NAME, '') AS POSITION_NAME,
            IFNULL(EI.DUTY_NAME, '') AS DUTY_NAME,
            EI.DUTY_CODE,
            IFNULL(DI.APPROVE_STAT_CODE, '0') AS STATUS,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD,
            SUH.TARGET_ID,
            SUH.BF_YN
        FROM
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST SUH
        LEFT JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_CODE SCD ON SUH.SUBHOLIDAY_CODE_ID = SCD.SUBHOLIDAY_CODE_ID
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO EI ON EI.EMP_SEQ = SUH.REG_EMP_SEQ
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON SUH.DOC_ID = DI.DOC_ID
        WHERE
            SUH.SUBHOLIDAY_USE_ID = #{subholidayUseId}
    </select>

    <select id="getHolidayWorkMasterOne" resultType="map" parameterType="map">
        /* getHolidayWorkMasterOne */
        SELECT
            M.*,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD
        FROM
            CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER M
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON M.DOC_ID = DI.DOC_ID
        WHERE
            M.HOLIDAY_WORK_MASTER_SN = #{holidayWorkMasterSn}
    </select>

    <select id="getHolidayWorkHistOne" resultType="map" parameterType="map">
        /* getHolidayWorkHistOne */
        SELECT
            SUH.SUBHOLIDAY_USE_ID,
            SUH.SUBHOLIDAY_CODE_ID,
            SUH.APPLY_SEQ,
            SUH.APPLY_DATE,
            SUH.SAVE_SEQ,
            SUH.SAVE_DATE,
            SUH.SUBHOLIDAY_ST_DT,
            SUH.SUBHOLIDAY_ST_TIME,
            SUH.SUBHOLIDAY_EN_DT,
            SUH.SUBHOLIDAY_EN_TIME,
            SUH.SUBHOLIDAY_USE_DAY,
            SUH.SUBHOLIDAY_USE_HOUR,
            SUH.SUBHOLIDAY_USE_TIME,
            SUH.RMK,
            SUH.SUBHOLIDAY_WORK_DAY,
            SUH.SUBHOLIDAY_WORK_DAY_YN,
            SUH.SUBHOLIDAY_ALTERNATIVE_DAY,
            SUH.SH_WORK_STAT,
            SUH.RMK_OTHER,
            SUH.APPR_STAT,
            SUH.ADMIN_APPR_STAT,
            SUH.DOC_ID,
            SUH.ADMIN_DOC_ID,
            SUH.DOC_STS,
            SUH.APPROVAL_REASON,
            SUH.APPROVAL_EMP_SEQ,
            SUH.APPROVAL_DATE,
            SUH.APPROVAL_SEND_DATE,
            SUH.SUBHOLIDAY_TARGET_SEQ,
            SUH.OHTER_EMP,
            SUH.OTHER_EMP_SEQ,
            SUH.ACTIVE,
            SUH.REG_EMP_SEQ,
            SUH.REG_DATE,
            SUH.MOD_EMP_SEQ,
            SUH.MOD_DATE,
            CAM_HR.FN_GetName('DEPT', EI.DEPT_SEQ, 'KR') AS DEPT_NAME2,
            DATE_FORMAT(SUH.SAVE_DATE, '%Y-%m-%d') AS SAVE_DT,
            SCD.SUBHOLIDAY_DT_CODE_NM,
            EI.EMP_NAME_KR,
            EI.DEPT_SEQ,
            EI.DEPT_NAME,
            EI.DEPT_TEAM_NAME,
            EI.POSITION_CODE,
            IFNULL(EI.POSITION_NAME, '') AS POSITION_NAME,
            IFNULL(EI.DUTY_NAME, '') AS DUTY_NAME,
            EI.DUTY_CODE,
            IFNULL(DI.APPROVE_STAT_CODE, '0') AS STATUS,
            DI.APPRO_KEY,
            DI.DOC_MENU_CD
        FROM
            CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER M
        LEFT JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST SUH ON SUH.HOLIDAY_WORK_MASTER_SN = M.HOLIDAY_WORK_MASTER_SN AND SUH.ACTIVE = 'Y'
        LEFT JOIN
            CAM_INSIDE.DJ_SUBHOLIDAY_CODE SCD ON SUH.SUBHOLIDAY_CODE_ID = SCD.SUBHOLIDAY_CODE_ID
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO EI ON EI.EMP_SEQ = SUH.REG_EMP_SEQ
        LEFT JOIN
            DJ_CAMTIC.A_DOC_INFO DI ON SUH.DOC_ID = DI.DOC_ID
        WHERE
            M.HOLIDAY_WORK_MASTER_SN = #{holidayWorkMasterSn}
    </select>

    <select id="getUserVacList" resultType="map" parameterType="map">
        /* getUserVacList */
        SELECT RE. * FROM (SELECT
            VUI.EMP_SEQ,
            VUI.EMP_NAME_KR,
            VUI.DUTY_NAME,
            VUI.POSITION_CODE,
            VUI.POSITION_NAME,
            (CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.DEPT_SEQ = DI.DEPT_SEQ) END) AS DEPT_NAME,
            (CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.DEPT_SEQ = DI.DEPT_SEQ) ELSE "" END) AS TEAM_NAME,
            CASE WHEN VUI.DUTY_NAME IS NULL OR VUI.DUTY_NAME = "" THEN VUI.POSITION_NAME ELSE VUI.DUTY_NAME END AS SPOT,
            DATE_FORMAT(VUI.JOIN_DAY, '%Y-%m-%d') AS JOIN_DAY,
            VC.APPLY_YEAR,
            CONCAT(VC.APPLY_YEAR, '-01-01') AS ST_APPLY_DATE,
            CONCAT(VC.APPLY_YEAR, '-12-31') AS EN_APPLY_DATE,
            VC.GRANT_DAY,
            VC.MDTN_DAY,
            VC.EXTRA_DAY,
            VC.USE_DAY,
            VC.CARRYOVER_DAY,
            VC.ADJUSTMENT_USE_DAY,
            VC.COMP_VAC,
            ((VC.GRANT_DAY + VC.MDTN_DAY + VC.EXTRA_DAY) - (VC.USE_DAY)) AS REMAIN_VAC,
            VC.ACTIVE,
            VC.HOLIDAY_ID,
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE APPLY_YEAR = #{befYear} AND EMP_SEQ = VUI.EMP_SEQ), 0) AS befUseDay,
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE APPLY_YEAR = #{bef2Year} AND EMP_SEQ = VUI.EMP_SEQ), 0) AS bef2UseDay
        FROM
            CAM_HR.DJ_EMP_INFO VUI
        LEFT JOIN
            CAM_INSIDE.DJ_HOLIDAY VC
        ON
            VUI.EMP_SEQ = VC.EMP_SEQ AND VC.APPLY_YEAR = #{holidayYear}
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI ON VUI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE
            VUI.ACTIVE = "Y"
        AND WORK_STATUS_CODE = 'Y'
        <if test='dept != null and !"".equals(dept)'>
            <if test='team != null and !"".equals(team)'>
                AND (VUI.DEPT_SEQ = #{dept} OR VUI.DEPT_SEQ = #{team})
            </if>
            <if test='team == null or "".equals(team)'>
                AND VUI.DEPT_SEQ = #{dept}
            </if>
        </if>
        <if test='dept == null or "".equals(dept)'>
            <if test='team != null and !"".equals(team)'>
                AND VUI.DEPT_SEQ = #{team}
            </if>
        </if>
        <if test='searchVal != null and !"".equals(searchVal)'>
            AND VUI.EMP_NAME_KR LIKE CONCAT('%',#{searchVal},'%')
        </if>
        <choose>
            <when test='vacStatus != null and vacStatus.equals("Y")'>AND VC.APPLY_YEAR = DATE_FORMAT(NOW(), '%Y') AND VC.ACTIVE = #{vacStatus}</when>
            <when test='vacStatus != null and vacStatus.equals("N")'>AND VC.APPLY_YEAR = DATE_FORMAT(NOW(), '%Y') AND VC.ACTIVE = #{vacStatus}</when>
            <when test='vacStatus != null and vacStatus.equals("NULL")'>AND VC.APPLY_YEAR IS NULL</when>
            <otherwise>
                AND VC.APPLY_YEAR = #{holidayYear}
            </otherwise>
        </choose>
        AND VUI.EMP_SEQ NOT IN (1)

        <![CDATA[
        ) RE
            ORDER BY (
            CASE WHEN DEPT_NAME = '캠틱종합기술원' THEN 1 WHEN ASCII(SUBSTRING(DEPT_NAME,1)) < 123 THEN 3 ELSE 2 END
        ), DEPT_NAME, TEAM_NAME, DUTY_NAME DESC, POSITION_CODE, EMP_NAME_KR;
        ]]>
    </select>

    <select id="getUserVacListStat" resultType="map" parameterType="map">
        /* getUserVacListStat */
        /*1(연차), 3(오전반차), 4(오후반차), 5(병가), 6(공가), 7(경조휴가), 8(출산휴가), 9(대체휴가), 10(근속포상휴가), 11(휴일근로)*/

        SELECT RE. * FROM (SELECT
            VUI.emp_seq,
            VUI.EMP_NAME_KR,
            (CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.DEPT_SEQ = DI.DEPT_SEQ) END) AS DEPT_NAME,
            (CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.DEPT_SEQ = DI.DEPT_SEQ) ELSE "" END) AS TEAM_NAME,
            IF(DUTY_NAME != '', DUTY_NAME, POSITION_NAME) as POSDUT,
            VUI.DUTY_NAME,
            VUI.POSITION_CODE,
            VUI.POSITION_NAME,
            Date_format(VUI.join_day, '%Y-%m-%d') AS JOIN_DAY,
            VC.apply_year,
            Concat(VC.apply_year, '-01-01') AS ST_APPLY_DATE,
            Concat(VC.apply_year, '-12-31') AS EN_APPLY_DATE,
            IFNULL(VC.grant_day, 0) AS grant_day,
            VC.mdtn_day,
            VC.extra_day,
            VC.use_day,
            (
                (
                    IFNULL(VC.grant_day, 0)
                )
                -
                IFNULL((
                Sum(CASE
                WHEN VUH.subholiday_code_id = 1  AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN VUH.SUBHOLIDAY_USE_DAY
                ELSE 0
                END)
                +
                Sum(CASE
                WHEN VUH.subholiday_code_id = 3  AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 0.5
                ELSE 0
                END)
                +
                Sum(CASE
                WHEN VUH.subholiday_code_id = 4  AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 0.5
                ELSE 0
                END)
                +
                (SELECT IFNULL(USE_DAY, 0) FROM CAM_INSIDE.DJ_HOLIDAY VC WHERE VC.EMP_SEQ = VUI.EMP_SEQ AND VC.APPLY_YEAR = (${holidayYear} -1))
                +
                (CASE
                   WHEN VC.GRANT_DAY = 0
                    THEN IFNULL((SELECT SUM(SUBHOLIDAY_USE_DAY) FROM cam_inside.dj_subholiday_use_hist WHERE ACTIVE = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = (${holidayYear} -1) AND subholiday_code_id IN ( 1, 3, 4 ) AND APPLY_SEQ = VUI.EMP_SEQ), 0)
                     ELSE 0
                END)
                ), 0)
            ) AS REMAIN_VAC,
            VC.active,
            VC.holiday_id,
            VC.comp_vac,
            VC.grant_day + VC.comp_vac AS total_vacation,
            VUH.apply_date,
            ((CASE
                WHEN
                    VC.GRANT_DAY = 0
                THEN
                    IFNULL((SELECT SUM(SUBHOLIDAY_USE_DAY) FROM cam_inside.dj_subholiday_use_hist WHERE ACTIVE = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = (${holidayYear} -1) AND subholiday_code_id IN ( 1, 3, 4 ) AND APPLY_SEQ = VUI.EMP_SEQ), 0)
                ELSE
                    0
            END)
            +
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE ACTIVE = 'Y' AND EMP_SEQ = VUI.EMP_SEQ AND APPLY_YEAR = (${holidayYear} -1)), 0)) AS befUseDay,
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE VUH.apply_date = #{bef2Year} AND EMP_SEQ = VUI.EMP_SEQ), 0) AS bef2UseDay,
            CASE WHEN VUI.DUTY_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 3 AND CM_CODE = VUI.DUTY_CODE)
            WHEN VUI.POSITION_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 4 AND CM_CODE = VUI.POSITION_CODE)
            ELSE 999 END SORT,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 1 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN VUH.SUBHOLIDAY_USE_DAY
                ELSE 0
            END) AS ANNUAL,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 3 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 0.5
                ELSE 0
            END) AS MORNING,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 4 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 0.5
                ELSE 0
            END) AS AFTERNOON,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 5 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS SICK,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 6 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS PUBLICHOLI,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 7 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS CONDOLENCES,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 8 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS MATERNITY,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 9 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS ALTERNATIVE,
            Sum(CASE
                WHEN VUH.subholiday_code_id = 10 AND VUH.APPR_STAT = 'Y' AND VUH.DEL_YN != 'Y' THEN 1
                ELSE 0
            END) AS LONGAWARD,
            (SELECT IFNULL(COUNT(-1), 0) FROM CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER A LEFT JOIN CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST B ON A.HOLIDAY_WORK_MASTER_SN = B.HOLIDAY_WORK_MASTER_SN AND B.ACTIVE = 'Y' WHERE A.REG_EMP_SEQ = VUI.EMP_SEQ AND (A.STATUS = '100' OR A.STATUS = '101') AND B.SUBHOLIDAY_CODE_ID in (11) AND A.ACTIVE = 'Y' AND LEFT(B.APPLY_DATE, 4) = #{holidayYear} AND DEL_YN = 'N') AS HOLIDAYWORK
        FROM cam_hr.dj_emp_info VUI

        LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON VUI.DEPT_SEQ = HDI.DEPT_SEQ

        LEFT JOIN cam_inside.dj_holiday VC ON VC.emp_seq = VUI.emp_seq AND VC.APPLY_YEAR = #{holidayYear}

        LEFT JOIN cam_inside.dj_subholiday_use_hist VUH ON VUI.emp_seq = VUH.reg_emp_seq AND VUH.ACTIVE = 'Y'  AND VUH.APPR_STAT = 'Y' AND LEFT(VUH.SUBHOLIDAY_ST_DT, 4) = #{holidayYear} AND VUH.subholiday_code_id IN ( 1, 3, 4, 5, 6, 7, 8, 9, 10 )

        LEFT JOIN cam_inside.dj_subholiday_use_hist VUH2 ON VUI.emp_seq = VUH.reg_emp_seq AND VUH.ACTIVE = 'Y' AND LEFT(VUH.APPLY_DATE, 4) = #{holidayYear} AND VUH.subholiday_code_id IN ( 11 )
        <if test='edtHolidayKindTop != null and !"".equals(edtHolidayKindTop)'>
            AND VUH.SUBHOLIDAY_CODE_ID = #{edtHolidayKindTop}
        </if>

        WHERE 1=1
        <if test='deptSeq != null and !"".equals(deptSeq)'>
            <choose>
                <when test='deptTeamSeq != null and !"".equals(deptTeamSeq)'>
                    AND VUI.DEPT_SEQ = #{deptTeamSeq}
                </when>
                <otherwise>
                    AND (VUI.DEPT_SEQ = #{deptSeq} OR HDI.PARENT_DEPT_SEQ = #{deptSeq})
                </otherwise>
            </choose>
        </if>
        <choose>
            <when test='searchType == "1" and searchVal != null and !"".equals(searchVal)'>
                AND VUI.EMP_NAME_KR LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <when test='searchType == "2" and searchVal != null and !"".equals(searchVal)'>
                AND (VUI.DUTY_NAME LIKE CONCAT('%',#{searchVal},'%') OR VUI.POSITION_NAME LIKE CONCAT('%',#{searchVal},'%'))
            </when>
            <when test='searchType == "3" and searchVal != null and !"".equals(searchVal)'>
                AND VUI.GRADE_NAME LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <when test='searchType == "4" and searchVal != null and !"".equals(searchVal)'>
                AND VUI.EMAIL_ADDR LIKE CONCAT('%',#{searchVal},'%')
            </when>
            <otherwise>
                AND
                (
                    VUI.EMP_NAME_KR LIKE CONCAT('%',#{searchVal},'%') OR
                    VUI.DUTY_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    VUI.POSITION_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    VUI.GRADE_NAME LIKE CONCAT('%',#{searchVal},'%') OR
                    VUI.EMAIL_ADDR LIKE CONCAT('%',#{searchVal},'%')
                )
            </otherwise>
        </choose>
        <if test='arr != null and !"".equals(arr)'>
            AND
            <foreach collection="arr" item="item" separator="OR" open="(" close=")">
                ${item}
            </foreach>
        </if>
        AND VUI.EMP_SEQ NOT IN (1)
        AND VUI.WORK_STATUS_CODE = 'Y'
        AND TEMP_DIVISION = 'N'

        GROUP BY VUI.EMP_SEQ ) RE

        <![CDATA[
        ORDER BY (
            CASE WHEN DEPT_NAME = '캠틱종합기술원' THEN 1 WHEN ASCII(SUBSTRING(DEPT_NAME,1)) < 123 THEN 3 ELSE 2 END
        ), DEPT_NAME, TEAM_NAME, DUTY_NAME DESC, POSITION_CODE, EMP_NAME_KR;
        ]]>
    </select>

    <update id="updateApprStat" parameterType="map">
        /* updateApprStat */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            APPR_STAT = #{status},
            APPROVAL_SEND_DATE = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            APPROVAL_EMP_SEQ = #{empSeq},
            DOC_ID = #{docId}
        WHERE
            SUBHOLIDAY_USE_ID = #{subholidayUseId}
    </update>

    <update id="updateRetrieveStat" parameterType="map">
        /* updateRetrieveStat */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            APPR_STAT = #{status},
            APPROVAL_SEND_DATE = null,
            APPROVAL_EMP_SEQ = null,
            DOC_ID = null
        WHERE
            SUBHOLIDAY_USE_ID = #{subholidayUseId}
    </update>

    <update id="updateFinalApprStat" parameterType="map">
        /* updateApprFinalStat */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            APPR_STAT = #{status}
        WHERE
            SUBHOLIDAY_USE_ID = #{subholidayUseId}
    </update>

    <update id="setUserVacUpdate" parameterType="map">
        /* setUserVacUpdate */
        UPDATE
            CAM_INSIDE.DJ_HOLIDAY
        SET
            GRANT_DAY = #{grantDay},
            MDTN_DAY = #{mdtnDay},
            REMAIN_DAY = CONCAT(#{grantDay} + #{mdtnDay} - #{useDay}),
            EXTRA_DAY = #{extraDay},
            CARRYOVER_DAY = #{carryoverDay},
            USE_DAY = #{useDay},
            ADJUSTMENT_USE_DAY = #{adjustmentUseDay},
            RMK = CONCAT(IFNULL(#{rmk}, '관리자 연차 수정')),
            MOD_EMP_SEQ = #{targetEmpSeq},
            MOD_DATE = NOW()
        WHERE
            EMP_SEQ = #{targetEmpSeq}
    </update>

    <select id="getUserHolyData" parameterType="map" resultType="map">
        /* getUserHolyData*/
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HOLIDAY DH
        WHERE
            DH.ACTIVE = "Y" AND DH.APPLY_YEAR = #{year}
        AND
            EMP_SEQ = #{empSeq}
    </select>

    <select id="getUserBefHolyData" parameterType="map" resultType="map">
        /* getUserBefHolyData */
        SELECT
            ((CASE
                WHEN
                    DH.GRANT_DAY = 0
                THEN
                    IFNULL((SELECT SUM(SUBHOLIDAY_USE_DAY) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE ACTIVE = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = (${year} -1) AND SUBHOLIDAY_CODE_ID IN ( 1, 3, 4 ) AND APPLY_SEQ = DH.EMP_SEQ), 0)
                ELSE
                    0
            END)
            +
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE ACTIVE = "Y" AND EMP_SEQ = #{loginEmpSeq} AND APPLY_YEAR = (${year} -1)), 0)
            ) AS befYear,
            IFNULL((SELECT USE_DAY FROM CAM_INSIDE.DJ_HOLIDAY WHERE APPLY_YEAR = #{befYear} AND DH.EMP_SEQ = EMP_SEQ), 0) AS befYear,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID = 1 AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS ann,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (3,4) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS halfAnn,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (5) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS sickLv,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (6) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS pubHoly,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (7) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS congHoly,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (8) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS matHoly,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (9) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS altHoly,
            IFNULL((SELECT IFNULL(SUM(SUBHOLIDAY_USE_DAY), 0) FROM CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST WHERE APPLY_SEQ = #{loginEmpSeq} AND SUBHOLIDAY_CODE_ID in (10) AND ACTIVE = 'Y' AND APPR_STAT = 'Y' AND LEFT(SUBHOLIDAY_ST_DT, 4) = #{year} AND DEL_YN = 'N'), 0) AS compHoly,
            IFNULL((SELECT IFNULL(COUNT(-1), 0) FROM CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER A LEFT JOIN CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST B ON A.HOLIDAY_WORK_MASTER_SN = B.HOLIDAY_WORK_MASTER_SN AND B.ACTIVE = 'Y' WHERE B.APPLY_SEQ = #{loginEmpSeq} AND B.SUBHOLIDAY_CODE_ID in (11) AND A.ACTIVE = 'Y' AND (A.STATUS = '100' OR A.STATUS = '101') AND LEFT(B.APPLY_DATE, 4) = #{year} AND DEL_YN = 'N'), 0) AS workHoly,
            IFNULL((SELECT IFNULL(COUNT(-1), 0) FROM CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER A LEFT JOIN CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST B ON A.HOLIDAY_WORK_MASTER_SN = B.HOLIDAY_WORK_MASTER_SN AND B.ACTIVE = 'Y' WHERE B.APPLY_SEQ = #{loginEmpSeq} AND B.SUBHOLIDAY_CODE_ID in (11) AND A.ACTIVE = 'Y' AND (A.STATUS = '100' OR A.STATUS = '101') AND LEFT(B.APPLY_DATE, 4) = #{year} AND DEL_YN = 'N'), 0) AS remainWorkHoly
        FROM
            CAM_INSIDE.DJ_HOLIDAY DH
        WHERE
            DH.ACTIVE = "Y" AND DH.EMP_SEQ = #{loginEmpSeq} AND APPLY_YEAR = #{year}
    </select>

    <update id="setUserVacList" parameterType="java.util.List" flushCache="true">
        <foreach collection="list" item="item" index="index" separator=";">
            UPDATE CAM_INSIDE.DJ_HOLIDAY
            SET
                PREVIOUS_GRANT_DAY = #{item.PREVIOUS_GRANT_DAY},
                GRANT_DAY = #{item.GRANT_DAY},
                COMP_VAC = #{item.COMP_VAC},
                MOD_DATE = NOW()
            WHERE
                HOLIDAY_ID = #{item.HOLIDAY_ID}
        </foreach>
    </update>

    <select id="getUserVacInfo" parameterType="map" resultType="map">
        /*getUserVacInfo*/
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HOLIDAY
        WHERE
            HOLIDAY_ID = #{HOLIDAY_ID}
    </select>

    <update id="setUserVacInfo" parameterType="map">
        /*setUserVacInfo*/
        UPDATE CAM_INSIDE.DJ_HOLIDAY
        SET
            GRANT_DAY = #{GRANT_DAY},
            COMP_VAC = #{COMP_VAC},
            MOD_DATE = NOW()
        WHERE
            HOLIDAY_ID = #{HOLIDAY_ID}
    </update>

    <insert id="insUserVacChangeHist" parameterType="map">
        /*insUserVacChangeHist*/
        INSERT INTO CAM_INSIDE.DJ_HOLIDAY_HIST
            (
                HOLIDAY_ID,
                BF_GRANT_DAY,
                AF_GRANT_DAY,
                BF_COMP_VAC,
                AF_COMP_VAC,
                REASON,
                MOD_DT,
                REG_EMP_SEQ,
                REG_DATE
            )
        VALUES
            (
                CAST(#{HOLIDAY_ID} AS signed integer),
                (SELECT SH.GRANT_DAY FROM CAM_INSIDE.DJ_HOLIDAY SH WHERE SH.HOLIDAY_ID = #{HOLIDAY_ID}),
                #{GRANT_DAY},
                (SELECT SH.COMP_VAC FROM CAM_INSIDE.DJ_HOLIDAY SH WHERE SH.HOLIDAY_ID = #{HOLIDAY_ID}),
                #{COMP_VAC},
                #{reason},
                DATE_FORMAT(NOW(), '%Y-%m-%d'),
                #{emqSeq},
                now()
            )
    </insert>

    <select id="getHolidayList" parameterType="map" resultType="map">
        /*getHolidayList*/
        SELECT
            HM.*,
            DATE_FORMAT(HM.H_DAY, '%Y-%m-%d') AS hday,
            CASE
            WHEN HM.comp_seq = '1000' THEN '캠틱종합기술원'
            END AS COMP_SEQ_NAME,
            CASE
                WHEN HM.use_yn = 'Y' THEN '사용'
                WHEN HM.use_yn = 'N' THEN '미사용'
            END AS USEYN
        FROM
            CAM_INSIDE.DJ_HOLIDAY_MANAGEMENT HM
        WHERE
            1=1
        <if test='s_compSeq != null and s_compSeq != ""'>
            AND HM.COMP_SEQ = #{s_compSeq}
        </if>
        <if test='s_useYn != null and s_useYn != ""'>
            AND HM.USE_YN = #{s_useYn}
        </if>
        <if test='s_title != null and s_title != ""'>
            AND HM.TITLE LIKE CONCAT('%', #{s_title}, '%')
        </if>
        <if test='year != null and year != ""'>
            AND SUBSTRING(HM.H_DAY, 1, 4) = #{year}
        </if>
    </select>

    <select id="getUserInfoList" parameterType="map" resultType="map">
        SELECT
            HEI.*,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_SEQ END AS DEPT_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME1,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_SEQ ELSE "" END AS TEAM_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
            DATE_FORMAT(HEI.JOIN_DAY,'%Y-%m-%d') AS JOIN_DAY2,
            IFNULL(CASE WHEN HEI.DUTY_NAME = "" THEN HEI.POSITION_NAME ELSE HEI.DUTY_NAME END, "") AS SPOT,

            CASE WHEN HEI.DUTY_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 3 AND CM_CODE = HEI.DUTY_CODE)
                 WHEN HEI.POSITION_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 4 AND CM_CODE = HEI.POSITION_CODE)
                 ELSE 999 END SORT

        FROM
        CAM_HR.DJ_EMP_INFO	AS HEI
        LEFT JOIN
        CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE
            HEI.ACTIVE = 'Y'
        <if test='dept != null and !"".equals(dept)'>
            AND
            HEI.DEPT_SEQ = #{dept}
            <if test='team == team or "".equals(team)'>
                OR
                HEI.DEPT_SEQ IN (
                SELECT
                DEPT_SEQ
                FROM
                CAM_HR.DJ_DEPT_INFO
                WHERE
                DEPT_SEQ = #{dept}
                OR
                PARENT_DEPT_SEQ = #{dept}
                )
            </if>
        </if>
        <if test='team != null and !"".equals(team)'>
            AND
            HEI.DEPT_SEQ = #{team}
        </if>
        <choose>
            <when test='searchType == "1" and searchVal != null and !"".equals(searchVal)'>
                AND
                HEI.DUTY_NAME = #{searchVal}
            </when>
            <when test='searchType == "2" and searchVal != null and !"".equals(searchVal)'>
                AND
                HEI.EMP_NAME_KR = #{searchVal}
            </when>
            <otherwise>
                AND
                (HEI.DUTY_NAME = #{searchVal} OR HEI.EMP_NAME_KR = #{searchVal})
            </otherwise>
        </choose>
        <if test='arr != null and !"".equals(arr)'>
            AND
            <foreach collection="arr" item="item" separator="OR" open="(" close=")">
                ${item}
            </foreach>
        </if>
        <if test='dsI == "Y" or "Y".equals(dsI)'>
            AND
            TEMP_DIVISION = "Y"
        </if>
        ORDER BY SORT
    </select>

    <select id="getHoliday" parameterType="map" resultType="java.lang.Integer" >
        /*공휴일자 갯수 조회*/
        SELECT
            count(*)
        FROM
            CAM_INSIDE.DJ_HOLIDAY_MANAGEMENT
        WHERE
            H_DAY = DATE_FORMAT(STR_TO_DATE(#{h_day}, '%Y-%m-%d'), '%Y%m%d')
    </select>

    <update id="updateHoliday" parameterType="map">
        /*공휴일 수정*/
        UPDATE
            CAM_INSIDE.DJ_HOLIDAY_MANAGEMENT
        SET
            TITLE = #{title},
            COMP_SEQ = #{comp_seq},
            USE_YN = #{use_yn},
            MODIFY_SEQ = #{loginVO.uniqId},
            MODIFY_DATE = NOW()
        WHERE
            H_DAY = DATE_FORMAT(STR_TO_DATE(#{h_day}, '%Y-%m-%d'), '%Y%m%d')
    </update>

    <insert id="insertHoliday" parameterType="map">
        /*공휴일 삽입*/
        INSERT INTO
            CAM_INSIDE.DJ_HOLIDAY_MANAGEMENT
        (
            H_DAY,
            COMP_SEQ,
            TITLE,
            USE_YN,
            REMARK,
            CREATE_SEQ,
            CREATE_DATE,
            MODIFY_SEQ,
            MODIFY_DATE,
            TITLE_EN,
            TITLE_JP,
            TITLE_CN
        )
        VALUES
            (
                DATE_FORMAT(STR_TO_DATE(#{h_day}, '%Y-%m-%d'), '%Y%m%d'),
                #{comp_seq},
                #{title},
                #{use_yn},
                #{title},
                #{loginVO.uniqId},
                now(),
                #{loginVO.uniqId},
                now(),
                NULL,
                NULL,
                NULL
            )
    </insert>


    <delete id="deleteHoliday" parameterType="java.util.HashMap">
        DELETE
        FROM
            CAM_INSIDE.DJ_HOLIDAY_MANAGEMENT
        WHERE
            H_DAY = DATE_FORMAT(STR_TO_DATE(#{h_day}, '%Y-%m-%d'), '%Y%m%d')
    </delete>

    <!--인사관리 -->
    <select id="getCountForDsA2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND ((DIVISION IN (0)) OR(DIVISION IN (4) AND DIVISION_SUB IN (1, 2)))
    </select>

    <select id="getCountForDsB2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND DIVISION = 3;
    </select>

    <select id="getCountForDsC2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND DIVISION = 1 AND DIVISION_SUB = 6;
    </select>

    <select id="getCountForDsD2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND DIVISION = 4 AND DIVISION_SUB = 3;
    </select>

    <select id="getCountForDsE2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND DIVISION = 10;
    </select>

    <select id="getCountForDsG2" resultType="int" parameterType="java.util.Map">
        SELECT COUNT(*) FROM CAM_HR.DJ_EMP_INFO	AS HEI LEFT JOIN CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ WHERE HEI.ACTIVE = 'Y' AND HEI.WORK_STATUS_CODE = 'Y' AND DIVISION = 2;
    </select>


    <insert id="setSubHolidayByEmpInfo2" parameterType="map">
        INSERT INTO CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        (
            SUBHOLIDAY_CODE_ID,
            APPLY_SEQ,
            SAVE_SEQ,
            SUBHOLIDAY_ST_DT,
            SUBHOLIDAY_EN_DT,
            SUBHOLIDAY_USE_DAY,
            RMK,
            RMK_OTHER,
            APPR_STAT,
            DOC_ID,
            STATUS,
            APPROVAL_REASON,
            APPROVAL_EMP_SEQ,
            APPROVAL_DATE,
            APPROVAL_SEND_DATE,
            SUBHOLIDAY_TARGET_SEQ,
            REG_EMP_SEQ
        )
        VALUES
        (
            #{subHolidayCodeId},
            #{applySeq},
            #{saveSeq},
            #{startDate},
            #{endDate},
            #{useDay},
            #{rmk},
            #{rmkOther},
            'Y',
            'AA',
            'Y',
            #{approvalReason},
            #{approvalEmpSeq},
            DATE_FORMAT(NOW(), '%Y-%m-%d'),
            DATE_FORMAT(NOW(), '%Y-%m-%d'),
            #{subHolidayTargetSeq},
            #{saveSeq}
        )
        <selectKey keyProperty="SUBHOLIDAY_USE_ID" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_INSIDE' AND TABLE_NAME = 'dj_subholiday_use_hist'
        </selectKey>
    </insert>

<!--    이력관리 조회-->
    <select id="getGrantDay" parameterType="map" resultType="map">
        select GRANT_DAY
        from cam_inside.dj_holiday
    </select>

    <select id="getModVacList" parameterType="map" resultType="map">
        SELECT
            HH.*,
            HEI.EMP_NAME_KR,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
            CASE WHEN HEI.DUTY_NAME IS NULL OR HEI.DUTY_NAME = "" THEN HEI.POSITION_NAME ELSE HEI.DUTY_NAME END AS SPOT,
            REI.EMP_NAME_KR AS REG_EMP_NAME
        FROM
            CAM_INSIDE.DJ_HOLIDAY_HIST HH
        LEFT JOIN
            CAM_INSIDE.DJ_HOLIDAY H ON HH.HOLIDAY_ID = H.HOLIDAY_ID
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO HEI ON H.EMP_SEQ = HEI.EMP_SEQ
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO REI ON HH.REG_EMP_SEQ = REI.EMP_SEQ
        WHERE 1=1
        <![CDATA[
            AND
                DATE_FORMAT(#{startDt}, '%Y%m%d') <= DATE_FORMAT(HH.MOD_DT, '%Y%m%d')
            AND
                DATE_FORMAT(#{endDt}, '%Y%m%d') >= DATE_FORMAT(HH.MOD_DT, '%Y%m%d')
        ]]>
        <if test='searchVal != null and !"".equals(searchVal)'>
            AND HEI.EMP_NAME_KR LIKE CONCAT('%', #{searchVal}, '%')
        </if>
        ORDER BY HH.HOLIDAY_HIST_SN DESC
    </select>

    <update id="workHolidayReqApp" parameterType="map">
        /* updateApprStat */
        UPDATE
            CAM_INSIDE.DJ_HOLIDAY_WORK_MASTER
        SET
            STATUS = #{approveStatCode},
            APPROVAL_DATE = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            APPROVAL_EMP_SEQ = #{empSeq},
            DOC_ID = #{docId}
        WHERE
            HOLIDAY_WORK_MASTER_SN = #{holidayWorkMasterSn}
    </update>

    <update id="workHolidayReqAdminApp" parameterType="map">
        /* workHolidayReqAdminApp */
        UPDATE
            CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            ADMIN_APPR_STAT = #{adminStatus},
            APPROVAL_SEND_DATE = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            APPROVAL_EMP_SEQ = #{empSeq},
            ADMIN_DOC_ID = #{docId}
        WHERE
            SUBHOLIDAY_USE_ID = #{subholidayUseId}
    </update>

    <delete id="setDocReaderReset" parameterType="map">
        /*setDocReaderReset*/
        DELETE FROM DJ_CAMTIC.A_DOC_READER WHERE DOC_ID = #{docId}
    </delete>

    <select id="getDocInfo" parameterType="map" resultType="map">
        /*getDocInfo*/
        SELECT
            *
        FROM
            DJ_CAMTIC.A_DOC_INFO
        WHERE
            APPRO_KEY = #{approKey}
    </select>

    <update id="delYn" parameterType="map">
        /*delYn*/
        UPDATE CAM_INSIDE.DJ_SUBHOLIDAY_USE_HIST
        SET
            DEL_YN = 'Y'
        WHERE
            SUBHOLIDAY_USE_ID = #{subHolidayUseId}
    </update>
</mapper>