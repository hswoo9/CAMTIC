<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="manage">

    <select id="getMemList" parameterType="map" resultType="map">
        /*getClientList*/
        SELECT
            *
        FROM CAM_HR.DJ_EMP_INFO
        WHERE
            (EMP_NAME_KR LIKE CONCAT('%', #{searchValue}, '%') OR ACCOUNT_NUM LIKE CONCAT('%', #{searchValue}, '%') OR RES_REGIS_NUM LIKE CONCAT('%', #{searchValue}, '%'))
    </select>

    <select id="getProjectData" parameterType="map" resultType="map">
        /*getProjectData*/
        SELECT
            A.*,
            DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i') as PJT_REG_DT
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        WHERE
            A.PJT_CD = #{PJT_CD}
        LIMIT 1
    </select>

    <select id="getEmpInfo" parameterType="map" resultType="map">
        /*getEmpInfo*/
        SELECT
            *
        FROM
            CAM_HR.DJ_EMP_INFO
        WHERE
            EMP_SEQ = #{sn}
    </select>

    <select id="getUserPartRateInfo" parameterType="map" resultType="map">
        /*getUserPartRateInfo*/
        SELECT
            C.PJT_SN,
            A.CHNG_SAL,
            A.MON_SAL,
            A.PART_DET_STR_DT,
            A.PART_DET_END_DT,
            (SELECT LG_CD_NM FROM CAM_PJT_MNG.DJ_PJT_CD WHERE LG_CD = C.SBJ_DEP AND GRP_SN = 'SUP_DEP' LIMIT 1) AS SBJ_DEP_NM,
            C.PJT_NM,
            DATE_FORMAT(C.END_DT, '%Y-%m-%d') AS PJT_END_DT,
            C.PM_EMP_SEQ,
            C.SBJ_STAT_YN,
            A.TOT_RATE
        FROM
            CAM_PJT_MNG.DJ_PART_RATE_DET A
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_PART_RATE_VER B
        ON
            A.PART_RATE_VER_SN = B.PART_RATE_VER_SN
        LEFT JOIN
            CAM_PJT_MNG.DJ_PROJECT C
        ON
            B.PJT_SN = C.PJT_SN
        WHERE
            B.MNG_STAT = 'C'
        AND
            B.BEF_VER_CHECK = 'Y'
        AND
            A.PART_EMP_SEQ = #{empSeq}
        <if test='strDe != null and "".equals(strDe)'>
        <![CDATA[
            AND
                C.STR_DT >= #{strDe}
        ]]>
        </if>

    </select>

    <select id="getUserSalList" parameterType="map" resultType="map">
        /*getUserSalList*/
        SELECT *
        FROM
            CAM_MNG.V_BS_SALARY
        WHERE
            EMP_SEQ = #{empSeq}
        <![CDATA[
        AND
            START_DT <= #{strMonth} AND END_DT >= #{strMonth}
        ]]>
    </select>

    <select id="checkExnpDetData" parameterType="map" resultType="map">
        /*checkExnpDetData*/
        SELECT
            *
        FROM
            CAM_MNG.DJ_PAY_APP_DET
        WHERE
            PAY_APP_DET_SN = #{payAppDetSn}
    </select>

    <insert id="insCorpProject" parameterType="map">
        /*insCorpProject*/
        INSERT INTO CAM_PJT_MNG.DJ_CORP_PROJECT
        (
            PM_EMP_SEQ,
            PM_EMP_NAME,
            PM_DEPT_SEQ,
            PM_DEPT_NAME,
            LINK_PJT,
            CORP_PJT_NM,
            CORP_PJT_SUB_NM,
            STR_DT,
            END_DT,
            SBJ_SEP,
            REG_EMP_SEQ
        ) VALUES (
            #{empSeq},
            #{empName},
            #{deptSeq},
            #{deptName},
            #{linkPjt},
            #{pjtNm},
            #{pjtSubNm},
            #{strDt},
            #{endDt},
            #{sbjSep},
            #{regEmpSeq}
        )
        <selectKey keyProperty="corpPjtSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_CORP_PROJECT'
        </selectKey>
    </insert>

    <select id="getCorpProjectList" parameterType="map" resultType="map">
        /*getCorpProjectList*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_CORP_PROJECT
    </select>

    <select id="getCorpProjectData" parameterType="map" resultType="map">
        /*getCorpProjectData*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_CORP_PROJECT
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </select>

    <update id="updCorpProject" parameterType="map">
        /*updCorpProject*/
        UPDATE
            CAM_PJT_MNG.DJ_CORP_PROJECT
        SET
            PM_EMP_SEQ = #{empSeq},
            PM_EMP_NAME = #{empName},
            PM_DEPT_SEQ = #{deptSeq},
            PM_DEPT_NAME = #{deptName},
            LINK_PJT = #{linkPjt},
            CORP_PJT_NM = #{pjtNm},
            CORP_PJT_SUB_NM = #{pjtSubNm},
            STR_DT = #{strDt},
            END_DT = #{endDt},
            SBJ_SEP = #{sbjSep},
            MOD_EMP_SEQ = #{regEmpSeq}
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </update>

    <insert id="insIncmExpInfo" parameterType="map">
        /* insIncmExpInfo */
        INSERT INTO CAM_MNG.DJ_PROJECT_BUDGET_MNG
        (
            PJT_CD,
            BGT_CD,
            BGT_AT,
            BGT1_NM,
            BGT2_NM,
            BGT3_NM,
            CALC_AM,
            REG_EMP_SEQ,
            REG_DATE
        )
        VALUES
        <foreach collection="list" item="item" separator=",">
        (
            #{item.pjtCd},
            #{item.bgtCd},
            #{item.bgtAt},
            #{item.bgt1Nm},
            #{item.bgt2Nm},
            #{item.bgt3Nm},
            #{item.calcAm},
            #{item.regEmpSeq},
            NOW()
        )
        </foreach>
    </insert>

    <select id="getProjectBgtList" parameterType="map" resultType="map">
        /* getProjectBgtList */
        SELECT
            PJT_CD,
            BGT_CD,
            BGT_AT,
            BGT1_NM,
            BGT2_NM,
            BGT3_NM AS BGT_NM,
            CALC_AM
        FROM
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        WHERE
            PJT_CD = #{pjtSn}
        AND
            ACTIVE = 'Y'
    </select>

    <select id="getProjectBgtCheck" parameterType="map" resultType="int">
        /* getProjectBgtCheck */
        SELECT
            COUNT(*)
        FROM
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        WHERE
            PJT_CD = #{pjtCd}
        AND
            ACTIVE = 'Y'
    </select>

    <update id="incmExpInfoActiveN" parameterType="map">
        /* incmExpInfoActiveN */
        UPDATE
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        SET
            ACTIVE = 'N'
        WHERE
            PJT_CD = #{pjtCd}
    </update>

    <delete id="delDjCardList" parameterType="map">
        /*delDjCardList*/
        DELETE FROM CAM_MNG.DJ_CARD_INFO
    </delete>

    <insert id="insDjCardList" parameterType="java.util.List">
        /*insDjCardList*/
        INSERT INTO CAM_MNG.DJ_CARD_INFO(CLTTR_CD, TR_CD, JIRO_NM, BA_NB, DEPOSITOR, TR_NM, CARD_BA_NB)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (
                #{item.TR_CD},
                #{item.TR_CD},
                #{item.JIRO_NM},
                #{item.BA_NB},
                #{item.DEPOSITOR},
                #{item.TR_NM},
                #{item.CARD_BA_NB}
            )
        </foreach>

    </insert>
</mapper>