<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="manage">

    <select id="getMemList" parameterType="map" resultType="map">
        /*getClientList*/
        SELECT
            *
        FROM CAM_HR.DJ_EMP_INFO
        WHERE
            (EMP_NAME_KR LIKE CONCAT('%', #{searchValue}, '%') OR ACCOUNT_NUM LIKE CONCAT('%', #{searchValue}, '%') OR RES_REGIS_NUM LIKE CONCAT('%', #{searchValue}, '%'))
    </select>

    <select id="getProjectData" parameterType="map" resultType="map">
        /*getProjectData*/
        SELECT
            A.*,
            DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i') as PJT_REG_DT
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        WHERE
            A.PJT_CD = #{PJT_CD}
        LIMIT 1
    </select>

    <select id="getEmpInfo" parameterType="map" resultType="map">
        /*getEmpInfo*/
        SELECT
            *
        FROM
            CAM_HR.DJ_EMP_INFO
        WHERE
            EMP_SEQ = #{sn}
    </select>

    <select id="getUserPartRateInfo" parameterType="map" resultType="map">
        /*getUserPartRateInfo*/
        SELECT
            C.PJT_SN,
            A.CHNG_SAL,
            A.MON_SAL,
            A.TOT_RATE,
            A.PAY_RATE,
            A.ITEM_RATE,
            A.PART_DET_STR_DT,
            A.PART_DET_END_DT,
            (SELECT LG_CD_NM FROM CAM_PJT_MNG.DJ_PJT_CD WHERE LG_CD = C.SBJ_DEP AND GRP_SN = 'SUP_DEP' LIMIT 1) AS SBJ_DEP_NM,
            B.MNG_STAT,
            C.PJT_NM,
            DATE_FORMAT(C.END_DT, '%Y-%m-%d') AS PJT_END_DT,
            C.PM_EMP_SEQ,
            C.SBJ_STAT_YN,
            C.PJT_STEP,
            C.PJT_STEP_NM,
            (select cm_code_nm from cam_common.dj_com_code a left join cam_common.dj_com_group_code b on a.cm_group_code_id = b.cm_group_code_id where b.cm_group_code_id = 36 and cm_code = C.SBJ_CLASS) AS subClassText
        FROM
            CAM_PJT_MNG.DJ_PART_RATE_DET A
        LEFT JOIN
            CAM_PJT_MNG.DJ_PJT_PART_RATE_VER B
        ON
            A.PART_RATE_VER_SN = B.PART_RATE_VER_SN
        LEFT JOIN
            CAM_PJT_MNG.DJ_PROJECT C
        ON
            B.PJT_SN = C.PJT_SN
        WHERE
            1=1
        AND
            A.PART_EMP_SEQ = #{empSeq}
        <if test='strDe != null and !"".equals(strDe)'>
        <![CDATA[
            AND
                #{strDe} between YEAR(A.PART_DET_STR_DT) and YEAR(A.PART_DET_END_DT)
        ]]>
        </if>
        AND
            (C.PJT_SN, B.PART_RATE_VER) IN
            (
                SELECT PJT_SN, MAX(PART_RATE_VER) AS PART_RATE_VER
                FROM
                    CAM_PJT_MNG.DJ_PJT_PART_RATE_VER
                WHERE
                    MNG_STAT != 'R'
                GROUP BY PJT_SN
            )
        AND
            C.PJT_STOP != 'Y'
    </select>

    <select id="getUserSalList" parameterType="map" resultType="map">
        /*getUserSalList*/
        SELECT *
        FROM
            CAM_MNG.V_BS_SALARY
        WHERE
            EMP_SEQ = #{empSeq}
        <![CDATA[
        AND
            START_DT <= #{strMonth} AND END_DT >= #{strMonth}
        ]]>
    </select>

    <select id="checkExnpDetData" parameterType="map" resultType="map">
        /*checkExnpDetData*/
        SELECT
            *
        FROM
            CAM_MNG.DJ_PAY_APP_DET
        WHERE
            PAY_APP_DET_SN = #{payAppDetSn}
    </select>

    <insert id="insCorpProject" parameterType="map">
        /*insCorpProject*/
        INSERT INTO CAM_PJT_MNG.DJ_CORP_PROJECT
        (
            PM_EMP_SEQ,
            PM_EMP_NAME,
            PM_DEPT_SEQ,
            PM_DEPT_NAME,
            LINK_PJT,
            CORP_PJT_NM,
            CORP_PJT_SUB_NM,
            STR_DT,
            END_DT,
            SBJ_SEP,
            REG_EMP_SEQ,
            PROFIT_CODE
        ) VALUES (
            #{empSeq},
            #{empName},
            #{deptSeq},
            #{deptName},
            #{linkPjt},
            #{pjtNm},
            #{pjtSubNm},
            #{strDt},
            #{endDt},
            #{sbjSep},
            #{regEmpSeq},
            #{profitCode}
        )
        <selectKey keyProperty="corpPjtSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_PJT_MNG' AND TABLE_NAME = 'DJ_CORP_PROJECT'
        </selectKey>
    </insert>

    <select id="getCorpProjectList" parameterType="map" resultType="map">
        /*getCorpProjectList*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_CORP_PROJECT
    </select>

    <select id="getCorpProjectListMng" parameterType="map" resultType="map">
        /*getCorpProjectListMng*/
        SELECT
            *
        FROM (
            SELECT
                A.PJT_SN AS PJT_SN,
                A.BUSN_CLASS AS BUSN_CLASS,
                A.BUSN_NM AS BUSN_NM,
                A.PJT_TMP_CD AS PJT_TMP_CD,
                A.PJT_NM AS PJT_NM,
                B.PJT_STR_DT AS STR_DT,
                B.PJT_END_DT AS END_DT,
                A.DELV_APPROVE_STAT AS STATUS,
                A.EMP_NAME AS ENGN_PM_NM,
                A.EMP_NAME AS PM_NM,
                DATE_FORMAT(CASE WHEN A.BUSN_CLASS = 'R' THEN C.APPROVAL_DATE
                     WHEN A.BUSN_CLASS = 'S' THEN D.APPROVAL_DATE
                     WHEN A.BUSN_CLASS = 'D' THEN B.APPROVAL_DATE
                     WHEN A.BUSN_CLASS = 'V' THEN B.APPROVAL_DATE
                END, '%Y-%m-%d') AS REG_DATE
            FROM
                CAM_PJT_MNG.DJ_PROJECT A
            LEFT JOIN
                CAM_PJT_MNG.DJ_PJT_DELV B ON A.PJT_SN = B.PJT_SN
            LEFT JOIN
                CAM_PJT_MNG.DJ_PJT_RND C ON A.PJT_SN = C.PJT_SN
            LEFT JOIN
                CAM_PJT_MNG.DJ_PJT_UNRND D ON A.PJT_SN = D.PJT_SN
            WHERE A.DELV_APPROVE_STAT = '10'
            AND (B.STATUS = '100' || C.STATUS = '100' || D.STATUS = '100')

            UNION ALL

            SELECT
                CORP_PJT_SN AS PJT_SN,
                'M' AS BUSN_CLASS,
                '법인' AS BUSN_NM,
                CORP_PJT_CD AS PJT_TMP_CD,
                CORP_PJT_NM AS PJT_NM,
                STR_DT AS STR_DT,
                END_DT AS END_DT,
                STATUS AS STATUS,
                PM_EMP_NAME AS ENGN_PM_NM,
                PM_EMP_NAME AS PM_NM,
                ''
            FROM
                CAM_PJT_MNG.DJ_CORP_PROJECT
            WHERE STATUS = '10'
        )A
        ORDER BY A.REG_DATE DESC, A.PJT_SN DESC
    </select>

    <select id="getCorpProjectData" parameterType="map" resultType="map">
        /*getCorpProjectData*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_CORP_PROJECT
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </select>

    <update id="updCorpProject" parameterType="map">
        /*updCorpProject*/
        UPDATE
            CAM_PJT_MNG.DJ_CORP_PROJECT
        SET
            PM_EMP_SEQ = #{empSeq},
            PM_EMP_NAME = #{empName},
            PM_DEPT_SEQ = #{deptSeq},
            PM_DEPT_NAME = #{deptName},
            LINK_PJT = #{linkPjt},
            CORP_PJT_NM = #{pjtNm},
            CORP_PJT_SUB_NM = #{pjtSubNm},
            STR_DT = #{strDt},
            END_DT = #{endDt},
            SBJ_SEP = #{sbjSep},
            MOD_EMP_SEQ = #{regEmpSeq},
            PROFIT_CODE = #{profitCode}
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </update>

    <insert id="insIncmExpInfo" parameterType="map">
        /* insIncmExpInfo */
        INSERT INTO CAM_MNG.DJ_PROJECT_BUDGET_MNG
        (
            PJT_CD,
            BGT_CD,
            BGT_AT,
            BGT1_NM,
            BGT2_NM,
            BGT3_NM,
            CALC_AM,
            REG_EMP_SEQ,
            REG_DATE
        )
        VALUES
        <foreach collection="list" item="item" separator=",">
        (
            #{item.pjtCd},
            #{item.bgtCd},
            #{item.bgtAt},
            #{item.bgt1Nm},
            #{item.bgt2Nm},
            #{item.bgt3Nm},
            #{item.calcAm},
            #{item.regEmpSeq},
            NOW()
        )
        </foreach>
    </insert>

    <select id="getProjectBgtList" parameterType="map" resultType="map">
        /* getProjectBgtList */
        SELECT
            PJT_CD,
            BGT_CD,
            BGT_AT,
            BGT1_NM,
            BGT2_NM,
            BGT3_NM AS BGT_NM,
            CALC_AM
        FROM
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        WHERE
            PJT_CD = #{pjtSn}
        AND
            ACTIVE = 'Y'
    </select>

    <select id="getProjectBgtCheck" parameterType="map" resultType="int">
        /* getProjectBgtCheck */
        SELECT
            COUNT(*)
        FROM
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        WHERE
            PJT_CD = #{pjtCd}
        AND
            ACTIVE = 'Y'
    </select>

    <update id="incmExpInfoActiveN" parameterType="map">
        /* incmExpInfoActiveN */
        UPDATE
            CAM_MNG.DJ_PROJECT_BUDGET_MNG
        SET
            ACTIVE = 'N'
        WHERE
            PJT_CD = #{pjtCd}
    </update>

    <delete id="delDjCardList" parameterType="map">
        /*delDjCardList*/
        DELETE FROM CAM_MNG.DJ_CARD_INFO
    </delete>

    <insert id="insDjCardList" parameterType="java.util.List">
        /*insDjCardList*/
        INSERT INTO CAM_MNG.DJ_CARD_INFO(CLTTR_CD, TR_CD, JIRO_NM, BA_NB, DEPOSITOR, TR_NM, CARD_BA_NB)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (
                #{item.TR_CD},
                #{item.TR_CD},
                #{item.JIRO_NM},
                #{item.BA_NB},
                #{item.DEPOSITOR},
                #{item.TR_NM},
                #{item.CARD_BA_NB}
            )
        </foreach>

    </insert>

    <update id="setRequest" parameterType="map">
        /*setRequest*/
        UPDATE
            CAM_PJT_MNG.DJ_CORP_PROJECT
        SET
            CORP_PJT_CD = #{pjtCd},
            STATUS = #{status}
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </update>

    <update id="setApprove" parameterType="map">
        /*setApprove*/
        UPDATE
            CAM_PJT_MNG.DJ_CORP_PROJECT
        SET
            STATUS = #{status}
        WHERE
            CORP_PJT_SN = #{corpPjtSn}
    </update>

    <insert id="setManageDepo" parameterType="map">
        INSERT INTO CAM_MNG.DJ_DEPO_SETTING
            (FR_PJT_SN, PJT_CD, PJT_NM, BUDGET_SN, BUDGET_NM, REG_EMP_SEQ)
        VALUES
            (#{frPjtSn}, #{aftPjtCd}, #{aftPjtNm}, #{budgetSn}, #{budgetNm}, #{regEmpSeq})
    </insert>

    <update id="updateManageDepo" parameterType="map">
        UPDATE CAM_MNG.DJ_DEPO_SETTING
        SET
            PJT_CD = #{aftPjtCd},
            PJT_NM = #{aftPjtNm},
            BUDGET_SN = #{budgetSn},
            BUDGET_NM = #{budgetNm},
            MOD_DT = NOW(),
            MOD_EMP_SEQ = #{regEmpSeq}
        WHERE
            FR_PJT_SN = #{frPjtSn}
    </update>

    <select id="chkManageDepo" parameterType="map" resultType="int">
        SELECT
            COUNT(*)
        FROM
            CAM_MNG.DJ_DEPO_SETTING
        WHERE
            FR_PJT_SN = #{frPjtSn}
    </select>

    <select id="getManageDepo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_MNG.DJ_DEPO_SETTING
        WHERE
            FR_PJT_SN = #{frPjtSn}
    </select>

    <select id="getExnpDeChangeRs" parameterType="map" resultType="map">
        /*getExnpDeChangeRs*/
        SELECT
            *
        FROM
            CAM_MNG.DJ_EXNP_CHNG_RS
        WHERE
            1 = 1
        <if test='type == null or "".equals(type)'>
            AND
                USE_YN = 'Y'
        </if>
    </select>

    <insert id="insExnpDeChangeRs" parameterType="map" >
        /*insExnpDeChangeRs*/
        INSERT INTO CAM_MNG.DJ_EXNP_CHNG_RS
        (
            TITLE,
            USE_YN
        )
        VALUES
        (
            #{title},
            #{useYn}
        )
    </insert>

    <update id="updExnpDeChangeRs" parameterType="map">
        /*updExnpDeChangeRs*/
        UPDATE CAM_MNG.DJ_EXNP_CHNG_RS
        SET
            TITLE = #{title},
            USE_YN = #{useYn}
        WHERE
            CHNG_RS_SN = #{chngRsSn}
    </update>

    <delete id="delExnpDeChangeRs" parameterType="map">
        /*delExnpDeChangeRs*/
        DELETE FROM CAM_MNG.DJ_EXNP_CHNG_RS
        WHERE
            CHNG_RS_SN = #{chngRsSn}
    </delete>

    <select id="getEtaxList" parameterType="map" resultType="map">
        /* MariaDB  -  getEtaxList*/
        SELECT
            A.ISS_NO, A.CO_CD, A.DIV_CD, A.TR_CD, A.ISS_DT, A.TAX_TY, A.ISU_DT, A.DIVREG_NB, A.DIVSUB_NB, A.DIV_NM,
            A.DIVCEO_NM, A.TRREG_NB, A.TRSUB_NB, A.TR_NM, A.TRCEO_NM,
            CAST(A.SUM_AM AS INT) AS SUM_AM,
            CAST(A.SUP_AM AS INT) AS SUP_AM,
            CAST(A.VAT_AM AS INT) AS VAT_AM,
            A.ETAX_TY, A.ETAX_FG,
            A.SEND_FG, A.DUMMY1, A.DUMMY2, A.ISS_YMD, A.ITEM_DC, A.ADDTAX_CD, A.ADDTAX_AM, A.ADDRTE_RT, A.EMAIL_DC, A.TRCHARGE_EMAIL,
            A.INSERT_DT, A.ST_TR_CD, A.TR_FG, A.REG_NB, A.CEO_NM, A.BUSINESS, A.JONGMOK, A.ZIP, A.DIV_ADDR1, A.ADDR2,
            A.TEL, A.FAX, A.BA_NB, A.INTER_DT, A.LIQ_WS, A.LIQ_RS, A.USE_YN, A.CLTTR_CD, A.JIRO_CD, A.DEPOSITOR,
            A.TR_NMK, A.ATTR_NMK, A.BA_NB_TR, A.AREA_CD, A.GUGUN_CD, A.BANK_NM,
            B.*
        FROM
            CAM_MNG.DJ_ETAX_INFO A
        LEFT JOIN
            CAM_MNG.DJ_USE_ETAX_INFO B
        ON
            A.ISS_NO = B.ISS_NO AND A.CO_CD = B.CO_CD AND A.TAX_TY = B.TAX_TY
        WHERE
        ISU_DT BETWEEN #{strDt} AND #{endDt}
        <if test='type == 1 or "1".equals(type)'>
            AND
                A.TAX_TY = '2'
        </if>
        <if test='type == 2 or "2".equals(type)'>
            AND
                A.TAX_TY = '4'
        </if>
        <if test='searchValue != null and !"".equals("searchValue")'>
            AND
                A.TR_NM LIKE CONCAT('%', #{searchValue} , '%')
        </if>
        AND
            B.USE_ETAX_SN IS NULL
        ORDER BY A.ISU_DT DESC
    </select>

    <delete id="delDjEtax" parameterType="map">
        /*delDjEtax*/
        DELETE FROM CAM_MNG.DJ_ETAX_INFO
        WHERE
            ISS_YMD BETWEEN #{strDate} AND #{endDate}
    </delete>

    <insert id="insDjEtaxUp" parameterType="list">
        /*insDjEtaxUp*/
        INSERT INTO CAM_MNG.DJ_ETAX_INFO
            (
                ISS_NO, CO_CD, DIV_CD, TR_CD, ISS_DT, TAX_TY, ISU_DT, DIVREG_NB, DIVSUB_NB, DIV_NM,
                DIVCEO_NM, TRREG_NB, TRSUB_NB, TR_NM, TRCEO_NM, SUM_AM, SUP_AM, VAT_AM,
                ETAX_TY, ETAX_FG, SEND_FG, DUMMY1, DUMMY2, ISS_YMD, ITEM_DC, ADDTAX_CD, ADDTAX_AM,
                ADDRTE_RT, EMAIL_DC, TRCHARGE_EMAIL, INSERT_DT,
                ST_TR_CD, TR_FG, REG_NB, CEO_NM, BUSINESS, JONGMOK, ZIP, DIV_ADDR1, ADDR2,
                TEL, FAX, BA_NB, INTER_DT, LIQ_WS, LIQ_RS, USE_YN, CLTTR_CD, JIRO_CD, DEPOSITOR,
                TR_NMK, ATTR_NMK, BA_NB_TR, AREA_CD, GUGUN_CD,
                BANK_NM
            )
        VALUES
        <foreach collection="list" item="item" separator=",">
              (
                #{item.ISS_NO}, #{item.CO_CD}, #{item.DIV_CD}, #{item.TR_CD}, #{item.ISS_DT}, #{item.TAX_TY}, #{item.ISU_DT}, #{item.DIVREG_NB}, #{item.DIVSUB_NB}, #{item.DIV_NM},
                #{item.DIVCEO_NM}, #{item.TRREG_NB}, #{item.TRSUB_NB}, #{item.TR_NM}, #{item.TRCEO_NM}, #{item.SUM_AM}, #{item.SUP_AM}, #{item.VAT_AM},
                #{item.ETAX_TY}, #{item.ETAX_FG}, #{item.SEND_FG}, #{item.DUMMY1}, #{item.DUMMY2}, #{item.ISS_YMD}, #{item.ITEM_DC}, #{item.ADDTAX_CD}, #{item.ADDTAX_AM},
                #{item.ADDRTE_RT}, #{item.EMAIL_DC}, #{item.TRCHARGE_EMAIL}, #{item.INSERT_DT},
                #{item.ST_TR_CD}, #{item.TR_FG}, #{item.REG_NB}, #{item.CEO_NM}, #{item.BUSINESS}, #{item.JONGMOK}, #{item.ZIP}, #{item.DIV_ADDR1}, #{item.ADDR2},
                #{item.TEL}, #{item.FAX}, #{item.BA_NB}, #{item.INTER_DT}, #{item.LIQ_WS}, #{item.LIQ_RS}, #{item.USE_YN}, #{item.CLTTR_CD}, #{item.JIRO_CD}, #{item.DEPOSITOR},
                #{item.TR_NMK}, #{item.ATTR_NMK}, #{item.BA_NB_TR}, #{item.AREA_CD}, #{item.GUGUN_CD},
                #{item.BANK_NM}
              )
        </foreach>
    </insert>

    <select id="getEtaxListAll" parameterType="map" resultType="map">
        /*getEtaxListAll*/
        SELECT
            A.*,
            B.*,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = (SELECT REG_EMP_SEQ FROM CAM_MNG.DJ_PAY_APP WHERE PAY_APP_SN = B.PAY_APP_SN)) AS PAY_EMP_SEQ,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = (SELECT EMP_SEQ FROM CAM_MNG.DJ_CLAIM_EXNP WHERE CE_GW_IDX = B.CE_GW_IDX AND PAY_APP_SN IS NULL)) AS PURC_EMP_SEQ,
            (SELECT DATE_FORMAT(REG_DT, '%Y-%m-%d') FROM CAM_MNG.DJ_PAY_APP WHERE PAY_APP_SN = B.PAY_APP_SN) AS PAY_REG_DT,
            (SELECT DATE_FORMAT(REG_DATE, '%Y-%m-%d') FROM CAM_MNG.DJ_CLAIM_EXNP WHERE CE_GW_IDX = B.CE_GW_IDX AND PAY_APP_SN IS NULL) AS CLAIM_EXNP_REG_DT,
            (SELECT DOC_STATUS FROM CAM_MNG.DJ_EXNP WHERE PAY_APP_SN = (SELECT PAY_APP_SN FROM CAM_MNG.DJ_PAY_APP WHERE PAY_APP_SN = B.PAY_APP_SN) LIMIT 1) AS PAY_EXNP_STAT
        FROM
            CAM_MNG.DJ_ETAX_INFO A
        LEFT JOIN
            (SELECT *
            FROM
            CAM_MNG.DJ_USE_ETAX_INFO
            GROUP BY ISS_NO) B
        ON
            A.ISS_NO = B.ISS_NO AND A.CO_CD = B.CO_CD AND A.TAX_TY = B.TAX_TY
        WHERE
            1 = 1
            <if test='crmNm != null and !"".equals(crmNm)'>
                AND
                TR_NM LIKE CONCAT('%', #{crmNm} , '%')
            </if>
            <if test='crmNo != null and !"".equals(crmNo)'>
                AND
                TRREG_NB LIKE CONCAT('%', #{crmNo} , '%')
            </if>
            <if test='dtGubun == "a" or "a".equals(dtGubun)'>
                AND
                ISS_DT BETWEEN #{strDt} AND #{endDt}
            </if>
            <if test='dtGubun == "b" or "b".equals(dtGubun)'>
                AND
                ISU_DT BETWEEN #{strDt} AND #{endDt}
            </if>
            <if test='dtGubun == "c" or "c".equals(dtGubun)'>
                AND
                ISS_YMD BETWEEN #{strDt} AND #{endDt}
            </if>

            <if test='type == 1 or "1".equals(type)'>
                AND
                    A.TAX_TY = '2'
            </if>
            <if test='type == 2 or "2".equals(type)'>
                AND
                    A.TAX_TY = '4'
            </if>
            <if test='searchValue != null and !"".equals("searchValue")'>
                AND
                    A.TR_NM LIKE CONCAT('%', #{searchValue} , '%')
            </if>
            <if test='viewType != null and !"".equals(viewType) and "payment".equals(viewType)'>
                AND B.USE_ETAX_SN IS NULL
            </if>
        ORDER BY A.ISS_DT DESC
    </select>

    <select id="getUserAccountManagementList" parameterType="map" resultType="map">
        SELECT
        HEI.*,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_SEQ END AS DEPT_SEQ,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME1,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_SEQ ELSE "" END AS TEAM_SEQ,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
        DATE_FORMAT(HEI.JOIN_DAY,'%Y-%m-%d') AS JOIN_DAY2,
        IFNULL(CASE WHEN HEI.DUTY_NAME = "" THEN HEI.POSITION_NAME ELSE HEI.DUTY_NAME END, "") AS SPOT,

        CASE WHEN HEI.DUTY_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 3 AND CM_CODE = HEI.DUTY_CODE)
        WHEN HEI.POSITION_CODE IS NOT NULL THEN (SELECT SORT FROM CAM_COMMON.dj_com_code WHERE CM_GROUP_CODE_ID = 4 AND CM_CODE = HEI.POSITION_CODE)
        ELSE 999 END SORT

        FROM
        CAM_HR.DJ_EMP_INFO	AS HEI
        LEFT JOIN
        CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE
        HEI.ACTIVE = 'Y'
        AND HEI.ERP_EMP_SEQ != ''
        AND HEI.WORK_STATUS_CODE = 'Y'
        <if test='userGender != null and !"".equals(userGender)'>
            AND
            HEI.GENDER_CODE = #{userGender}
        </if>
        AND
        ${userKind} like concat('%', #{kindContent} ,'%')
        <if test='deptComp != null and !"".equals(deptComp)'>
            AND
            HEI.DEPT_SEQ = #{deptComp}
            <if test='deptTeam == deptTeam or "".equals(deptTeam)'>
                OR
                HEI.DEPT_SEQ IN (
                SELECT
                DEPT_SEQ
                FROM
                CAM_HR.DJ_DEPT_INFO
                WHERE
                DEPT_SEQ = #{deptComp}
                OR
                PARENT_DEPT_SEQ = #{deptComp}
                )
            </if>
        </if>
        <if test='deptTeam != null and !"".equals(deptTeam)'>
            AND
            HEI.DEPT_SEQ = #{deptTeam}
        </if>
        ORDER BY SORT
    </select>

    <select id="getApproveExnpList" parameterType="map" resultType="map">
        /*getApproveExnpList*/
        SELECT
            *
        FROM
            CAM_MNG.DJ_EXNP
        WHERE
        <![CDATA[
            DT3 <= now()
        AND RE_STAT = 'N'
        AND PAY_APP_TYPE = 1
        ]]>
    </select>

    <select id="getAccountInfoOne" parameterType="map" resultType="map">
        /*getAccountInfoOne*/
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_ACCOUNT_INFO
        WHERE
            ACCOUNT_TO_SN = #{accountToSn}
    </select>

    <select id="getCurrentAmountStatus" parameterType="map" resultType="map">
        /*getCurrentAmountStatus*/
        SELECT * FROM CAM_HR.ERP_HIST_ACCT_CONSOL_TR WHERE ACCT_NO = #{bankNB} ORDER BY ACCT_TXDAY DESC, ACCT_TXTIME DESC, ACCT_TXDAY_SEQ DESC LIMIT 1
    </select>

    <select id="getBudgetDetailViewData" parameterType="map" resultType="map">
        /*getBudgetDetailViewData*/
        SELECT
            A.PAY_APP_SN,
            A.BUDGET_SN,
            A.BUDGET_NM,
            B.PAY_APP_TYPE,
            B.APP_TITLE,
            B.APP_CONT,
            B.REQ_DE,
            (SELECT SUM(TOT_COST) FROM CAM_MNG.DJ_PAY_APP_DET S WHERE S.PAY_APP_SN = B.PAY_APP_SN AND S.DET_STAT != 'N') AS TOT_COST,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO HR WHERE HR.EMP_SEQ = B.REG_EMP_SEQ) AS EMP_NAME,
            B.REVERT_YN,
            B.DOC_STATUS,
            (SELECT COUNT(*) FROM CAM_MNG.DJ_PAY_APP_DET S WHERE S.PAY_APP_SN = B.PAY_APP_SN) AS ITEM_COUNT,
            (SELECT COUNT(*) FROM CAM_MNG.DJ_PAY_APP_DET S WHERE S.PAY_APP_SN = B.PAY_APP_SN AND EXNP_SAVE = 'Y') AS EXNP_STATUS,
            (SELECT COUNT(*) FROM CAM_MNG.DJ_EXNP_DET X LEFT JOIN CAM_MNG.DJ_EXNP Y ON X.EXNP_SN = Y.EXNP_SN WHERE Y.PAY_APP_SN = B.PAY_APP_SN AND Y.REQ_END_DE IS NOT NULL AND Y.REQ_END_DE != '') AS EXNP_DOC_STATUS,
            (SELECT RE_STAT FROM CAM_MNG.DJ_EXNP WHERE PAY_APP_SN = B.PAY_APP_SN ORDER BY EXNP_SN DESC LIMIT 1) AS RE_STAT,
            (SELECT DOC_STATUS FROM CAM_MNG.DJ_EXNP S WHERE S.PAY_APP_SN = B.PAY_APP_SN AND S.REQ_END_DE IS NOT NULL AND S.REQ_END_DE != '' ORDER BY S.EXNP_SN DESC LIMIT 1) AS EXNP_DOC_STATUS2,
            B.ORG_YN,
            B.INFO_CODE
        FROM CAM_MNG.DJ_PAY_APP_DET A
        LEFT JOIN CAM_MNG.DJ_PAY_APP B ON A.PAY_APP_SN = B.PAY_APP_SN
        WHERE 1=1
        AND
            B.DOC_STATUS = 100
        AND
            B.PJT_CD = #{pjtCd}
        AND
            A.BUDGET_SN LIKE CONCAT(#{bgtCd}, '%')
        GROUP BY A.PAY_APP_SN
        ORDER BY B.REQ_DE DESC
    </select>

    <select id="getIncpBudgetDetailViewData" parameterType="map" resultType="map">
        /*getIncpBudgetDetailViewData*/
        SELECT AA.* FROM
        (
            SELECT
                A.PAY_INCP_SN,
                B.BUDGET_SN,
                B.BUDGET_NM,
                B.RE_STAT AS PAY_APP_TYPE,
                B.APP_CONT,
                B.PAY_EXNP_DE,
                A.CRM_NM,
                (SELECT SUM(TOT_COST) FROM CAM_MNG.DJ_PAY_INCP S WHERE S.PAY_INCP_SN = B.PAY_INCP_SN) AS TOT_COST,
                (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO HR WHERE HR.EMP_SEQ = B.REG_EMP_SEQ) AS EMP_NAME,
                B.INFO_CODE
            FROM CAM_MNG.DJ_PAY_INCP_RE A
            LEFT JOIN CAM_MNG.DJ_PAY_INCP B ON A.PAY_INCP_SN = B.PAY_INCP_SN
            WHERE 1=1
              AND
                B.DOC_STATUS = 100
              AND
                B.PJT_CD = #{pjtCd}
              AND B.BUDGET_SN LIKE CONCAT(#{bgtCd}, '%')
            GROUP BY A.PAY_INCP_SN
            UNION
            SELECT
                A.PAY_APP_SN AS PAY_INCP_SN,
                A.BUDGET_SN,
                A.BUDGET_NM,
                B.PAY_APP_TYPE,
                IFNULL(B.APP_TITLE, B.APP_CONT) AS APP_CONT,
                B.PAY_EXNP_DE AS PAY_EXNP_DE,
                A.CRM_NM,
                (SELECT SUM(TOT_COST) FROM CAM_MNG.DJ_PAY_APP_DET S WHERE S.PAY_APP_SN = B.PAY_APP_SN AND S.DET_STAT != 'N') AS TOT_COST,
                (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO HR WHERE HR.EMP_SEQ = B.REG_EMP_SEQ) AS EMP_NAME,
                B.INFO_CODE
            FROM CAM_MNG.DJ_PAY_APP_DET A
            LEFT JOIN CAM_MNG.DJ_PAY_APP B ON A.PAY_APP_SN = B.PAY_APP_SN
            WHERE 1=1
              AND
                B.DOC_STATUS = 100
              AND
                B.PJT_CD = #{pjtCd}
              AND
                A.BUDGET_SN LIKE CONCAT(#{bgtCd}, '%')
            GROUP BY A.PAY_APP_SN
        ) AA
        ORDER BY AA.PAY_EXNP_DE DESC
    </select>

    <select id="getCarryoverAmt" parameterType="map" resultType="map">
        /*getCarryoverAmt*/
        SELECT CARRYOVER_CASH, CARRYOVER_POINT FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_CD = #{pjtCd}
        UNION
        SELECT CARRYOVER_CASH, CARRYOVER_POINT FROM CAM_PJT_MNG.DJ_CORP_PROJECT WHERE CORP_PJT_CD = #{pjtCd}
    </select>

    <update id="updProjectCarryoverAmt" parameterType="map">
        /*updProjectCarryoverAmt*/
        UPDATE CAM_PJT_MNG.DJ_PROJECT
        SET
            <if test='carryoverCash != null and !"".equals(carryoverCash)'>
                CARRYOVER_CASH = #{carryoverCash}
            </if>
            <if test='carryoverPoint != null and !"".equals(carryoverPoint)'>
                CARRYOVER_POINT = #{carryoverPoint}
            </if>
        WHERE
            PJT_CD = #{pjtCd}
    </update>

    <update id="updCorpProjectCarryoverAmt" parameterType="map">
        /*updCorpProjectCarryoverAmt*/
        UPDATE CAM_PJT_MNG.DJ_CORP_PROJECT
        SET
            <if test='carryoverCash != null and !"".equals(carryoverCash)'>
                CARRYOVER_CASH = #{carryoverCash}
            </if>
            <if test='carryoverPoint != null and !"".equals(carryoverPoint)'>
                CARRYOVER_POINT = #{carryoverPoint}
            </if>
        WHERE
            CORP_PJT_CD = #{pjtCd}
    </update>

    <insert id="setRndProjectPrevNextAmt" parameterType="map">
        /*setRndProjectPrevNextAmt*/
        INSERT INTO CAM_PJT_MNG.DJ_GOVT_PROJECT_AMT
        (
            PJT_SN,
            PREV_SALE_AMT,
            PREV_INCP_AMT,
            NEXT_SALE_AMT,
            NEXT_INCP_AMT,
            REG_EMP_SEQ,
            REG_DT
        )
        VALUES
        (
            #{pjtSn},
            #{prevSaleAmt},
            #{prevIncpAmt},
            #{nextSaleAmt},
            #{nextIncpAmt},
            #{regEmpSeq},
             NOW()
        )
    </insert>

    <update id="updRndProjectPrevNextAmt" parameterType="map">
        /*updRndProjectPrevNextAmt*/
        UPDATE CAM_PJT_MNG.DJ_GOVT_PROJECT_AMT
        SET
            PREV_SALE_AMT = #{prevSaleAmt},
            PREV_INCP_AMT = #{prevIncpAmt},
            NEXT_SALE_AMT = #{nextSaleAmt},
            NEXT_INCP_AMT = #{nextIncpAmt},
            MOD_EMP_SEQ = #{regEmpSeq},
            MOD_DT = NOW()
        WHERE
            GOVT_PJT_SN = #{govtPjtSn}
    </update>

    <select id="getRndProjectPrevNextAmt" parameterType="map" resultType="map">
        /*getRndProjectPrevNextAmt*/
        SELECT * FROM CAM_PJT_MNG.DJ_GOVT_PROJECT_AMT WHERE GOVT_PJT_SN = #{govtPjtSn}
    </select>

    <select id="getCorpProjectDataByCd" parameterType="map" resultType="map">
        /*getCorpProjectDataByCd*/
        SELECT * FROM CAM_PJT_MNG.DJ_CORP_PROJECT WHERE CORP_PJT_CD = #{corpPjtCd};

    </select>
</mapper>