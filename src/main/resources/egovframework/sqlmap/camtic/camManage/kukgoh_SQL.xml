<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kukgoh">

    <select id="getCmmnCodeList" parameterType="map" resultType="map">
        /*getCmmnCodeList*/
        SELECT *
        FROM CAM_ERP.T_IFS_ERP_CMMN_CODE
        WHERE 1 = 1
        <if test='cmmnCodeNm != null and !"".equals(cmmnCodeNm)'>
            AND CMMN_CODE_NM LIKE CONCAT('%', #{cmmnCodeNm}, '%')
        </if>
        ORDER BY CMMN_CODE
    </select>

    <select id="getCmmnCodeDetailList" parameterType="map" resultType="map">
        /*getCmmnCodeDetailList*/
        SELECT
            A.*,
            B.CMMN_OBJ_A,
            B.CMMN_OBJ_B
        FROM
            CAM_ERP.T_IFS_ERP_CMMN_CODE_DETAIL A
        LEFT JOIN CAM_ERP.DJ_CMMN_CODE_OBJ B ON A.CNTC_SN = B.CNTC_SN
        WHERE
            CMMN_CODE = #{cmmnCode}
    </select>

    <delete id="delCommCodeObject" parameterType="map">
        /*delCommCodeObject*/
        DELETE FROM CAM_ERP.DJ_CMMN_CODE_OBJ WHERE CNTC_SN = #{cntcSn}
    </delete>

    <insert id="insCommCodeObject" parameterType="map">
        /*insCommCodeObject*/
        INSERT INTO CAM_ERP.DJ_CMMN_CODE_OBJ
            (
                CNTC_SN, CMMN_OBJ_A, CMMN_OBJ_B, REG_EMP_SEQ
            )
        VALUES
            (
                #{cntcSn}, #{cmmnObjA}, #{cmmnObjB}, #{regEmpSeq}
            )
    </insert>

    <select id="getPayAppList" parameterType="map" resultType="map">
        /*getPayAppList*/
        SELECT
            A.PAY_APP_DET_SN,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = B.REG_EMP_SEQ) AS EMP_NAME,
            C.DOC_NO,
            C.DOC_TITLE,
            B.PJT_NM,
            A.BUDGET_NM,
            A.EVID_TYPE,
            A.TOT_COST
        FROM
            CAM_MNG.DJ_PAY_APP_DET A
        LEFT JOIN CAM_MNG.DJ_PAY_APP B ON A.PAY_APP_SN = B.PAY_APP_SN
        LEFT JOIN DJ_CAMTIC.A_DOC_INFO C ON B.DOC_ID = C.DOC_ID
        WHERE
            B.DOC_STATUS = 100
        AND
            DATE_FORMAT(B.REG_DT, '%Y-%m-%d') BETWEEN #{strDt} AND #{endDt}
    </select>

    <select id="getEnaraBudgetCdList" parameterType="map" resultType="map">
        /*getEnaraBudgetCdList*/
        SELECT
            *
        FROM
            CAM_ERP.T_IFS_ERP_ASSTN_EXPITM_TAXITM
        WHERE
            FSYR = #{fsYear}
          AND
            (ASSTN_EXPITM_NM LIKE CONCAT('%', #{bgNm}, '%') OR ASSTN_TAXITM_NM LIKE CONCAT('%', #{bgNm}, '%'))
    </select>

    <delete id="delEnaraBudgetCode" parameterType="map">
        /*delEnaraBudgetCode*/
        DELETE FROM CAM_ERP.DJ_BUDGET_CODE WHERE BUDGET_SN = #{budgetSn} AND FSYR = #{fsyr}
    </delete>

    <insert id="insEnaraBudgetCode" parameterType="map">
        /*insEnaraBudgetCode*/
        INSERT INTO CAM_ERP.DJ_BUDGET_CODE
            (
                BUDGET_SN,
                FSYR,
                CNTC_SN,
                ASSTN_EXPITM_TAXITM_CODE,
                ASSTN_EXPITM_NM,
                ASSTN_TAXITM_NM
            )
        VALUES
            (
                #{budgetSn},
                #{fsyr},
                #{cntcSn},
                #{asstnExpitmTaxitmCode},
                #{asstnExpitmNm},
                #{asstnTaxitmNm}
            )
    </insert>

    <select id="getEnaraBudgetCdData" parameterType="map" resultType="map">
        /*getEnaraBudgetCdData*/
        SELECT * FROM CAM_ERP.DJ_BUDGET_CODE WHERE BUDGET_SN = #{BGT_CD}
    </select>

    <delete id="delBudgetCodeMatch" parameterType="map">
        /*delBudgetCodeMatch*/
        DELETE FROM CAM_ERP.DJ_BUDGET_CODE WHERE BG_SN = #{bgSn}
    </delete>

    <select id="getProjectList" parameterType="map" resultType="map">
        /*getProjectList*/
        SELECT
            A.PJT_SN, B.*, A.PJT_CD, A.PJT_NM
        FROM CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN CAM_ERP.DJ_PROJECT_LINK B ON A.PJT_SN = B.PJT_SN
        WHERE #{year} BETWEEN DATE_FORMAT(STR_DT, '%Y') AND DATE_FORMAT(END_DT, '%Y')
    </select>

    <select id="getEnaraPjtData" parameterType="map" resultType="map">
        /*getEnaraPjtData*/
        SELECT
            *
        FROM
            CAM_ERP.T_IFS_BSRSLT_ERP
        WHERE
            CNTC_SN = #{cntcSn}
    </select>

    <select id="getEnaraPjtList" parameterType="map" resultType="map">
        /*getEnaraPjtList*/
        SELECT *
        FROM
            CAM_ERP.T_IFS_BSRSLT_ERP
        WHERE
            BSNSYEAR = #{year}
        AND
            DDTLBZ_NM LIKE CONCAT('%', #{ddtlbzNm}, '%')
    </select>

    <insert id="insEnaraProject" parameterType="map">
        /*insEnaraProject*/
        INSERT INTO CAM_ERP.DJ_PROJECT_LINK
            (
                PJT_SN,
                CNTC_SN,
                BSNSYEAR,
                DDTLBZ_ID,
                DDTLBZ_NM,
                UPPER_BSNS_ID,
                UPPER_BSNS_NM,
                REQST_DE
            )
        VALUES
            (
                #{PJT_SN},
                #{CNTC_SN},
                #{BSNSYEAR},
                #{DDTLBZ_ID},
                #{DDTLBZ_NM},
                #{UPPER_BSNS_ID},
                #{UPPER_BSNS_NM},
                #{REQST_DE}
            )
    </insert>

    <select id="getPayAppDataByPayAppDetSn" parameterType="map" resultType="map">
        /*getPayAppDataByPayAppDetSn*/
        SELECT
            A.*,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = A.REG_EMP_SEQ) AS EMP_NAME,
            DATE_FORMAT(A.APPROVAL_DATE, '%Y-%m-%d') AS APP_DE,
            (SELECT DOC_NO FROM DJ_CAMTIC.A_DOC_INFO WHERE DOC_ID = A.DOC_ID) AS DOC_NO,
            B.BUDGET_NM AS BGT_NM,
            B.EVID_TYPE,
            B.BUDGET_AMT
        FROM
            CAM_MNG.DJ_PAY_APP A
        LEFT JOIN
            CAM_MNG.DJ_PAY_APP_DET B ON A.PAY_APP_SN = B.PAY_APP_SN
        WHERE
            B.PAY_APP_DET_SN = #{payAppDetSn}
    </select>

    <select id="getProjectDataByPayAppDetSn" parameterType="map" resultType="map">
        /*getProjectDataByPayAppDetSn*/
        SELECT
            *
        FROM
            CAM_PJT_MNG.DJ_PROJECT A
        LEFT JOIN CAM_ERP.DJ_PROJECT_LINK B ON A.PJT_SN = B.PJT_SN
        LEFT JOIN CAM_MNG.DJ_DEPO_SETTING C ON A.PJT_CD = C.PJT_CD
        WHERE
            A.PJT_CD = #{PJT_CD}
    </select>
</mapper>
