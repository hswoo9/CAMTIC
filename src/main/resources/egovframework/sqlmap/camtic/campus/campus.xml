<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="campus">
    <select id="getCodeList" resultType="map" parameterType="map">
        /* getCodeList */
        SELECT
            *
        FROM
            CAMPUS.DJ_CAMPUS_CODE CC
        WHERE
            ACTIVE = 'Y'
    </select>

    <select id="getTargetOne" resultType="map" parameterType="map">
        /* getTargetOne */
        SELECT
            EDU_TARGET_ID,
            TARGET_YEAR,
            TARGET_CODE,
            LOGIN_ID,
            STATUS,
            REG_EMP_SEQ,
            REG_DATE
        FROM
            CAMPUS.DJ_EDU_TARGET ET
        WHERE
            TARGET_YEAR = #{targetYear}
        AND REG_EMP_SEQ = #{empSeq}
    </select>

    <select id="getTargetList" resultType="map" parameterType="map">
        /* getTargetList */
        SELECT
            ETD.EDU_TARGET_DETAIL_ID,
            ETD.EDU_TARGET_ID,
            ET.TARGET_YEAR,
            ET.TARGET_CODE,
            ET.LOGIN_ID,
            ETD.EDU_CATEGORY_DETAIL_ID,
            ETD.TARGET_CLASS,
            ETD.DUTY_CLASS,
            ETD.STATUS
        FROM
            CAMPUS.DJ_EDU_TARGET ET
        LEFT JOIN
            CAMPUS.DJ_EDU_TARGET_DETAIL ETD ON ET.EDU_TARGET_ID = ETD.EDU_TARGET_ID
        WHERE
            ET.TARGET_YEAR = #{targetYear}
        AND ET.REG_EMP_SEQ = #{empSeq}
        <if test='dutyClass != null and dutyClass != ""'>
            AND ETD.DUTY_CLASS = #{dutyClass}
        </if>
    </select>

    <select id="getTargetCategoryList" resultType="map" parameterType="map">
        /* getTargetCategoryList */
        SELECT
            EC.EDU_CATEGORY_ID,
            EC.EDU_CATEGORY_NAME
        FROM
            CAMPUS.DJ_EDU_CATEGORY EC
        WHERE
            EC.EDU_CATEGORY_ID IN (
                SELECT
                    EDU_CATEGORY_ID
                FROM
                    CAMPUS.DJ_EDU_TARGET ET
                LEFT JOIN
                    CAMPUS.DJ_EDU_TARGET_DETAIL ETD ON ET.EDU_TARGET_ID = ETD.EDU_TARGET_ID
                LEFT JOIN
                    CAMPUS.DJ_EDU_CATEGORY_DETAIL ECD ON ETD.EDU_CATEGORY_DETAIL_ID = ECD.EDU_CATEGORY_DETAIL_ID
                WHERE
                    ET.TARGET_YEAR = #{targetYear}
                AND ET.REG_EMP_SEQ = #{empSeq}
                <if test='dutyClass != null and dutyClass != ""'>
                    AND ETD.DUTY_CLASS = #{dutyClass}
                </if>
            )
    </select>

    <select id="getTargetCategoryDetailList" resultType="map" parameterType="map">
        /* getTargetCategoryDetailList */
        SELECT
            ETD.EDU_TARGET_DETAIL_ID,
            ETD.TARGET_CLASS,
            ECD.EDU_CATEGORY_ID,
            ECD.EDU_CATEGORY_DETAIL_ID,
            ECD.EDU_CATEGORY_DETAIL_NAME,
            ECD.LEVEL_ID
        FROM
            CAMPUS.DJ_EDU_TARGET ET
        LEFT JOIN
            CAMPUS.DJ_EDU_TARGET_DETAIL ETD ON ET.EDU_TARGET_ID = ETD.EDU_TARGET_ID
        LEFT JOIN
            CAMPUS.DJ_EDU_CATEGORY_DETAIL ECD ON ETD.EDU_CATEGORY_DETAIL_ID = ECD.EDU_CATEGORY_DETAIL_ID
        WHERE
            ET.TARGET_YEAR = #{targetYear}
        AND
            ET.REG_EMP_SEQ = #{empSeq}
        <if test='dutyClass != null and dutyClass != ""'>
            AND ETD.DUTY_CLASS = #{dutyClass}
        </if>
    </select>

    <select id="getEduCategoryList" resultType="map" parameterType="map">
        /* getEduCategoryList */
        SELECT
            EC.EDU_CATEGORY_ID,
            EC.EDU_CATEGORY_NAME,
            EC.LARGE_CATEGORY_ID,
            EC.LARGE_CATEGORY_NAME
        FROM
            CAMPUS.DJ_EDU_CATEGORY EC
        WHERE
        EC.ACTIVE = 'Y'
        <if test='largeCategoryId != null and largeCategoryId != ""'>
            AND EC.LARGE_CATEGORY_ID in (${largeCategoryId})
        </if>
        ORDER BY EC.ORDER
    </select>

    <select id="getEduCategoryDetailList" resultType="map" parameterType="map">
        /* getEduCategoryDetailList */
        SELECT
            ECD.EDU_CATEGORY_DETAIL_ID,
            ECD.EDU_CATEGORY_DETAIL_NAME,
            ECD.EDU_CATEGORY_ID,
            ECD.EDU_CATEGORY_NAME,
            ECD.LEVEL_ID,
            ECD.LEVEL_NAME
        FROM
            CAMPUS.DJ_EDU_CATEGORY_DETAIL ECD
        WHERE
            ECD.ACTIVE = 'Y'
        <if test='levelId != null and levelId != ""'>
        AND ECD.LEVEL_ID = #{levelId}
        </if>
        ORDER BY ECD.ORDER
    </select>

    <insert id="setTargetInsert" parameterType="map">
        /* setTargetInsert */
        INSERT INTO CAMPUS.DJ_EDU_TARGET
            (
                TARGET_YEAR,
                TARGET_CODE,
                LOGIN_ID,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{targetYear},
                #{targetCode},
                #{loginId},
                #{empSeq}
            )
    </insert>

    <insert id="setTargetDetailInsert" parameterType="map">
        /* setTargetDetailInsert */
        INSERT INTO CAMPUS.DJ_EDU_TARGET_DETAIL
            (
                EDU_TARGET_ID,
                EDU_CATEGORY_DETAIL_ID,
                DUTY_CLASS,
                REG_EMP_SEQ
            )
        VALUES
        <foreach collection="eduCategoryDetailIdList" item="item" separator=" , ">
            (
                (SELECT EDU_TARGET_ID FROM CAMPUS.DJ_EDU_TARGET WHERE TARGET_YEAR = #{targetYear} AND REG_EMP_SEQ = #{empSeq}),
                #{item.eduCategoryDetailId},
                #{dutyClass},
                #{empSeq}
            )
        </foreach>
    </insert>

    <update id="setEduTargetDetailUpdate" parameterType="map">
        /* setEduTargetDetailUpdate */
        UPDATE
            CAMPUS.DJ_EDU_TARGET_DETAIL
        SET
            TARGET_CLASS = #{classNum}
        WHERE
            EDU_TARGET_DETAIL_ID IN
        <foreach collection="eduTargetDetailIdList" item="item" open="(" separator="," close=")">
            #{item.eduTargetDetailId}
        </foreach>
    </update>

    <delete id="setTargetDetailDelete" parameterType="map">
        /* setTargetDetailDelete */
        DELETE FROM
            CAMPUS.DJ_EDU_TARGET_DETAIL
        WHERE
            EDU_TARGET_ID = (
                SELECT
                    EDU_TARGET_ID
                FROM
                    CAMPUS.DJ_EDU_TARGET
                WHERE
                    TARGET_YEAR = #{targetYear}
                AND REG_EMP_SEQ = #{empSeq}
            )
        AND DUTY_CLASS = #{dutyClass}
    </delete>
</mapper>