<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userManage">
    <select id="getUserPersonnelRecordList" parameterType="map" resultType="map">
        /* getUserPersonnelRecordList */
        SELECT
            a.emp_seq AS 'empSeq',
            a.erp_emp_seq AS 'erpEmpSeq',
            a.login_id AS 'loginId',
            a.EMP_NAME_KR AS 'empName',
            a.EMP_NAME_CN AS 'empNameCn',
            a.BDAY as 'bDay',
            a.ZIP_CODE AS 'zipCode',
            a.ADDR AS 'addr',
            a.OLD_ADDR AS 'oldAdrr',
            a.ADDR_DETAIL AS 'addrDetail',
            a.ADDR_REFERENCES AS 'addrReferences',
            a.OFFICE_TEL_NUM AS 'officeTelNum',
            a.MOBILE_TEL_NUM AS 'mobileTelNum',
            a.JOIN_DAY AS 'joinDay',
            a.RESIGN_DAY AS 'resignDay'
        FROM
            cam_hr.dj_emp_info AS a
        WHERE
            a.EMP_SEQ = #{empSeq};
    </select>
    <select id="getEducationalList" parameterType="map" resultType="map">
        /* getEducationalList */
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_educational AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        AND
            b.admin_approval = 'Y';
    </select>
    <select id="getMilitarySvcInfo" parameterType="map" resultType="map">
        /* getMilitarySvcInfo */
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_military_svc_info AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
            and
            b.admin_approval = 'Y';
    </select>
    <select id="getCareerInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_career AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        AND
            b.admin_approval = 'Y';
    </select>
    <select id="getFamilyInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_family_info AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        and
            b.admin_approval = 'Y';
    </select>
    <select id="getLicenceInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_certificate AS b
        ON
                a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        AND
            b.admin_approval = 'Y';
    </select>

    <select id="getAppointInfoList" parameterType="map" resultType="map">
        /* getAppointInfoList */
        SELECT
            A.*,
            DATE_FORMAT(HISTORY_DT, '%Y-%m-%d') AS historyDt
        FROM
            CAM_HR.DJ_APNT_INFO A
        WHERE
            A.EMP_SEQ = #{empSeq}
    </select>

    <select id="getRewardInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_reword AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        AND
            b.admin_approval = 'Y';
    </select>
    <select id="getDutyInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT JOIN
            cam_hr.dj_emp_duty_info AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        and
            b.admin_approval = 'Y';
    </select>
    <select id="getProposalInfoList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        LEFT join
            cam_hr.dj_emp_proposal_info AS b
        ON
            a.EMP_SEQ = b.EMP_SEQ
        WHERE
            a.EMP_SEQ = #{empSeq}
        AND
            b.admin_approval = 'Y';
    </select>


    <insert id="setUserReqDetailInsert" parameterType="map">
        /*setUserReqDetailInsert*/
        INSERT INTO CAM_HR.DJ_EMP_INFO(
            EMP_SEQ,
            EMP_NAME_KR,
            LOGIN_PASSWD,
            LOGIN_ID,
            RES_REGIS_NUM,
            CAPS_NUM,
            DUTY_CODE,
            POSITION_CODE,
            DEPT_NAME,
            DEPT_SEQ,
            DEPT_TEAM_NAME,
            JOB_DETAIL,
            BEFOR_CAREER,
            ACCOUNT_HOLDER,
            BANK_NAME,
            ACCOUNT_NUM,
            ADDR,
            ADDR_DETAIL,
            OFFICE_TEL_NUM,
            MOBILE_TEL_NUM,
            EMAIL_ADDR,
            CAR_NUM,
            EMP_NAME_CN,
            EMP_NAME_EN,
            EMG_TEL_NUM,
            LEGAL_DOMICILE,
            HOBBY,
            RELIGION,
            SPECIALITY,
            WEIGHT,
            HEIGHT,
            VISIONL,
            VISIONR,
            HOME_PAGE_ACTIVE,
            WEDDING_ACTIVE,
            BLOOD_TYPE,
            DIVISION,
            DIVISION_SUB,
            REG_EMP_SEQ,
            ACTIVE,
            CAR_ACTIVE,
            JOIN_DAY
        )VALUES(
            (SELECT MAX(CAST(A.EMP_SEQ AS UNSIGNED))+1 FROM CAM_HR.DJ_EMP_INFO A),
            #{EMP_NAME_KR},
            #{LOGIN_PASSWD},
            #{LOGIN_ID},
            #{RES_REGIS_NUM},
            #{CAPS_NUM},
            #{DUTY_CODE},
            #{POSITION_CODE},
            #{DEPT_NAME},
            #{DEPT_SEQ},
            #{DEPT_TEAM_NAME},
            #{JOB_DETAIL},
            #{BEFOR_CAREER},
            #{ACCOUNT_HOLDER},
            #{BANK_NAME},
            #{ACCOUNT_NUM},
            #{ADDR},
            #{ADDR_DETAIL},
            #{OFFICE_TEL_NUM},
            #{MOBILE_TEL_NUM},
            #{EMAIL_ADDR},
            #{CAR_NUM},
            #{EMP_NAME_CN},
            #{EMP_NAME_EN},
            #{EMG_TEL_NUM},
            #{LEGAL_DOMICILE},
            #{HOBBY},
            #{RELIGION},
            #{SPECIALITY},
            #{WEIGHT},
            #{HEIGHT},
            #{VISIONL},
            #{VISIONR},
            #{HOME_PAGE_ACTIVE},
            #{WEDDING_ACTIVE},
            #{BLOOD_TYPE},
            #{division},
            #{divisionSub},
            #{regEmpSeq},
            #{ACTIVE},
            #{CAR_ACTIVE},
            #{JOIN_DAY}
        )
    </insert>

    <select id="getCodeList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            cam_hr.dj_hr_code
        WHERE
            ACTIVE = 'Y'
    </select>
    <select id="getDeptCodeList2" parameterType="map" resultType="map">
        /*getDeptCodeList2*/
        SELECT
            DI.DEPT_NAME AS deptName,
            DI.DEPT_SEQ AS deptSeq
        FROM
            CAM_HR.DJ_DEPT_INFO DI
        WHERE
            DI.DEPT_LEVEL = 1
    </select>

    <select id="getDeptCodeList" parameterType="map" resultType="map">
        /*getDeptCodeList*/
        SELECT
            DEPT_NAME AS text,
            DEPT_SEQ AS value
        FROM
            CAM_HR.DJ_DEPT_INFO
        WHERE
            PARENT_DEPT_SEQ = #{deptSeq}
    </select>
    <select id="getEmpInfoList" parameterType="map" resultType="map">
        SELECT
        HEI.*,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_SEQ END AS DEPT_SEQ,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME1,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_SEQ ELSE "" END AS TEAM_SEQ,
        CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
        date_format(HEI.JOIN_DAY,'%Y-%m-%d') AS JOIN_DAY2,
        (SELECT CM_CODE_NM FROM CAM_COMMON.DJ_COM_CODE WHERE CM_GROUP_CODE_ID = (SELECT CM_GROUP_CODE_ID FROM CAM_COMMON.DJ_COM_GROUP_CODE WHERE CM_GROUP_CODE = "DUTY") AND CM_CODE = HEI.DUTY_CODE) AS DUTY_NM2,
        (SELECT CM_CODE_NM FROM CAM_COMMON.DJ_COM_CODE WHERE CM_GROUP_CODE_ID = (SELECT CM_GROUP_CODE_ID FROM CAM_COMMON.DJ_COM_GROUP_CODE WHERE CM_GROUP_CODE = "POSITION") AND CM_CODE = HEI.POSITION_CODE) AS POSITION_NM2
        FROM
        CAM_HR.DJ_EMP_INFO	AS HEI
        LEFT JOIN
        CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE
        HEI.active = 'Y'
        <if test='startDate != null and !"".equals(startDate)'>
            <![CDATA[
	    AND
	        DATE_FORMAT(#{startDate}, '%Y%m%d') >= DATE_FORMAT(HEI.JOIN_DAY, '%Y%m%d')
	    ]]>
        </if>
        AND
            ${userKind} like concat('%', #{kindContent} ,'%')
        <if test='deptComp != null and !"".equals(deptComp)'>
            AND
            HEI.DEPT_SEQ = #{deptComp}
            <if test='deptTeam == deptTeam or "".equals(deptTeam)'>
                OR
                HEI.DEPT_SEQ IN (
                                    SELECT
                                        DEPT_SEQ
                                    FROM
                                        CAM_HR.DJ_DEPT_INFO
                                    WHERE
                                        DEPT_SEQ = #{deptComp}
                                    OR
                                        PARENT_DEPT_SEQ = #{deptComp}
                                    )
            </if>
        </if>
        <if test='deptTeam != null and !"".equals(deptTeam)'>
            AND
            HEI.DEPT_SEQ = #{deptTeam}
        </if>
        <if test='arr != null and !"".equals(arr)'>
            <if test='subArr != null and !"".equals(subArr)'>
            AND
                (DIVISION IN
                <foreach collection="arr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
                OR
                DIVISION_SUB IN
                <foreach collection="subArr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>)
            </if>
            <if test='subArr == null or "".equals(subArr)'>
                AND
                DIVISION IN
                <foreach collection="arr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </if>
        <if test='subArr != null and !"".equals(subArr)'>
            <if test='arr != null and !"".equals(arr)'>
            AND
                (DIVISION IN
                <foreach collection="arr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
                OR
                DIVISION_SUB IN
                <foreach collection="subArr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>)
            </if>
            <if test='arr == null or "".equals(arr)'>
            AND
                DIVISION_SUB IN
                <foreach collection="subArr" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
            AND
                DIVISION in (1, 4)
            </if>
        </if>
    </select>
    <select id="getEmpInfoDetailList" parameterType="map" resultType="map">
        select
            A.*,
            SUBSTRING_INDEX(TRUNCATE(TIMESTAMPDIFF(month, A.JOIN_DAY, DATE_FORMAT(NOW(), '%Y-%m-%d')) / 12, 1), '.', 1) AS hire,
            SUBSTRING_INDEX(TRUNCATE(TIMESTAMPDIFF(month, A.JOIN_DAY, DATE_FORMAT(NOW(), '%Y-%m-%d')) / 12, 1), '.', -1) + 1 AS hire_mon
        from
        (SELECT
            a.*,
            (select dept_seq from CAM_HR.dj_dept_info where dept_seq = a.dept_seq and dept_level =1) as dept_lv1,
            (select parent_dept_seq from cam_hr.dj_dept_info where dept_seq = a.dept_seq and dept_level =2) as parent_dept_seq,
            (select dept_seq from CAM_HR.dj_dept_info where dept_seq = a.dept_seq and dept_level =2) as dept_lv2,
            date_format(a.JOIN_DAY,'%Y-%m-%d') AS JOIN_DAY2,
            date_format(a.RESIGN_DAY,'%Y-%m-%d') AS RESIGN_DAY2,
            case
            when a.appoint_gubun = '04' then (SELECT c.hr_dt_code_nm FROM CAM_HR.dj_hr_code AS c WHERE c.HR_MD_CODE = '07' and c.HR_DT_CODE = a.appoint_gubun_detail)
            else
            (SELECT c.hr_dt_code_nm FROM CAM_HR.dj_hr_code AS c WHERE c.HR_MD_CODE = '06' and c.HR_DT_CODE = a.appoint_gubun)
            END AS 'APPOINT_GUBUN_NM'
        FROM
            CAM_HR.dj_emp_info	AS a) as A
        WHERE
            1=1
            <if test='startDate != null and !"".equals(startDate)'>
                <![CDATA[
            AND
                DATE_FORMAT(#{startDate}, '%Y%m%d') >= DATE_FORMAT(a.JOIN_DAY, '%Y%m%d')
            ]]>
            </if>
            <if test='workStatusCode != null and !"".equals(workStatusCode)'>
                AND
                A.WORK_STATUS_CODE = #{workStatusCode}
            </if>
            <if test='searchDetail1 != null and !"".equals(searchDetail1)'>
                and
                A.DIVISION in (${searchDetail1})
            </if>
            <if test='searchDetail2 != null and !"".equals(searchDetail2)'>
                and
                A.GENDER_CODE in (${searchDetail2})
            </if>
            <if test='searchDetail3 != null and !"".equals(searchDetail3)'>
                <if test='searchDetail4 != null and !"".equals(searchDetail4)'>
                    and
                    (A.parent_dept_seq in (${searchDetail3})
                    or
                    A.dept_lv2 in (${searchDetail4})
                    or
                    A.dept_lv1 in (${searchDetail3}))
                </if>
                <if test='searchDetail4 == null or "".equals(searchDetail4)'>
                    and
                    A.dept_lv1 in (${searchDetail3})
                </if>
            </if>
            <if test='searchDetail4 != null and !"".equals(searchDetail4)'>
                <if test='searchDetail3 != null and !"".equals(searchDetail3)'>
                    and
                    (A.parent_dept_seq in (${searchDetail3})
                    or
                    A.dept_lv2 in (${searchDetail4})
                    or
                    A.dept_lv1 in (${searchDetail3}))
                </if>
                <if test='searchDetail3 == null or "".equals(searchDetail3)'>
                    and
                    A.dept_lv2 in (${searchDetail4})
                </if>
            </if>
            <if test='searchDetail5 != null and !"".equals(searchDetail5)'>
                and
                A.DIVISION in (${searchDetail1})
            </if>
            <if test='searchDetail6 != null and !"".equals(searchDetail6)'>
                and
                A.DIVISION in (${searchDetail1})
            </if>
            <if test='searchDetail7 != null and !"".equals(searchDetail7)'>
                and
                A.DIVISION in (${searchDetail1})
            </if>
            <if test='searchDetail8 != null and !"".equals(searchDetail8)'>
                and
                A.DIVISION in (${searchDetail1})
            </if>
    </select>
    <insert id="setEducationalInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_educational(
              EMP_SEQ
             ,EMP_NAME
             ,ADMISSION_DAY
             ,GRADUATION_DAY
             ,DEGREE_CODE
             ,REG_EMP_SEQ
             ,REG_DATE
             ,SCHOOL_NAME
             ,RMK
        )VALUES (
            #{EMP_SEQ}
            ,#{EMP_NAME}
            ,#{sDate}
            ,#{eDate}
            ,#{degree}
            ,#{EMP_SEQ}
            ,NOW()
            ,#{school}
            ,#{bmk}
        )
    </insert>
    <insert id="setCareerInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_career(
              EMP_SEQ
             ,EMP_NAME
             ,EMPLOY_DEPT_NAME
             ,JOIN_DAY
             ,RESIGN_DAY
             ,POSITION_OR_DUTY
             ,CAREER_PERIOD
             ,REG_EMP_SEQ
             ,REG_DATE
             ,RMK
        )VALUES (
            #{EMP_SEQ}
            ,#{EMP_NAME}
            ,#{place}
            ,#{sDate}
            ,#{eDate}
            ,#{position}
            ,#{dateY}
            ,#{EMP_SEQ}
            ,NOW()
            ,#{bmk}
            )
    </insert>
    <insert id="setMilitaryInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_military_svc_info(
                 EMP_SEQ
                ,EMP_NAME
                ,MILITARY_SVC_TYPE
                ,M_UNFUL_REASON
                ,M_ENLIST_DAY
                ,M_DISCHARGE_DAY
                ,REG_EMP_SEQ
                ,REG_DATE
        )VALUES (
                #{EMP_SEQ}
                ,#{EMP_NAME}
                ,#{mGubun}
                ,#{reason}
                ,#{sDate}
                ,#{eDate}
                ,#{EMP_SEQ}
                ,now()
                )
    </insert>
    <insert id="setFmailyInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_family_info(
                EMP_SEQ
                ,EMP_NAME
                ,FAMILY_CODE
                ,FAMILY_NAME
                ,FAMILY_BIRTH
                ,FAMILY_JOB
                ,INCLUDE_YN
                ,REG_EMP_SEQ
                ,REG_DATE
        )VALUES (
                #{EMP_SEQ}
                ,#{EMP_NAME}
                ,#{relation}
                ,#{fName}
                ,#{bDay}
                ,#{job}
                ,#{cohab}
                ,#{EMP_SEQ}
                ,now()
                )
    </insert>
    <insert id="setLicenceInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_certificate(
                  EMP_SEQ
                 ,EMP_NAME
                 ,CERTIFICATE_NAME
                 ,CERTIFICATE_NUM
                 ,ACQUISITION_DAY
                 ,ISSUER
                 ,RMK
                 ,REG_EMP_SEQ
                 ,REG_DATE
        )VALUES (
                #{EMP_SEQ}
                ,#{EMP_NAME}
                ,#{licenseName}
                ,#{licenseNum}
                ,#{sDate}
                ,#{agency}
                ,#{bmk}
                ,#{EMP_SEQ}
                ,now()
                )
    </insert>
    <insert id="setAppointingInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_appoint(
                  EMP_SEQ
                 ,EMP_NAME
                 ,APPOINT_DAY
                 ,APPOINT_TITLE
                 ,APPOINT_COMMENT
                 ,RMK
                 ,REG_EMP_SEQ
                 ,REG_DATE
        )VALUES (
                #{EMP_SEQ}
                ,#{EMP_NAME}
                ,#{sDate}
                ,#{aGubun}
                ,#{reason}
                ,#{bmk}
                ,#{EMP_SEQ}
                ,now()
                )
    </insert>
    <insert id="setRewardInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_reword(
                  EMP_SEQ
                 ,EMP_NAME
                 ,REWORD_DAY
                 ,REWORD_NAME
                 ,REWORD_AGENCY_NAME
                 ,REWORD_REASON
                 ,REG_EMP_SEQ
                 ,REG_DATE
        )VALUES (
                #{EMP_SEQ}
                ,#{EMP_NAME}
                ,#{sDate}
                ,#{rGubun}
                ,#{agency}
                ,#{rIssue}
                ,#{EMP_SEQ}
                ,now()
                )
    </insert>
    <insert id="setJobInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_duty_info(
                EMP_SEQ
                , EMP_NAME
                , POSITON_NAME
                , WORK_PAY
                , DUTY_DETAIL
                , WORK_JOIN_DAY
                , WORK_LEAVE_DAY
                , REG_EMP_SEQ
                , REG_DATE
        )VALUES (
                #{EMP_SEQ}
                , #{EMP_NAME}
                , #{POSITON_NAME}
                , #{WORK_PAY}
                , #{DUTY_DETAIL}
                , #{sDate}
                , #{eDate}
                , #{EMP_SEQ}
                , NOW()
        )
    </insert>
    <insert id="setProposalInfo" parameterType="map">
        INSERT INTO cam_hr.dj_emp_proposal_info(
            EMP_SEQ
            ,EMP_NAME
            ,PROPOSAL_GUBUN
            ,PROPOSAL_DETAIL
            ,PROPOSAL_CHECK_CHOICE
            ,PROPOSAL_DATE
            ,REG_EMP_SEQ
            ,REG_DATE
        )VALUES (
            #{EMP_SEQ}
            ,#{EMP_NAME}
            ,#{pGubun}
            ,#{PROPOSAL_DETAIL}
            ,#{PROPOSAL_CHECK_CHOICE}
            ,#{sDate}
            ,#{EMP_SEQ}
            ,NOW()
        )
    </insert>

    <select id="getPersonRecordApplyList" parameterType="map" resultType="map">
        SELECT
        row_number() over(ORDER BY a.reg_date DESC) num,
        A.*
        from
        (SELECT
        a.EDUCATIONAL_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_educational' AS 'type',
        '학력사항' AS 'typeName',
        'EDUCATIONAL_ID' AS 'key'
        FROM
        cam_hr.dj_emp_educational AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        union
        SELECT
        a.CAREER_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_career' AS 'type',
        '경력사항' AS 'typeName',
        'CAREER_ID' AS 'key'
        FROM
        cam_hr.dj_emp_career AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.MSI_INFO_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_military_svc_info' AS 'type',
        '병력사항' AS 'typeName',
        'MSI_INFO_ID' AS 'key'
        FROM
        cam_hr.dj_emp_military_svc_info AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.FAMILY_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_family_info' AS 'type',
        '가족사항' AS 'typeName',
        'FAMILY_ID' AS 'key'
        FROM
        cam_hr.dj_emp_family_info AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.CERTIFICATE_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_certificate' AS 'type',
        '보유면허' AS 'typeName',
        'CERTIFICATE_ID' AS 'key'
        FROM
        cam_hr.dj_emp_certificate AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.APPOINT_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_appoint' AS 'type',
        '발령사항' AS 'typeName',
        'APPOINT_ID' AS 'key'
        FROM
        cam_hr.dj_emp_appoint AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.REWORD_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_reword' AS 'type',
        '포상사항' AS 'typeName',
        'REWORD_ID' AS 'key'
        FROM
        cam_hr.dj_emp_reword AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.DUTY_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_duty_info' AS 'type',
        '직무사항' AS 'typeName',
        'DUTY_ID' AS 'key'
        FROM
        cam_hr.dj_emp_duty_info AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq
        UNION
        SELECT
        a.PROPOSAL_ID AS 'ID',
        b.EMP_SEQ,
        b.DEPT_NAME,
        b.DEPT_TEAM_NAME,
        b.POSITION_NAME,
        a.EMP_NAME,
        date_format(a.reg_date, '%Y-%m-%d') AS REG_DATE,
        a.REG_DATE as 'REG_DATE2',
        a.admin_approval,
        a.returnyn,
        'dj_emp_proposal_info' AS 'type',
        '제안제도' AS 'typeName',
        'PROPOSAL_ID' AS 'key'
        FROM
        cam_hr.dj_emp_proposal_info AS a
        LEFT join
        cam_hr.dj_emp_info AS b
        on
        a.emp_seq = b.emp_seq) AS A
        WHERE
        1=1
        <if test='name != null and !"".equals(name)'>
            and
            A.EMP_NAME LIKE CONCAT('%',#{name},'%')
        </if>
        <if test='drop1 != null and !"".equals(drop1)'>
            and
        <choose>
            <when test='"1".equals(drop1)'>
                A.typeName = '학력사항'
            </when>
            <when test='"2".equals(drop1)'>
                A.typeName = '경력사항'
            </when>
            <when test='"3".equals(drop1)'>
                A.typeName = '병력사항'
            </when>
            <when test='"4".equals(drop1)'>
                A.typeName = '가족사항'
            </when>
            <when test='"5".equals(drop1)'>
                A.typeName = '보유면허'
            </when>
            <when test='"6".equals(drop1)'>
                A.typeName = '발령사항'
            </when>
            <when test='"7".equals(drop1)'>
                A.typeName = '포상사항'
            </when>
            <when test='"8".equals(drop1)'>
                A.typeName = '직무사항'
            </when>
            <when test='"9".equals(drop1)'>
                A.typeName = '제안제도'
            </when>
        </choose>
        </if>
        <if test='status != null and !"".equals(status)'>
            and
        <choose>
            <when test='"1".equals(status)'>
                A.admin_approval ='N'
                and
        		A.returnyn ='N'
            </when>
            <when test='"2".equals(status)'>
                A.admin_approval ='N'
                and
        		A.returnyn ='Y'
            </when>
            <when test='"3".equals(status)'>
                A.admin_approval ='Y'
                and
        		A.returnyn ='N'
            </when>
        </choose>
        </if>
        <if test='startDate != null and !"".equals(startDate)'>
            <![CDATA[
		AND
		DATE_FORMAT(#{startDate}, '%Y%m%d') <= DATE_FORMAT(A.REG_DATE, '%Y%m%d')
		AND
		DATE_FORMAT(#{endDate}, '%Y%m%d') >= DATE_FORMAT(A.REG_DATE, '%Y%m%d')
		]]>
        </if>
        <if test='dept != null and !"".equals(dept)'>
            and
            A.DEPT_NAME = #{dept}
        </if>
        <if test='team != null and !"".equals(team)'>
            and
            A.DEPT_TEAM_NAME = #{team}
        </if>

        ORDER BY a.reg_date DESC
    </select>

    <update id="setUpdateUserInfoModY" parameterType="map">
        UPDATE cam_hr.${TYPE}
        SET
            ADMIN_APPROVAL = 'Y',
            ADMIN_APPROVAL_DATE = NOW()
        WHERE
            EMP_SEQ = #{EMP_SEQ}
            and
            ${KEY} = #{ID}
    </update>
    <update id="setUpdateUserInfoModN" parameterType="map">
        UPDATE cam_hr.${TYPE}
        SET
            ADMIN_APPROVAL = 'N',
            ADMIN_APPROVAL_DATE = NOW()
        WHERE
            EMP_SEQ = #{EMP_SEQ}
          and
            ${KEY} = #{ID}
    </update>
        <update id="setUpdateUserInfoReturnY" parameterType="map">
        UPDATE cam_hr.${TYPE}
        SET
            RETURNYN = 'Y',
            RETURNYN_DATE = NOW()
        WHERE
            EMP_SEQ = #{EMP_SEQ}
            and
            ${KEY} = #{ID}
    </update>
    <update id="setUpdateUserInfoReturnN" parameterType="map">
        UPDATE cam_hr.${TYPE}
        SET
            RETURNYN = 'N',
            RETURNYN_DATE = NOW()
        WHERE
            EMP_SEQ = #{EMP_SEQ}
          and
            ${KEY} = #{ID}
    </update>
    <select id="getUserPersonnelinformList" parameterType="map" resultType="map">
        /* getUserPersonnelinformList */
        SELECT
            a.EMP_SEQ,
            a.ERP_EMP_SEQ,
            a.LOGIN_ID,
            a.LOGIN_PASSWD,
            a.EMP_NAME_KR,
            a.EMP_NAME_EN,
            a.EMP_NAME_CN,
            a.ATT_CARD_NUM,
            a.DEPT_SEQ,
            a.DEPT_NAME,
            a.DEPT_TEAM_NAME,
            (select dept_name from cam_hr.dj_dept_info where dept_seq = (select parent_dept_seq from cam_hr.dj_dept_info where dept_seq= a.DEPT_SEQ)) PARENT_DEPT_NAME,
            (select parent_dept_seq from cam_hr.dj_dept_info where dept_seq= a.DEPT_SEQ) AS DEPT_PARENT_SEQ,
            a.JOB_CODE,
            a.JOB_NAME,
            a.POSITION_CODE,
            a.POSITION_NAME,
            a.DUTY_CODE,
            a.DUTY_NAME,
            a.GRADE_CODE,
            a.GRADE_NAME,
            a.POSITION_OR_DUTY,
            a.OCCUPATION_CODE,
            a.EMPLOY_GUBUN,
            a.JOIN_DAY,
            a.APPOINT_DAY,
            a.APPOINT_GUBUN,
            a.APPOINT_GUBUN_DETAIL,
            a.CTR_ST_DAY,
            a.CTR_EN_DAY,
            a.WEEK_WORK_TIME_TYPE,
            a.WEEK_WORK_TIME,
            a.BF_APPOINT_DAY,
            a.LOCAL_TALENT,
            a.WORK_FIELD_NAME,
            a.ZIP_CODE,
            a.ADDR,
            a.OLD_ADDR,
            a.ADDR_DETAIL,
            a.ADDR_REFERENCES,
            a.LEGAL_DOMICILE,
            a.HOME_TEL_NUM,
            a.MOBILE_TEL_NUM,
            a.OFFICE_TEL_NUM,
            a.EMAIL_ADDR,
            a.BDAY,
            a.GENDER_CODE,
            a.WEDDING_ACTIVE,
            a.IMPAIR_LEVEL_CODE,
            a.DEGREE_CODE,
            a.JOB_DETAIL,
            a.SPEC_CODE,
            a.DIV_FACTION,
            a.WORK_STATUS_CODE,
            a.RESIGN_DAY,
            a.PHOTO_FILE_ID,
            a.DEPT_MG_YN,
            a.ADMIN_APPROVE_YN,
            a.SECRET_YN,
            a.SEC_AUTHORIZE_DATE,
            a.SEC_RELEASE_DATE,
            a.ACTIVE,
            a.REG_EMP_SEQ,
            a.REG_DATE,
            a.MOD_EMP_SEQ,
            a.MOD_DATE,
            a.RES_REGIS_NUM,
            a.CHECK_PASSWD,
            a.CAPS_NUM,
            a.HOME_PAGE_ACTIVE,
            a.BEFOR_CAREER,
            a.BS_ELAPSED_YEAR,
            a.ELAPSED_YEAR,
            a.ACCOUNT_HOLDER,
            a.BANK_NAME,
            a.ACCOUNT_NUM,
            a.CAR_ACTIVE,
            a.CAR_NUM,
            a.EMG_TEL_NUM,
            a.BLOOD_TYPE,
            a.WEDDING_DAY,
            a.HOBBY,
            a.SPECIALITY,
            a.RELIGION,
            a.HEIGHT,
            a.WEIGHT,
            a.VISIONL,
            a.VISIONR,
            a.DIVISION,
            a.DIVISION_SUB
        FROM
            cam_hr.dj_emp_info AS a
        WHERE
            a.EMP_SEQ = #{empSeq};
    </select>

    <update id="setUserInfoReqUpd" parameterType="map">
        /* setUserInfoReqUpd */
        UPDATE
        CAM_COMMON.DJ_FILE_INFO
        SET
        <if test='photoFileId != null and !"".equals(photoFileId)'>
            PHOTO_FILE_ID = #{photoFileId}
        </if>
        WHERE
        EMP_SEQ = #{empSeq}
    </update>
    <select id="getUserInfoModDetail" resultType="map" parameterType="map">
        select
            a.*
        from
            CAM_HR.${type} as a
        where
            a.${key} = #{id}
    </select>
</mapper>