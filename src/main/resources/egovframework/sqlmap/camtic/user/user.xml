<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

    <select id="getOrgDeptList" parameterType="map" resultType="map">
        /* getOrgDeptList */
        SELECT
            EMP_NAME_KR,
            DUTY_NAME,
            BDAY

        FROM  CAM_HR.DJ_EMP_INFO VEI

        WHERE VEI.ACTIVE = 'Y' and VEI.DEPT_NAME = #{deptNm}
    </select>

    <select id="getUserInfo" resultType="map" parameterType="map">
        /* getUserInfo */
        SELECT
            VEI.EMP_SEQ,
            VEI.EMP_NAME_KR,
            VEI.LOGIN_ID,
            VEI.DEPT_SEQ,
            VEI.DEPT_NAME,
            VEI.POSITION_CODE,
            VEI.POSITION_NAME,
            VEI.POSITION_NAME AS POSITION_NAME,
            VEI.DUTY_CODE,
            VEI.DUTY_NAME
        FROM
            CAM_HR.DJ_EMP_INFO VEI
        WHERE 1=1
        <choose>
            <when test='active != null and !"".equals(active)'></when>
            <otherwise>
        AND VEI.ACTIVE = 'Y'
            </otherwise>
        </choose>
        AND VEI.EMP_SEQ = #{empSeq}
    </select>

    <select id="getIdCheck" parameterType="map" resultType="map">
        /* getIdCheck */
        SELECT
            *
        FROM
            CAM_HR.DJ_EMP_INFO
        WHERE
            LOGIN_ID = #{loginId}
    </select>

    <select id="getEmpList" parameterType="map" resultType="map">
        /* getEmpList */
        SELECT
            HEI.EMP_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
            HEI.EMP_NAME_KR
        FROM
            CAM_HR.DJ_EMP_INFO HEI
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE ACTIVE = 'Y'
            <if test='deptSeq != null and deptSeq != ""'>
                AND HEI.DEPT_SEQ IN (
                    SELECT
                        HDI.DEPT_SEQ
                    FROM
                        CAM_HR.DJ_DEPT_INFO HDI
                    WHERE
                        HDI.DEPT_SEQ = #{deptSeq}
                    OR
                        HDI.PARENT_DEPT_SEQ = #{deptSeq}
                )
            </if>
            <if test='empName != null and !"".equals(empName)'>
                AND HEI.EMP_NAME_KR LiKE CONCAT ('%', #{empName}, '%')
            </if>
    </select>

    <select id="getEmpSelList" parameterType="map" resultType="map">
        /* getEmpSelList */
        SELECT
            HEI.EMP_SEQ,
            HEI.ERP_EMP_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_SEQ END AS DEPT_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN (SELECT DEPT_NAME FROM CAM_HR.DJ_DEPT_INFO DI WHERE HDI.PARENT_DEPT_SEQ = DI.DEPT_SEQ) ELSE HEI.DEPT_NAME END AS DEPT_NAME,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_SEQ ELSE "" END AS TEAM_SEQ,
            CASE WHEN HDI.DEPT_LEVEL = 2 THEN HEI.DEPT_NAME ELSE "" END AS TEAM_NAME,
            HEI.EMP_NAME_KR,
            HEI.POSITION_CODE,
            HEI.POSITION_NAME,
            HEI.DUTY_CODE,
            HEI.DUTY_NAME,
            HEI.JOB_DETAIL
        FROM
            CAM_HR.DJ_EMP_INFO HEI
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO HDI ON HEI.DEPT_SEQ = HDI.DEPT_SEQ
        WHERE
            1 = 1
        AND
            HEI.EMP_SEQ IN
            <foreach collection="empArr" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
    </select>

    <update id="setUserInfoUpdate" parameterType="list">
        /* setUserInfoUpdate */
        UPDATE
            CAM_HR.DJ_EMP_INFO
        SET
            DEPT_SEQ = #{deptSeq},
            DEPT_NAME = #{afDeptName},
            DEPT_TEAM_NAME = #{afTeamName},
            POSITION_CODE = #{afPositionCode},
            POSITION_NAME = IFNULL(#{position}, ""),
            GRADE_NAME = #{afGradeName},
            DUTY_CODE = #{afDutyCode},
            DUTY_NAME = IFNULL(#{afDutyName}, ""),
            JOB_DETAIL = #{afJobDetail}
        WHERE
            EMP_SEQ = #{hisEmpSeq}
    </update>

    <select id="getUserPersonnelOne" parameterType="map" resultType="map">
        /* getUserPersonnelOne */
        SELECT
            *
        FROM
            cam_hr.dj_emp_info AS a
        WHERE
            a.EMP_SEQ = #{pk};
    </select>

    <select id="getUserImageInfo" resultType="map" parameterType="map">
        /* getUserImageInfo */
        SELECT
            IM.IMAGE_ID,
            IM.EMP_SEQ,
            IM.SIGN_IMAGE_PK,
            IM.ID_IMAGE_PK,
            IM.PERSONAL_IMAGE_PK
        FROM
            CAM_INSIDE.DJ_IMAGE_MANAGE IM
        WHERE
            IM.EMP_SEQ = #{pk}
    </select>
</mapper>