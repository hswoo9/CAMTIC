<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="item">

    <select id="getItemWhInfoList" parameterType="map" resultType="map">
        /* getItemWhInfoList */
        SELECT
            WI.*,
            CI.CRM_NM,
            WHC.ITEM_CD_NM AS WH_CD_NM,
            WTC.ITEM_CD_NM AS WH_TYPE_NM
        FROM
            CAM_ITEM.DJ_ITEM_WH_INFO WI
        JOIN
            CAM_CRM.DJ_CRM_INFO CI
        ON WI.CRM_SN = CI.CRM_SN
        JOIN
            CAM_ITEM.DJ_ITEM_CD WHC
        ON WHC.LG_CD = 'WH' AND WI.WH_CD = WHC.ITEM_CD
        JOIN
            CAM_ITEM.DJ_ITEM_CD WTC
        ON WTC.LG_CD = 'WT' AND WI.WH_TYPE = WTC.ITEM_CD
        WHERE 1=1
        <if test='whType != null and !"".equals(whType)'>
            AND WI.WH_TYPE = #{whType}
        </if>

        <if test='whCd != null and !"".equals(whCd)'>
            AND WI.WH_CD = #{whCd}
        </if>

        <choose>
            <when test='searchKeyword != null and !"".equals(searchKeyword)'>
                AND WI.${searchKeyword} LIKE CONCAT('%', #{searchValue}, '%')
            </when>
            <otherwise>
                AND (
                    WI.ITEM_NO LIKE CONCAT('%', #{searchValue}, '%') OR
                    WI.ITEM_NAME LIKE CONCAT('%', #{searchValue}, '%')
                )
            </otherwise>
        </choose>

        <if test='inspection != null and !"".equals(inspection)'>
            AND WI.INSPECTION = #{inspection}
        </if>

    </select>

    <update id="setInspectionUpd" parameterType="map">
        /* setInspectionUpd */
        UPDATE
            CAM_ITEM.DJ_ITEM_WH_INFO
        SET
            INSPECTION = #{inspection},
            MOD_EMP_SEQ = #{empSeq},
            MOD_DT = NOW()
        WHERE
            ITEM_WH_SN IN (${whSn})
    </update>

    <insert id="setReceivingReg" parameterType="map">
        /* setReceivingReg */
        INSERT INTO CAM_ITEM.DJ_ITEM_WH_INFO
        (
            CRM_SN,
            ITEM_NO,
            ITEM_NAME,
            ITEM_UNIT_CD,
            INVEN_AMT,
            WH_TYPE,
            WH_VOLUME,
            WH_WEIGHT,
            WH_CD,
            WH_TOTAL,
            WH_DT,
            WH_NO,
            UNIT_PRICE,
            AMT,
            ORDER_NO,
            ORDER_DT,
            ORDER_VOLUME,
            RMK,
            REG_EMP_SEQ
        )
        VALUES
        <foreach collection="newRateArr" item="item" separator=" , ">
        (
            #{item.crmSn},
            #{item.itemNo},
            #{item.itemName},
            #{item.itemUnitCd},
            #{item.invenAmt},
            #{item.whType},
            #{item.whVolume},
            #{item.whWeight},
            #{item.whCd},
            #{item.whTotal},
            #{item.whDt},
            #{item.whNo},
            #{item.unitPrice},
            #{item.amt},
            #{item.orderNo},
            #{item.orderDt},
            #{item.orderVolume},
            #{item.rmk},
            #{item.empSeq}
        )
        </foreach>
    </insert>

    <update id="setReceivingRegUpd" parameterType="map">
        /* setReceivingRegUpd */
        UPDATE
            CAM_ITEM.DJ_ITEM_WH_INFO
        SET
            CRM_SN = #{crmSn},
            ITEM_NO = #{empSeq},
            ITEM_NAME = #{itemName},
            ITEM_UNIT_CD = #{itemUnitCd},
            INVEN_AMT = #{invenAmt},
            WH_TYPE = #{whType},
            WH_VOLUME = #{whVolume},
            WH_WEIGHT = #{whWeight},
            WH_CD = #{whCd},
            WH_TOTAL = #{whTotal},
            WH_DT = #{whDt},
            WH_NO = #{whNo},
            UNIT_PRICE = #{unitPrice},
            AMT = #{amt},
            ORDER_NO = #{orderNo},
            ORDER_DT = #{orderDt},
            ORDER_VOLUME = #{orderVolume},
            RMK = #{rmk},
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            ITEM_WH_SN = #{itemWhSn}
    </update>

    <select id="getItemInvenList" parameterType="map" resultType="map">
        /* getItemInvenList */
        SELECT
            II.*,
            WHC.ITEM_CD_NM AS WH_CD_NM
        FROM
            CAM_ITEM.DJ_ITEM_INVENTORY II
        JOIN
            CAM_ITEM.DJ_ITEM_CD WHC
        ON WHC.LG_CD = 'WH' AND II.WH_CD = WHC.ITEM_CD
        <if test='whCd != null and !"".equals(whCd)'>
            AND II.WH_CD = #{whCd}
        </if>

        <choose>
            <when test='searchKeyword != null and !"".equals(searchKeyword)'>
                AND II.${searchKeyword} LIKE CONCAT('%', #{searchValue}, '%')
            </when>
            <otherwise>
                AND (
                    II.ITEM_NO LIKE CONCAT('%', #{searchValue}, '%') OR
                    II.ITEM_NAME LIKE CONCAT('%', #{searchValue}, '%')
                )
            </otherwise>
        </choose>
    </select>

    <select id="getItemInven" parameterType="map" resultType="map">
        /* getItemInven */
        SELECT
            II.*,
            WHC.ITEM_CD_NM AS WH_CD_NM
        FROM
            CAM_ITEM.DJ_ITEM_INVENTORY II
        JOIN
            CAM_ITEM.DJ_ITEM_CD WHC
        ON WHC.LG_CD = 'WH' AND II.WH_CD = WHC.ITEM_CD
        WHERE
            II.INVEN_SN = #{invenSn}
    </select>

    <insert id="setInvenTransferReg" parameterType="map">
        /* setInvenTransferReg */
        INSERT INTO CAM_ITEM.DJ_ITEM_INVENTORY_TRANSFER
        (
            FORWARDING_DATE,
            INVEN_SN,
            ITEM_NO,
            ITEM_NAME,
            CURRENT_INVEN,
            TRANSFER_QTY,
            FORWARDING_WH_CD,
            RECEIVING_WH_CD,
            RMK,
            REG_EMP_SEQ
        )
        VALUES
        <foreach collection="newRateArr" item="item" separator=" , ">
        (
            #{item.forwardingDate},
            #{item.invenSn},
            #{item.itemNo},
            #{item.itemName},
            #{item.currentInven},
            #{item.transferQty},
            #{item.forwardingWhCd},
            #{item.receivingWhCd},
            #{item.rmk},
            #{item.empSeq}
        )
        </foreach>
    </insert>

    <update id="setInvenTransferRegUpd" parameterType="map">
        /* setInvenTransferRegUpd */
        UPDATE
            CAM_ITEM.DJ_ITEM_INVENTORY_TRANSFER
        SET
            FORWARDING_DATE = #{forwardingDate},
            INVEN_SN = #{invenSn},
            ITEM_NO = #{itemNo},
            ITEM_NAME = #{itemName},
            CURRENT_INVEN = #{currentInven},
            TRANSFER_QTY = #{transferQty},
            FORWARDING_WH_CD = #{forwardingWhCd},
            RECEIVING_WH_CD = #{receivingWhCd},
            RMK = #{rmk},
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            INVEN_TRANS_SN = #{invenTransSn}
    </update>
</mapper>