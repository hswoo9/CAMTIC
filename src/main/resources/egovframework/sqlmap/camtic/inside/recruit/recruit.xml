<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recruit">

    <select id="getRecruitNum" resultType="map">
        /* getRecruitNum */
        SELECT CONCAT('제', DATE_FORMAT(NOW(), '%Y'), '-', LPAD((SELECT IFNULL(max(siri.RECRUIT_SN), 0)+1 FROM cam_inside.dj_recruit_info siri), '2', '0'), '호') AS RECRUIT_NUM FROM DUAL
    </select>

    <select id="getRecruitList" parameterType="map" resultType="map">
        /*getRecruitList*/
        SELECT
            RE.*
        FROM
            (
            SELECT
                @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                IRI.*
            FROM
                CAM_INSIDE.DJ_RECRUIT_INFO IRI,
                (SELECT @ROWNUM := 0) TMP
            WHERE
                1=1
            ORDER BY IRI.REG_DT
            ) RE
        ORDER BY RE.REG_DT DESC
    </select>

    <select id="getRecruit" parameterType="map" resultType="map">
        /* getRecruit */
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_RECRUIT_INFO
        WHERE
            RECRUIT_INFO_SN = #{recruitInfoSn}
    </select>

    <select id="getCommissionerList" parameterType="map" resultType="map">
        /*getCommissionerList*/
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    IRCI.*
                FROM
                    CAM_INSIDE.DJ_RECRUIT_COMMISSIONER_INFO IRCI,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                ORDER BY IRCI.REG_DT
            ) RE
        ORDER BY RE.REG_DT DESC
    </select>

    <insert id="setRecruitInsert" parameterType="map">
        /* setRecruitInsert */
        INSERT INTO CAM_INSIDE.DJ_RECRUIT_INFO
            (
                RECRUIT_NUM,
                RECRUIT_TITLE,
                RECRUIT_DETAIL,
                UPLOAD_DT,
                UPLOAD_TEXT,
                START_DT,
                END_DT,
                START_TIME,
                END_TIME,
                JOB_POSITION_ETC,
                ELIGIBILITY_ETC,
                WORK_TYPE,
                ADMISSION,
                RECEIPT_DOCU,
                REMARK,
                RECRUIT_STATUS_SN,
                RECRUIT_STATUS_TEXT,
                REG_EMP_SEQ,
                REG_EMP_NAME
            )
        VALUE
            (
                #{recruitNum},
                #{recruitTitle},
                #{recruitDetail},
                #{uploadDt},
                #{uploadText},
                #{startDt},
                #{endDt},
                #{startTime},
                #{endTime},
                #{jobPositionEtc},
                #{eligibilityEtc},
                #{workType},
                #{admission},
                #{receiptDocu},
                #{remark},
                #{recruitStatusSn},
                #{recruitStatusText},
                #{regEmpSeq},
                #{regEmpName}
            )
        <selectKey keyProperty="recruitInfoSn" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_INSIDE' AND TABLE_NAME = 'DJ_RECRUIT_INFO'
        </selectKey>
    </insert>

    <update id="setRecruitUpdate" parameterType="map">
        /* setRecruitUpdate */
        UPDATE
            CAM_INSIDE.DJ_RECRUIT_INFO
        SET
            RECRUIT_TITLE = #{recruitTitle},
            RECRUIT_DETAIL = #{recruitDetail},
            UPLOAD_DT = #{uploadDt},
            UPLOAD_TEXT = #{uploadText},
            START_DT = #{startDt},
            END_DT = #{endDt},
            START_TIME = #{startTime},
            END_TIME = #{endTime},
            JOB_POSITION_ETC = #{jobPositionEtc},
            ELIGIBILITY_ETC = #{eligibilityEtc},
            WORK_TYPE = #{workType},
            ADMISSION = #{admission},
            RECEIPT_DOCU = #{receiptDocu},
            REMARK = #{remark},
            RECRUIT_STATUS_SN = #{recruitStatusSn},
            RECRUIT_STATUS_TEXT = #{recruitStatusText},
            MOD_EMP_SEQ = #{regEmpSeq},
            MOD_DATE = NOW()
        WHERE
            RECRUIT_INFO_SN = #{recruitInfoSn}
    </update>

    <delete id="setRecruitAreaDelete" parameterType="map">
        /* setRecruitAreaDelete */
        DELETE FROM CAM_INSIDE.DJ_RECRUIT_AREA_INFO WHERE RECRUIT_INFO_SN = #{recruitInfoSn}
    </delete>

    <insert id="setRecruitAreaInsert" parameterType="map">
        /* setRecruitAreaInsert */
        INSERT INTO CAM_INSIDE.DJ_RECRUIT_AREA_INFO
            (
                RECRUIT_INFO_SN,
                DEPT_SEQ,
                DEPT_NAME,
                TEAM_SEQ,
                TEAM_NAME,
                JOB,
                RECRUITMENT,
                CAREER_TYPE,
                DUTY,
                CAREER,
                WORK_TYPE,
                QUALIFICATION
            )
        VALUES
        <foreach collection="area" item="item" separator=" , ">
            (
                #{recruitInfoSn},
                #{item.deptSeq},
                #{item.deptName},
                #{item.teamSeq},
                #{item.teamName},
                #{item.job},
                #{item.recruitment},
                #{item.careerType},
                #{item.duty},
                #{item.career},
                #{item.workType},
                #{item.qualification}
            )
        </foreach>
    </insert>

    <insert id="setCommissionerInsert" parameterType="map">
        /* setCommissionerInsert */
        INSERT INTO CAM_INSIDE.DJ_RECRUIT_COMMISSIONER_INFO
            (
                ID,
                NAME,
                FIRST_RRN_NAME,
                SECOND_RRN_NAME,
                TEL_NUM,
                EMAIL,
                BELONG,
                REG_EMP_SEQ,
                REG_EMP_NAME,
                GENDER,
                DUTY_POSITION,
                BMK
            )
        VALUE
            (
                #{id},
                #{name},
                #{firstRrnName},
                #{secondRrnName},
                #{telNum},
                #{email},
                #{belong},
                #{regEmpSeq},
                #{regEmpName},
                #{gender},
                #{dutyPosition},
                #{bmk}
            )
    </insert>

    <select id="getRecruitAreaList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_RECRUIT_AREA_INFO
        WHERE 1=1
        <choose>
            <when test='RECRUIT_INFO_SN != null and !"".equals(RECRUIT_INFO_SN)'>
                AND RECRUIT_INFO_SN = #{RECRUIT_INFO_SN}
            </when>
            <when test='recruitInfoSn != null and !"".equals(recruitInfoSn)'>
                AND RECRUIT_INFO_SN = #{recruitInfoSn}
            </when>
        </choose>

        ORDER BY REG_DT DESC
    </select>

    <select id="getRecruitArea" parameterType="map" resultType="map">
        /* getRecruitArea */
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_RECRUIT_AREA_INFO
        WHERE 1=1
            AND RECRUIT_AREA_INFO_SN = #{recruitAreaInfoSn}
    </select>

</mapper>



