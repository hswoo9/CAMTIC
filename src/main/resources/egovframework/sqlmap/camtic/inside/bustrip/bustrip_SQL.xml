<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bustrip">

    <select id="getUserList" parameterType="map" resultType="map">
        /* getUserList Ma */
        SELECT
            emp_seq,
            login_id,
            erp_emp_seq,
            emp_name_kr,
            dept_seq,
            dept_name,
            position_code,
            position_name,
            duty_code,
            duty_name
        FROM
            CAM_HR.DJ_EMP_INFO
        WHERE
            ACTIVE = "Y"
    </select>


    <insert id="insBustripReq" parameterType="map">
        INSERT INTO CAM_INSIDE.DJ_HR_BIZ_REQ
        (
            EMP_SEQ,
            EMP_NAME,
            DEPT_SEQ,
            POSITION_CODE,
            DUTY_CODE,
            APPLY_DATE,
            TRIP_CODE,
            VISIT_LOC,
            VISIT_LOC_SUB,
            TRIP_DAY_FR,
            TRIP_DAY_TO,
            TRIP_TIME_FR,
            TRIP_TIME_TO,
            BUSN_NAME,
            TITLE,
            USE_CAR,
            USE_TRSPT,
            PROJECT,
            PROJECT_CD,
            REG_EMP_SEQ
        ) VALUES
        (
             #{empSeq},
             #{empName},
             #{deptSeq},
             #{positionCode},
             #{dutyCode},
             #{applyDate},
             #{tripCode},
             #{visitLoc},
             #{visitLocSub},
             #{tripDayFr},
             #{tripDayTo},
             #{tripTimeFr},
             #{tripTimeTo},
             #{busnName},
             #{title},
             #{useCar},
             #{useTrspt},
             #{project},
             #{projectCd},
             #{empSeq}
        )

        <selectKey keyProperty="hrBizReqId" resultType="Integer" order="BEFORE">
            SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CAM_INSIDE' AND TABLE_NAME = 'DJ_HR_BIZ_REQ'
        </selectKey>
    </insert>

    <insert id="insBustripCompanion" parameterType="map">
        /* insBustripCompanion */
        INSERT INTO CAM_INSIDE.DJ_HR_BIZ_COMPANION
        (
            HR_BIZ_REQ_ID,
            EMP_SEQ,
            DEPT_NAME,
            POSITION_NAME,
            DUTY_NAME,
            EMP_NAME
        ) VALUES
        (
            #{hrBizReqId},
            #{compEmpSeq},
            #{compDeptName},
            #{compPositionName},
            #{compDutyName},
            #{compEmpName}
        )
    </insert>

    <select id="getBustripReq" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HR_BIZ_REQ
        WHERE
        <![CDATA[
            TRIP_DAY_FR >= #{startDate} AND TRIP_DAY_TO <= #{endDate}
        ]]>
        <if test="projectCd != null and projectCd != ''">
            AND
            PROJECT_CD = #{projectCd}
        </if>
        <if test="busnName != null and busnName != ''">
            AND
            BUSN_NAME like concat('%', #{busnName}, '%')
        </if>

    </select>

    <select id="getBustripReqInfo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HR_BIZ_REQ A
        WHERE
            A.HR_BIZ_REQ_ID = #{hrBizReqId}
    </select>

    <select id="getBustripCompanionInfo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_INSIDE.DJ_HR_BIZ_COMPANION A
        WHERE
            A.HR_BIZ_REQ_ID = #{hrBizReqId}
    </select>

    <delete id="delBustripReq" parameterType="map">
        DELETE FROM
            CAM_INSIDE.DJ_HR_BIZ_REQ
        WHERE
            HR_BIZ_REQ_ID IN
        <foreach collection="keyAr" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </delete>

    <delete id="delBustripCompn" parameterType="map">
        DELETE FROM
        CAM_INSIDE.DJ_HR_BIZ_COMPANION
        WHERE
        HR_BIZ_REQ_ID IN
        <foreach collection="keyAr" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </delete>

    <select id="getBustripReqFileInfo" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            CAM_COMMON.DJ_FILE_INFO
        WHERE
            CONTENT_ID = #{hrBizReqId}
        AND
            FILE_CD = #{fileCd}
    </select>
</mapper>