<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="document">

    <select id="getDocumentList" resultType="map" parameterType="map">
        /* getDocumentList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    CCD.*,
                    DATE_FORMAT(CCD.EFFECTIVE_DT, '%Y-%m-%d') AS EFFECTIVE_DATE,
                    DATE_FORMAT(CCD.SHIPMENT_DT, '%Y-%m-%d') AS SHIPMENT_DATE
                FROM
                    CAM_COMMON.DJ_CAMTIC_DOCUMENT CCD,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                <if test='docuType != null and !"".equals(docuType)'>
                    AND CCD.DOCU_TYPE = #{docuType}
                </if>
                <if test='documentPart != null and !"".equals(documentPart)'>
                    AND CCD.DOCUMENT_PART_TYPE = #{documentPart}
                </if>
                <if test='deptPart != null and !"".equals(deptPart)'>
                    AND CCD.DEPT_PART_TYPE = #{documentPart}
                </if>
                <choose>
                    <when test='searchText != null and !"".equals(searchText) and "1".equals(searchType)'>
                        AND CCD.DOCUMENT_TITLE_NAME like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "2".equals(searchType)'>
                        AND CONCAT(CCD.DOCUMENT_FIRST_NUMBER,'-',CCD.DOCUMENT_SECOND_NUMBER) like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "3".equals(searchType)'>
                        AND DATE_FORMAT(CCD.EFFECTIVE_DT, '%Y-%m-%d') like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "4".equals(searchType)'>
                        AND CCD.RECEIVE_NAME like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "5".equals(searchType)'>
                        AND DATE_FORMAT(CCD.SHIPMENT_DT, '%Y-%m-%d') like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "6".equals(searchType)'>
                        AND CCD.MANAGER_NAME like CONCAT('%', #{searchText}, '%')
                    </when>
                    <when test='searchText != null and !"".equals(searchText) and "6".equals(searchType)'>
                        AND CCD.REMARK_CN like CONCAT('%', #{searchText}, '%')
                    </when>
                </choose>
                ORDER BY CCD.REG_DT
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <select id="getDocuOrderList" resultType="map" parameterType="map">
        /* getDocuOrderList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    IDO.*
                FROM
                    CAM_INSIDE.DJ_DOCUMENT_ORDER IDO,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                    <if test='classType != null and !"".equals(classType)'>
                        AND IDO.CLASS_SN = #{classType}
                    </if>
                    <choose>
                        <when test='searchText != null and !"".equals(searchText) and "1".equals(searchType)'>
                            AND CONCAT(IDO.DOCU_YEAR_SN,'-',IDO.DOCU_NO) like CONCAT('%', #{searchText}, '%')
                        </when>
                        <when test='searchText != null and !"".equals(searchText) and "2".equals(searchType)'>
                            AND IDO.PROJECT_NAME like CONCAT('%', #{searchText}, '%')
                        </when>
                        <when test='searchText != null and !"".equals(searchText) and "3".equals(searchType)'>
                            AND DATE_FORMAT(IDO.CO_NAME, '%Y-%m-%d') like CONCAT('%', #{searchText}, '%')
                        </when>
                    </choose>
                ORDER BY IDO.REG_DT
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <select id="getDocuContractList" resultType="map" parameterType="map">
        /* getDocuContractList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    IDC.*
                FROM
                    CAM_INSIDE.DJ_DOCUMENT_CONTRACT IDC,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                    <if test='classType != null and !"".equals(classType)'>
                        AND IDC.CLASS_SN = #{classType}
                    </if>
                    <choose>
                        <when test='searchText != null and !"".equals(searchText) and "1".equals(searchType)'>
                            AND CONCAT(IDC.DOCU_YEAR_SN,'-',IDC.DOCU_NO) like CONCAT('%', #{searchText}, '%')
                        </when>
                        <when test='searchText != null and !"".equals(searchText) and "2".equals(searchType)'>
                            AND IDC.PROJECT_NAME like CONCAT('%', #{searchText}, '%')
                        </when>
                        <when test='searchText != null and !"".equals(searchText) and "3".equals(searchType)'>
                            AND DATE_FORMAT(IDC.CO_NAME, '%Y-%m-%d') like CONCAT('%', #{searchText}, '%')
                        </when>
                    </choose>
                ORDER BY IDC.REG_DT
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <select id="getSnackList" resultType="map" parameterType="map">
        /* getSnackList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    ISI.*
                FROM
                    CAM_INSIDE.DJ_SNACK_INFO ISI,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    1=1
                ORDER BY ISI.REG_DT
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <select id="getSnackOne" resultType="map" parameterType="map">
        /* getSnackOne */
        SELECT
            ISI.SNACK_INFO_SN,
            ISI.USE_DT,
            ISI.USE_TIME,
            ISI.SNACK_TYPE,
            ISI.SNACK_TYPE_TEXT,
            ISI.USER_SN,
            ISI.USER_TEXT,
            ISI.PAY_TYPE,
            ISI.PAY_TYPE_TEXT,
            ISI.RECIPIENT_EMP_SEQ,
            ISI.RECIPIENT_EMP_NAME,
            ISI.CARD_TEXT,
            ISI.AREA_SEQ,
            ISI.AREA_NAME,
            ISI.AMOUNT_SN,
            ISI.USE_REASON,
            ISI.REG_EMP_SEQ,
            ISI.REG_EMP_NAME,
            ISI.STATUS,
            HEI.EMP_NAME_KR,
            HEI.DEPT_NAME,
            HEI.DEPT_TEAM_NAME,
            CASE WHEN HEI.DUTY_NAME IS NULL THEN HEI.POSITION_NAME ELSE HEI.DUTY_NAME END AS POSITION_NAME
        FROM
            CAM_INSIDE.DJ_SNACK_INFO ISI
        LEFT JOIN
            CAM_HR.DJ_EMP_INFO HEI ON ISI.REG_EMP_SEQ = HEI.EMP_SEQ
        WHERE
            SNACK_INFO_SN = #{snackInfoSn}
    </select>

    <insert id="setDocumentInsert" parameterType="map">
        /* setDocumentInsert */
        INSERT INTO CAM_COMMON.DJ_CAMTIC_DOCUMENT
            (
                DOCU_TYPE,
                DOCUMENT_PART_TYPE,
                DOCUMENT_PART_NAME,
                EFFECTIVE_DT,
                SHIPMENT_DT,
                RECEIVE_NAME,
                MANAGER_SN,
                MANAGER_NAME,
                DOCUMENT_TITLE_NAME,
                <if test='"2".equals(docuType)'>
                    DEPT_PART_TYPE,
                    DEPT_PART_TEXT,
                    <if test='"6".equals(deptPartType)'>
                        USER_SN,
                        USER_TEXT,
                    </if>
                </if>
                REMARK_CN,
                DOCUMENT_FIRST_NUMBER,
                DOCUMENT_SECOND_NUMBER,
                REG_EMP_SEQ,
                REG_EMP_NAME,
                REG_DT
            )
        VALUES
            (
                #{docuType},
                #{documentPartType},
                #{documentPartName},
                #{effectiveDt},
                #{shipmentDt},
                #{receiveName},
                #{managerSn},
                #{managerName},
                #{documentTitleName},
                <if test='"2".equals(docuType)'>
                    #{deptPartType},
                    #{deptPartText},
                    <if test='"6".equals(deptPartType)'>
                        #{userSn},
                        #{userText},
                    </if>
                </if>
                #{remarkCn},
                CONCAT(#{documentPartName}, RIGHT(DATE_FORMAT(NOW(), '%Y'), 2)),
                (SELECT IFNULL(MAX(SCCD.DOCUMENT_SECOND_NUMBER), 0)+1 FROM CAM_COMMON.DJ_CAMTIC_DOCUMENT SCCD WHERE SCCD.DOCUMENT_FIRST_NUMBER = CONCAT(#{documentPartName}, RIGHT(DATE_FORMAT(NOW(), '%Y'), 2))),
                #{regEmpSeq},
                #{regEmpName},
                NOW()
            )
    </insert>

    <insert id="setDocuOrderInsert" parameterType="map">
        /* setDocuOrderInsert */
        INSERT INTO CAM_INSIDE.DJ_DOCUMENT_ORDER
            (
                MAIN_CLASS_SN,
                CLASS_SN,
                CLASS_NAME,
                DOCU_YEAR_SN,
                DOCU_NO,
                DOCU_DE,
                DOCU_CHECK_SN,
                DOCU_CHECK_NAME,
                PROJECT_NAME,
                START_DE,
                END_DE,
                CO_SN,
                CO_NAME,
                CONDITION_NAME,
                REMARK_CN,
                REG_EMP_SEQ,
                REG_EMP_NAME,
                REG_DT
            )
        VALUES
            (
                1,
                #{classSn},
                #{className},
                CONCAT('TICS', RIGHT(DATE_FORMAT(NOW(), '%Y'), 2)),
                (SELECT IFNULL(MAX(SIDO.DOCU_NO), 0)+1 FROM CAM_INSIDE.DJ_DOCUMENT_ORDER SIDO WHERE DOCU_YEAR_SN = CONCAT('TICS', RIGHT(DATE_FORMAT(NOW(), '%Y'), 2))),
                #{docuDe},
                #{docuCheckSn},
                #{docuCheckName},
                #{projectName},
                #{startDe},
                #{endDe},
                #{coSn},
                #{coName},
                #{conditionName},
                #{remarkCn},
                #{regEmpSeq},
                #{regEmpName},
                NOW()
            )
    </insert>

    <insert id="setDocuContractInsert" parameterType="map">
        /* setDocuContractInsert */
        INSERT INTO CAM_INSIDE.DJ_DOCUMENT_CONTRACT
            (
                MAIN_CLASS_SN,
                MAIN_CLASS_NAME,
                CLASS_SN,
                CLASS_NAME,
                DOCU_YEAR_SN,
                DOCU_NO,
                DOCU_DE,
                PROJECT_NAME,
                PROJECT_MONEY,
                START_DE,
                END_DE,
                CO_SN,
                CO_NAME,
                REMARK_CN,
                REG_EMP_SEQ,
                REG_EMP_NAME,
                REG_DT
            )
        VALUES
            (
                #{mainClassSn},
                #{mainClassName},
                #{classSn},
                #{className},
                CONCAT(#{docuName}, RIGHT(DATE_FORMAT(NOW(), '%Y'), 2)),
                (SELECT IFNULL(MAX(SIDC.DOCU_NO), 0)+1 FROM CAM_INSIDE.DJ_DOCUMENT_CONTRACT SIDC WHERE DOCU_YEAR_SN = CONCAT(#{docuName}, RIGHT(DATE_FORMAT(NOW(), '%Y'), 2))),
                #{docuDe},
                #{projectName},
                #{projectMoney},
                #{startDe},
                #{endDe},
                #{coSn},
                #{coName},
                #{remarkCn},
                #{regEmpSeq},
                #{regEmpName},
                NOW()
            )
    </insert>

    <insert id="setSnackInsert" parameterType="map">
        /* setSnackInsert */
        INSERT INTO CAM_INSIDE.DJ_SNACK_INFO
            (
                USE_DT,
                USE_TIME,
                SNACK_TYPE,
                SNACK_TYPE_TEXT,
                USER_SN,
                USER_TEXT,
                PAY_TYPE,
                PAY_TYPE_TEXT,
                RECIPIENT_EMP_SEQ,
                RECIPIENT_EMP_NAME,
                AREA_SEQ,
                AREA_NAME,
                AMOUNT_SN,
                USE_REASON,
                REG_EMP_SEQ,
                REG_EMP_NAME
            )
        VALUES
            (
                #{useDt},
                CONCAT(#{useHour}, ':', #{useMin}),
                #{snackType},
                #{snackTypeText},
                #{userSn},
                #{userText},
                #{payType},
                #{payTypeText},
                #{chargeUser},
                #{chargeUserText},
                #{areaSn},
                #{areaName},
                #{usAmount},
                #{useReason},
                #{empSeq},
                #{empName}
            )
    </insert>

    <update id="setSnackReqCert" parameterType="map">
        /* setSnackReqCert */
        UPDATE
            CAM_INSIDE.DJ_SNACK_INFO
        SET
        <if test='status != null and !"".equals(status) and !"110".equals(status)'>
            APPROVAL_EMP_SEQ = #{empSeq},
            APPROVAL_RESULT_DATE = now(),
        </if>
            STATUS = ${status}
        WHERE
            <if test='snackInfoSn != null and !"".equals(snackInfoSn)'>
                SNACK_INFO_SN = #{snackInfoSn}
            </if>
            <if test='snackInfoSnArr != null and !"".equals(snackInfoSnArr)'>
                SNACK_INFO_SN IN (${snackInfoSnArr})
            </if>
    </update>

</mapper>