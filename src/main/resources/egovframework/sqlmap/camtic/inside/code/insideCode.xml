<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="insideCode">

    <select id="getCarCode" parameterType="map" resultType="map">
        /* getCarCode */
        SELECT
            IHCC.CAR_CLASS_SN AS value,
            IHCC.CAR_CLASS_Name AS text
        FROM
            CAM_INSIDE.DJ_HR_CAR_CODE IHCC
        WHERE
            ACTIVE = 'Y'
    </select>

    <select id="getCarRequestInfo" parameterType="map" resultType="map">
        /* getCarRequestInfo */
        SELECT
            IHCR.CAR_REQ_SN,
            IHCR.START_DT,
            IHCR.END_DT,
            IHCR.START_TIME,
            IHCR.END_TIME,
            IHCR.USE_DEPT_SEQ,
            IHCR.USE_DEPT_NAME,
            IHCR.CAR_CLASS_SN,
            IHCR.CAR_CLASS_TEXT,
            IHCR.CAR_TYPE_SN,
            IHCR.CAR_TYPE_TEXT,
            IHCR.CAR_TITLE_NAME,
            IHCR.VISIT_NAME,
            IHCR.WAY_POINT_NAME,
            IHCR.EMP_SEQ,
            IHCR.EMP_NAME,
            IHCR.EMERGENCY_NAME,
            IHCR.EMERGENCY_TEL,
            IHCR.REG_EMP_SEQ,
            IHCR.REG_EMP_NAME
        FROM
            CAM_INSIDE.DJ_HR_CAR_REQ IHCR
        WHERE IHCR.CAR_REQ_SN = #{carReqSn}
    </select>

    <select id="getCarRequestList" parameterType="map" resultType="map">
        /* getCarRequestList */
        SELECT
            IHCR.CAR_REQ_SN,
            CONCAT('[',IHCR.CAR_CLASS_TEXT,']') AS schTitle,
            CONCAT(IHCR.START_DT, ' ',IHCR.START_TIME) AS START_DATE,
            CONCAT(IHCR.END_DT, ' ',IHCR.END_TIME) AS END_DATE
        FROM
            CAM_INSIDE.DJ_HR_CAR_REQ IHCR
    </select>

    <select id="searchDuplicateCar" parameterType="map" resultType="map">
        /* searchDuplicateCar */
        <![CDATA[
            SELECT
                IHCR.EMP_NAME
            FROM
                CAM_INSIDE.DJ_HR_CAR_REQ IHCR
            WHERE
                CONCAT(REPLACE(IHCR.START_DT, '-', ''), REPLACE(IHCR.START_TIME, ':', '')) < CONCAT(REPLACE(#{endDt}, '-', ''), REPLACE(#{endTime}, ':', ''))
            AND CONCAT(REPLACE(IHCR.END_DT, '-', ''), REPLACE(IHCR.END_TIME, ':', '')) > CONCAT(REPLACE(#{startDt}, '-', ''), REPLACE(#{startTime}, ':', ''))
            AND CAR_CLASS_SN = #{carClassSn}
        ]]>
        <if test='carReqSn != null and !"".equals(carReqSn)'>
            AND !CAR_REQ_SN = #{carReqSn}
        </if>
    </select>

    <select id="getCarCodeInfo" parameterType="map" resultType="map">
        /* getCarCodeInfo */
        SELECT
            IHCC.*
        FROM
            CAM_INSIDE.DJ_HR_CAR_CODE IHCC
        WHERE
            CAR_CODE_SN = #{carCodeSn}
    </select>

    <select id="getCarCodeList" parameterType="map" resultType="map">
        /* getCarCodeList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                IHCC.*
                FROM
                    CAM_INSIDE.DJ_HR_CAR_CODE IHCC,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    VISIBLE = 'Y'
                ORDER BY IHCC.REG_DATE
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <select id="getRoomCodeInfo" parameterType="map" resultType="map">
        /* getRoomCodeInfo */
        SELECT
            IRC.*
        FROM
            CAM_INSIDE.DJ_ROOM_CODE IRC
        WHERE
            ROOM_CODE_SN = #{roomCodeSn}
    </select>

    <select id="getRoomCodeList" parameterType="map" resultType="map">
        /* getRoomCodeList */
        SELECT
            RE.*
        FROM
            (
                SELECT
                    @ROWNUM := @ROWNUM + 1 AS ROW_NUM,
                    IRC.*
                FROM
                    CAM_INSIDE.DJ_ROOM_CODE IRC,
                    (SELECT @ROWNUM := 0) TMP
                WHERE
                    VISIBLE = 'Y'
                ORDER BY IRC.REG_DATE
            ) RE
        ORDER BY RE.ROW_NUM DESC
    </select>

    <insert id="setCarRequestInsert" parameterType="map">
        /* setCarRequestInsert */
        INSERT INTO CAM_INSIDE.DJ_HR_CAR_REQ
            (
                START_DT,
                END_DT,
                START_TIME,
                END_TIME,
                USE_DEPT_SEQ,
                USE_DEPT_NAME,
                CAR_CLASS_SN,
                CAR_CLASS_TEXT,
                CAR_TYPE_SN,
                CAR_TYPE_TEXT,
                CAR_TITLE_NAME,
                VISIT_NAME,
                WAY_POINT_NAME,
                EMP_SEQ,
                EMP_NAME,
                <if test='"1".equals(carType)'>
                    EMERGENCY_NAME,
                    EMERGENCY_TEL,
                </if>
                REG_EMP_SEQ,
                REG_EMP_NAME,
                REG_DT
            )
        VALUES
            (
                #{startDt},
                #{endDt},
                #{startTime},
                #{endTime},
                #{useDeptSeq},
                #{useDeptName},
                #{carClassSn},
                #{carClassText},
                #{carTypeSn},
                #{carTypeText},
                #{carTitleName},
                #{visitName},
                #{waypointName},
                #{empSeq},
                #{empName},
                <if test='"1".equals(carType)'>
                    #{emergencyName},
                    #{emergencyTel},
                </if>
                #{regEmpSeq},
                #{regEmpName},
                NOW()
            )
    </insert>

    <update id="setCarRequestUpdate" parameterType="map">
        /* setCarRequestUpdate */
        UPDATE
            CAM_INSIDE.DJ_HR_CAR_REQ
        SET
            START_DT = #{startDt},
            END_DT = #{endDt},
            START_TIME = #{startTime},
            END_TIME = #{endTime},
            USE_DEPT_SEQ = #{useDeptSeq},
            USE_DEPT_NAME = #{useDeptName},
            CAR_CLASS_SN = #{carClassSn},
            CAR_CLASS_TEXT = #{carClassText},
            CAR_TYPE_SN = #{carTypeSn},
            CAR_TYPE_TEXT = #{carTypeText},
            CAR_TITLE_NAME = #{carTitleName},
            VISIT_NAME = #{visitName},
            WAY_POINT_NAME = #{waypointName},
            EMP_SEQ = #{empSeq},
            EMP_NAME = #{empName},
            <if test='"1".equals(carType)'>
                EMERGENCY_NAME = #{emergencyName},
                EMERGENCY_TEL = #{emergencyTel},
            </if>
        WHERE
            CAR_REQ_SN = #{carReqSn}
    </update>

    <insert id="setCarCodeInsert" parameterType="map">
        /* setCarCodeInsert */
        INSERT INTO CAM_INSIDE.DJ_HR_CAR_CODE
            (
                ACTIVE,
                CAR_CLASS_SN,
                CAR_CLASS_NAME,
                CAR_NUM_NAME,
                CAR_USE_DEPT_ACTIVE,
                <if test='"Y".equals(useDeptType)'>
                    CAR_USE_DEPT_SN,
                    CAR_USE_DEPT_NAME,
                </if>
                MANAGER_SN,
                MANAGER_NAME,
                REG_DT,
                REMARK_CN,
                REG_DATE
            )
        VALUES
            (
                #{active},
                (SELECT MAX(SIHCC.CAR_CLASS_SN)+1 FROM CAM_INSIDE.DJ_HR_CAR_CODE SIHCC),
                #{carClassName},
                #{carNum},
                #{useDeptType},
                <if test='"1".equals(carType)'>
                    #{carUseDeptSn},
                    #{carUseDeptName},
                </if>
                #{empSeq},
                #{empName},
                #{regDt},
                #{remarkCn},
                now()
            )
    </insert>

    <update id="setCarCodeUpdate" parameterType="map">
        /* setCarCodeUpdate */
        UPDATE
            CAM_INSIDE.DJ_HR_CAR_CODE
        SET
            ACTIVE = #{active},
            CAR_CLASS_NAME = #{carClassName},
            CAR_NUM_NAME = #{carNum},
            CAR_USE_DEPT_ACTIVE = #{useDeptType},
            <if test='"1".equals(carType)'>
                CAR_USE_DEPT_SN = #{carUseDeptSn},
                CAR_USE_DEPT_NAME = #{carUseDeptName},
            </if>
            MANAGER_SN = #{empSeq},
            MANAGER_NAME = #{empName},
            REG_DT = #{regDt},
            REMARK_CN = #{remarkCn}
        WHERE
            CAR_CODE_SN = #{carCodeSn}
    </update>

    <update id="setCarCodeDelete" parameterType="map">
        /* setCarCodeDelete */
        UPDATE
            CAM_INSIDE.DJ_HR_CAR_CODE
        SET
            VISIBLE = 'N'
        WHERE
            CAR_CODE_SN in (${carCodeSn})
    </update>

    <insert id="setRoomCodeInsert" parameterType="map">
        /* setRoomCodeInsert */
        INSERT INTO CAM_INSIDE.DJ_ROOM_CODE
        (
            ACTIVE,
            ROOM_SN,
            ROOM_NAME,
            VISIT,
            MANY_PEOPLE,
            CORONATION_ACTIVE,
            CORONATION_NAME,
            CORONATION_MONEY_SN,
            MANAGER_SN,
            MANAGER_NAME,
            REG_DT,
            REMARK_CN,
            REG_DATE
        )
        VALUES
        (
            #{active},
            (SELECT MAX(SIRC.ROOM_SN)+1 FROM CAM_INSIDE.DJ_ROOM_CODE SIRC),
            #{roomName},
            #{visit},
            #{manyPeople},
            #{coronationActive},
            #{coronationName},
            #{coronationMoneySn},
            #{empName},
            #{empSeq},
            #{regDt},
            #{remarkCn},
            now()
        )
    </insert>

    <update id="setRoomCodeUpdate" parameterType="map">
        /* setRoomCodeUpdate */
        UPDATE
            CAM_INSIDE.DJ_ROOM_CODE
        SET
            ACTIVE = #{active},
            ROOM_NAME = #{roomName},
            VISIT = #{visit},
            MANY_PEOPLE = #{manyPeople},
            CORONATION_ACTIVE = #{coronationActive},
            CORONATION_NAME = #{coronationName},
            CORONATION_MONEY_SN = #{coronationMoneySn},
            MANAGER_SN = #{empSeq},
            MANAGER_NAME = #{empName},
            REG_DT = #{regDt},
            REMARK_CN = #{remarkCn}
        WHERE
            ROOM_CODE_SN = #{roomCodeSn}
    </update>

    <update id="setRoomCodeDelete" parameterType="map">
        /* setRoomCodeDelete */
        UPDATE
            CAM_INSIDE.DJ_ROOM_CODE
        SET
            VISIBLE = 'N'
        WHERE
            ROOM_CODE_SN in (${roomCodeSn})
    </update>
</mapper>



