<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="approvalUser">

    <select id="getDraftFormList" resultType="map">
        /* getDraftFormList */
        SELECT
            CAST(FORM_FOLDER_ID AS CHAR) AS FORM_FOLDER_ID,
            CAST(UPPER_FOLDER_ID AS CHAR) AS UPPER_FOLDER_ID,
            FORM_ID,
            FORM_NAME,
            FOLDER_SORT,
            FORM_SORT
        FROM (
            SELECT
                '999' AS FORM_FOLDER_ID,
                '0' AS UPPER_FOLDER_ID,
                '' AS FORM_ID,
                '양식' AS FORM_NAME,
                '0' AS FOLDER_SORT,
                0 AS FORM_SORT
            FROM DUAL

            UNION ALL

            SELECT
                FF.FORM_FOLDER_ID,
                '999' AS UPPER_FOLDER_ID,
                '' AS FORM_ID,
                FF.FORM_FOLDER_NAME AS FORM_NAME,
                FF.SORT AS FOLDER_SORT,
                0 AS FORM_SORT
            FROM
                DJ_CAMTIC.A_FORM_FOLDER FF
            WHERE
                VISIBLE = 'Y'

            UNION ALL

            SELECT
                '',
                FI.FORM_FOLDER_ID AS UPPER_FOLDER_ID,
                FI.FORM_ID,
                FI.FORM_NAME,
                (SELECT SORT FROM A_FORM_FOLDER WHERE FORM_FOLDER_ID = FI.FORM_FOLDER_ID) FOLDER_SORT,
                FI.SORT AS FORM_SORT
            FROM
                DJ_CAMTIC.A_FORM FI
            WHERE VISIBLE = 'Y'
        )F
        ORDER BY F.FOLDER_SORT ASC, F.FORM_SORT ASC
    </select>

    <select id="getUserFavApproveRouteList" parameterType="map" resultType="map">
        /* getUserFavApproveRouteList */
        SELECT
            *
        FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        WHERE
            FAV_EMP_SEQ = #{empSeq}
        AND
            ACTIVE = 'Y'
        ORDER BY REG_DATE DESC
    </select>

    <insert id="setUserFavApproveRoute" parameterType="map">
        /* setUserFavApproveRoute */
        INSERT INTO DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
            (
                FAV_APPROVE_ROUTE_NAME,
                FAV_EMP_SEQ,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{favApproveRouteName},
                #{empSeq},
                #{empSeq}
            )

        <selectKey keyProperty="FAV_ROUTE_ID" resultType="Integer" order="BEFORE">
            SELECT
                AUTO_INCREMENT
            FROM
                INFORMATION_SCHEMA.TABLES
            WHERE
                TABLE_SCHEMA = 'DJ_CAMTIC'
            AND
                TABLE_NAME = 'V_USER_FAV_APPROVE_ROUTE'
        </selectKey>
    </insert>

    <update id="setUserFavApproveRouteActiveN" parameterType="map">
        /* setUserFavApproveRouteActiveN */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        SET
            ACTIVE = 'N',
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID IN
            (
            <foreach collection="favArr" item="item" separator=",">
                #{item}
            </foreach>
            )
    </update>

    <insert id="setUserFavApproveRouteDetail" parameterType="map">
        /* setUserFavApproveRouteDetail */
        INSERT INTO DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
            (
                FAV_ROUTE_ID,
                APPROVE_EMP_SEQ,
                APPROVE_EMP_NAME,
                APPROVE_POSITION_NAME,
                APPROVE_DUTY_NAME,
                APPROVE_DEPT_NAME,
                APPROVE_ORDER,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{favRouteId},
                #{approveEmpSeq},
                #{approveEmpName},
                #{approvePositionName},
                #{approveDutyName},
                #{approveDeptName},
                #{approveOrder},
                #{empSeq}
            )
    </insert>

    <update id="setUserFavApproveRouteUpdate" parameterType="map">
        /* setUserFavApproveRouteUpdate */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        SET
        <if test='favApproveRouteName != null and !"".equals(favApproveRouteName)'>
            FAV_APPROVE_ROUTE_NAME = #{favApproveRouteName},
        </if>
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID = #{favRouteId}
    </update>

    <update id="setUserFavApproveRouteDetailActiveN" parameterType="map">
        /* setUserFavApproveRouteDetailActiveN */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
        SET
            ACTIVE = 'N',
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID IN
            (
            <foreach collection="favArr" item="item" separator=",">
                #{item}
            </foreach>
            )
    </update>

    <select id="getUserFavApproveRouteDetail" parameterType="map" resultType="map">
        /* getUserFavApproveRouteDetail */
        SELECT
            UFARD.*
        FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL UFARD
                JOIN
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE UFAR
            ON UFARD.FAV_ROUTE_ID = UFAR.FAV_ROUTE_ID
        WHERE
            UFAR.FAV_EMP_SEQ = #{empSeq}
          AND
            UFARD.FAV_ROUTE_ID = #{favRouteId}
          AND
            UFAR.ACTIVE = 'Y'
        ORDER BY
            APPROVE_ORDER ASC;
    </select>

    <delete id="setUserFavApproveRouteDetailDel" parameterType="map">
        /* setUserFavApproveRouteDetailDel */
        DELETE FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
        WHERE
            FAV_ROUTE_ID = #{favRouteId}
    </delete>

    <select id="getOrgPullPath" parameterType="map" resultType="String">
        /* getOrgPullPath */
        SELECT
        <if test="langCode != null and langCode != ''">
            display_path_name_${langCode}
        </if>
        <if test="langCode == null or langCode == ''">
            display_path_name_kr
        </if>
        FROM
        NEOS.T_CO_ORGCHART_NAME
        WHERE
        SEQ = #{c_oiorgcode}
        AND GBN_ORG = 'd'

    </select>

</mapper>