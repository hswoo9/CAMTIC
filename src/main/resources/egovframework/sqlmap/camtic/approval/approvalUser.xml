<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="approvalUser">

    <select id="getDraftFormList" resultType="map">
        /* getDraftFormList */
        SELECT
            CAST(FORM_FOLDER_ID AS CHAR) AS FORM_FOLDER_ID,
            CAST(UPPER_FOLDER_ID AS CHAR) AS UPPER_FOLDER_ID,
            FORM_ID,
            FORM_NAME,
            FOLDER_SORT,
            FORM_SORT
        FROM (
            SELECT
                '999' AS FORM_FOLDER_ID,
                '0' AS UPPER_FOLDER_ID,
                '' AS FORM_ID,
                '양식' AS FORM_NAME,
                '0' AS FOLDER_SORT,
                0 AS FORM_SORT
            FROM DUAL

            UNION ALL

            SELECT
                FF.FORM_FOLDER_ID,
                '999' AS UPPER_FOLDER_ID,
                '' AS FORM_ID,
                FF.FORM_FOLDER_NAME AS FORM_NAME,
                FF.SORT AS FOLDER_SORT,
                0 AS FORM_SORT
            FROM
                DJ_CAMTIC.A_FORM_FOLDER FF
            WHERE
                VISIBLE = 'Y'

            UNION ALL

            SELECT
                '',
                FI.FORM_FOLDER_ID AS UPPER_FOLDER_ID,
                FI.FORM_ID,
                FI.FORM_NAME,
                (SELECT SORT FROM A_FORM_FOLDER WHERE FORM_FOLDER_ID = FI.FORM_FOLDER_ID) FOLDER_SORT,
                FI.SORT AS FORM_SORT
            FROM
                DJ_CAMTIC.A_FORM FI
            WHERE VISIBLE = 'Y'
        )F
        ORDER BY F.FOLDER_SORT ASC, F.FORM_SORT ASC
    </select>

    <select id="getUserDocStorageBoxList" parameterType="map" resultType="map">
        /* getUserDocStorageBoxList */
        SELECT RRE.* FROM (

        SELECT RE.*,
            CASE
                <![CDATA[
                WHEN DOC_MENU_CD = 'rndDelv' THEN '수주보고_R&D'
                WHEN DOC_MENU_CD = 'unRndDelv' THEN '수주보고_비R&D'
                WHEN DOC_MENU_CD = 'rndDev' THEN '수행계획서_R&D'
                WHEN DOC_MENU_CD = 'unRndDev' THEN '수행계획서_비R&D'
                WHEN DOC_MENU_CD = 'rndRes' THEN '결과보고서_R&D'
                WHEN DOC_MENU_CD = 'unRndRes' THEN '결과보고서_비R&D'
                WHEN DOC_MENU_CD = 'delv' AND BUSN_CLASS = 'D' THEN '수주보고_엔지니어링'
                WHEN DOC_MENU_CD = 'dev' AND BUSN_CLASS = 'D' THEN '수행계획서_엔지니어링'
                WHEN DOC_MENU_CD = 'pjtRes' AND BUSN_CLASS = 'D' THEN '결과보고서_엔지니어링'
                WHEN DOC_MENU_CD = 'delv' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
                WHEN DOC_MENU_CD = 'dev' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
                WHEN DOC_MENU_CD = 'pjtRes' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
                ELSE FORM_NAME2
                ]]>
            END AS FORM_NAME
        FROM (

        SELECT
            DI.DOC_ID,
            DO.SECURITY_TYPE,
            FORM.FORM_NAME AS FORM_NAME2,
            FORM.LINKAGE_TYPE,
            FORM.LINKAGE_PROCESS_ID,
            DI.DOC_MENU_CD,
            DI.APPRO_KEY,
            DI.DRAFT_EMP_NAME,
            DI.DRAFT_DEPT_NAME,
            DI.DOC_NO,
            DI.DOC_TITLE,
            CASE WHEN DI.LAST_APPROVE_EMP_SEQ = '32' and DI.APPROVE_STAT_CODE_DESC = '전결' THEN '최종결재' ELSE DI.APPROVE_STAT_CODE_DESC END AS APPROVE_STAT_CODE_DESC,
            DI.APPROVE_STAT_CODE,
            DI.REPTIT_DRFT_YN,
            IFNULL(DI.LAST_APPROVE_EMP_SEQ, '') AS LAST_APPROVE_EMP_SEQ,
            DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
            DATE_FORMAT(DI.REPTIT_DRFT_DT,'%Y-%m-%d') AS REPTIT_DRFT_DT,
            DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS LAST_APPROVE_DT,
            DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE,
            DI.DRAFT_DT AS DRAFT_DT2,
            DI.REPTIT_DRFT_DT AS REPTIT_DRFT_DT2,
            DI.LAST_APPROVE_DT AS LAST_APPROVE_DT2,
            CASE
                WHEN DI.DOC_MENU_CD = 'dev'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = (SELECT PJT_SN FROM CAM_PJT_MNG.DJ_PJT_DEV WHERE DEV_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1)))

                WHEN DI.DOC_MENU_CD = 'delv' OR DI.DOC_MENU_CD = 'res'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1))

                ELSE NULL
            END AS BUSN_CLASS
        FROM
            DJ_CAMTIC.A_DOC_INFO DI
        JOIN
            DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
            DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                AND
                    DI.DRAFT_EMP_SEQ = #{empSeq}
                AND
                    DI.APPROVE_STAT_CODE = 111
            </when>
            <when test='approveStat != null and "draft".equals(approveStat)'>
                AND
                    DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                    DI.APPROVE_STAT_CODE = 10 OR
                    DI.APPROVE_STAT_CODE = 20 OR
                    DI.APPROVE_STAT_CODE = 50
                )
            </when>
            <when test='approveStat != null and "returnRetrieve".equals(approveStat)'>
                AND
                    DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                    DI.APPROVE_STAT_CODE = 30 OR
                    DI.APPROVE_STAT_CODE = 40
                )
            </when>
            <when test='approveStat != null and "result".equals(approveStat)'>
                AND
                    DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                    DI.APPROVE_STAT_CODE = 100 OR
                    DI.APPROVE_STAT_CODE = 101
                )
            </when>
        </choose>
        <if test='docStatus != null and !"".equals(docStatus) and !"100".equals(docStatus)'>
            AND
                DI.APPROVE_STAT_CODE = #{docStatus}
        </if>
        <if test='"100".equals(docStatus)'>
            AND (
                (DI.APPROVE_STAT_CODE = '100' OR DI.APPROVE_STAT_CODE = '101') -- AND DI.LAST_APPROVE_EMP_SEQ = '32'
            )
        </if>
        AND
            DI.ACTIVE = 'Y'
        AND
            DI.DEL_FLAG = 'N'
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
        AND
            DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        AND
            DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        ]]>
        </if>

        ) RE

        ) RRE

        WHERE
            1=1
        <choose>
            <when test='"A".equals(searchKeyword)'>
                AND
                    RRE.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
            </when>
            <when test='"B".equals(searchKeyword)'>
                AND
                    RRE.DOC_NO LIKE CONCAT('%', #{docTitle},'%')
            </when>
            <when test='"C".equals(searchKeyword)'>
                AND
                    RRE.FORM_NAME LIKE CONCAT('%', #{docTitle},'%')
            </when>
            <otherwise>
                AND
                (
                RRE.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
                OR RRE.DOC_NO LIKE CONCAT('%', #{docTitle},'%')
                OR RRE.FORM_NAME LIKE CONCAT('%', #{docTitle},'%')
                )
            </otherwise>
        </choose>


        <choose>
            <when test='approveStat != null and "result".equals(approveStat)'>
                ORDER BY IFNULL(RRE.LAST_APPROVE_DT2, RRE.DRAFT_DT2) DESC
            </when>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                ORDER BY RRE.DOC_ID DESC
            </when>
            <otherwise>
                ORDER BY IFNULL(RRE.REPTIT_DRFT_DT2, RRE.DRAFT_DT2) DESC
            </otherwise>
        </choose>
    </select>

    <select id="getUserDocStorageBoxListMobile" parameterType="map" resultType="map">
        /* getUserDocStorageBoxListMobile */

        SELECT
        DI.DOC_ID,
        DO.SECURITY_TYPE,
        FORM.FORM_NAME,
        FORM.LINKAGE_TYPE,
        FORM.LINKAGE_PROCESS_ID,
        DI.DOC_MENU_CD,
        DI.APPRO_KEY,
        DI.DOC_NO,
        DI.DOC_TITLE,
        CASE WHEN DI.LAST_APPROVE_EMP_SEQ = '32' and DI.APPROVE_STAT_CODE_DESC = '전결' THEN '최종결재' ELSE DI.APPROVE_STAT_CODE_DESC END AS APPROVE_STAT_CODE_DESC,
        DI.APPROVE_STAT_CODE,
        DI.REPTIT_DRFT_YN,
        IFNULL(DI.LAST_APPROVE_EMP_SEQ, '') AS LAST_APPROVE_EMP_SEQ,
        DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
        DATE_FORMAT(DI.REPTIT_DRFT_DT,'%Y-%m-%d') AS REPTIT_DRFT_DT,
        DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS LAST_APPROVE_DT,
        DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE
        FROM
        DJ_CAMTIC.A_DOC_INFO DI
        JOIN
        DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
        DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND
                DI.APPROVE_STAT_CODE = 111
            </when>
            <when test='approveStat != null and "draft".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 10 OR
                DI.APPROVE_STAT_CODE = 20 OR
                DI.APPROVE_STAT_CODE = 50
                )
            </when>
            <when test='approveStat != null and "returnRetrieve".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 30 OR
                DI.APPROVE_STAT_CODE = 40
                )
            </when>
            <when test='approveStat != null and "result".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 100 OR
                DI.APPROVE_STAT_CODE = 101
                )
            </when>
        </choose>
        <if test='docStatus != null and !"".equals(docStatus) and !"100".equals(docStatus)'>
            AND
            DI.APPROVE_STAT_CODE = #{docStatus}
        </if>
        <if test='"100".equals(docStatus)'>
            AND (
            (DI.APPROVE_STAT_CODE = '100' OR DI.APPROVE_STAT_CODE = '101') AND DI.LAST_APPROVE_EMP_SEQ = '32'
            )
        </if>
        AND
        DI.ACTIVE = 'Y'
        AND
        DI.DEL_FLAG = 'N'
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
        AND
            DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        AND
            DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        ]]>
        </if>

        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                ORDER BY DI.REG_DATE DESC
            </when>
            <otherwise>
                ORDER BY IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT) DESC
            </otherwise>
        </choose>
    </select>

    <select id="getUserReadDocStorageBoxList" parameterType="map" resultType="map">
        /* getUserReadDocStorageBoxList */
        SELECT
            DI.DOC_ID,
            DO.SECURITY_TYPE,
            FORM.FORM_NAME,
            DI.DOC_MENU_CD,
            DI.APPRO_KEY,
            DI.DOC_NO,
            DI.DOC_TITLE,
            DI.APPROVE_STAT_CODE_DESC,
            DI.APPROVE_STAT_CODE,
            DI.REPTIT_DRFT_YN,
            DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
            DATE_FORMAT(DI.REPTIT_DRFT_DT,'%Y-%m-%d') AS REPTIT_DRFT_DT,
            DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS LAST_APPROVE_DT,
            DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE,
            CASE WHEN (SELECT READER_USER_ID FROM DJ_CAMTIC.A_DOC_READER_USER A WHERE A.DOC_ID = DRD.DOC_ID AND READER_EMP_SEQ = #{empSeq}) IS NULL
            THEN 'N' ELSE 'Y'
            END READER_YN,
            CASE
                WHEN DI.DOC_MENU_CD = 'dev'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = (SELECT PJT_SN FROM CAM_PJT_MNG.DJ_PJT_DEV WHERE DEV_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1)))

                WHEN DI.DOC_MENU_CD = 'delv' OR DI.DOC_MENU_CD = 'res'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1))

                ELSE NULL
            END AS BUSN_CLASS
        FROM
            DJ_CAMTIC.A_DOC_INFO DI
        JOIN
            DJ_CAMTIC.A_DOC_OPT DO ON DI.DOC_ID = DO.DOC_ID
        JOIN (
            SELECT
                DOC_ID,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d')) AS READER_DAY,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%H%i%s')) AS READER_TIME,
                ACTIVE AS ACTIVE,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d') = DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'), DATE_FORMAT(DRD.REG_DATE, '%Y%m%d'), DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'))) as RDDAY ,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%H%i%s') = DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'), DATE_FORMAT(DRD.REG_DATE, '%H%i%s'), DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'))) as RDTIME
            FROM
                DJ_CAMTIC.A_DOC_READER DRD
        INNER JOIN (
            ${deptPathQuery}
        )OC ON OC.GBN_ORG = DRD.SEQ_TYPE AND OC.GROUP_SEQ = 'camtic_new' AND OC.COMP_SEQ = '1212' AND OC.DEPT_SEQ = DRD.READER_DEPT_SEQ AND OC.EMP_SEQ = DRD.READER_EMP_SEQ OR (DRD.READER_EMP_SEQ = 0 AND OC.DEPT_SEQ = DRD.READER_DEPT_SEQ)
        WHERE 1=1
--         <![CDATA[
--             AND
--                 DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(DRD.READING_START_DT, '%Y%m%d')
--             AND
--                 DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(DRD.READING_END_DT, '%Y%m%d')
--             ]]>
        GROUP BY DOC_ID
        )DRD
        ON DI.DOC_ID = DRD.DOC_ID
        JOIN
        DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE
        1=1
        AND (
        DI.APPROVE_STAT_CODE = 100 OR
        DI.APPROVE_STAT_CODE = 101
        )
        AND
        DI.ACTIVE = 'Y'
        AND
        DI.DEL_FLAG = 'N'
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
        AND
            DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        AND
            DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        ]]>
        </if>

        <if test='docTitle != null and !"".equals(docTitle)'>
            AND
            DI.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
        </if>

        <if test='readStatus != null and !"".equals(readStatus)'>
            <if test='"N".equals(readStatus)'>
                AND (SELECT READER_USER_ID FROM DJ_CAMTIC.A_DOC_READER_USER A WHERE A.DOC_ID = DRD.DOC_ID AND READER_EMP_SEQ = #{empSeq}) IS NULL
            </if>
            <if test='"Y".equals(readStatus)'>
                AND (SELECT READER_USER_ID FROM DJ_CAMTIC.A_DOC_READER_USER A WHERE A.DOC_ID = DRD.DOC_ID AND READER_EMP_SEQ = #{empSeq}) IS NOT NULL
            </if>
        </if>

        GROUP BY DI.DOC_ID
        ORDER BY IFNULL(DI.LAST_APPROVE_DT, DI.DRAFT_DT) DESC
    </select>

    <update id="setCheckedDocDel" parameterType="list">
        /* setCheckedDocDel */
        <foreach collection="list" item="item" index="index" separator=";">
            UPDATE
                DJ_CAMTIC.A_DOC_INFO
            SET
                DEL_FLAG = 'Y',
                DEL_EMP_SEQ = #{item.empSeq},
                MOD_EMP_SEQ = #{item.empSeq},
                MOD_DATE = now()
            WHERE
                DOC_ID = #{item.docId}
        </foreach>
    </update>

    <update id="setDocIdNull" parameterType="map">
        /* setDocIdNull */
        UPDATE ${dbSchema}.${dbTable}
        SET
            DOC_ID = NULL,
            <if test='docMenuCd != null and !"".equals(docMenuCd)'>
                <choose>
                    <when test='"payApp".equals(docMenuCd) or "exnp".equals(docMenuCd) or "payIncp".equals(docMenuCd)'>
                        DOC_STATUS = 0
                    </when>
                    <otherwise>
                        STATUS = 0
                    </otherwise>
                </choose>
            </if>
        WHERE
            DOC_ID = #{docId}
    </update>

    <update id="setDocDel" parameterType="map">
        /* setDocDel */
        UPDATE
            DJ_CAMTIC.A_DOC_INFO
        SET
            DEL_FLAG = 'Y',
            DEL_EMP_SEQ = #{empSeq},
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = now()
        WHERE
            DOC_ID = #{docId}
    </update>

    <select id="getUserFavApproveRouteList" parameterType="map" resultType="map">
        /* getUserFavApproveRouteList */
        SELECT
            *
        FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        WHERE
            FAV_EMP_SEQ = #{empSeq}
        AND
            ACTIVE = 'Y'
        ORDER BY REG_DATE DESC
    </select>

    <select id="getAbsentUserList" parameterType="map" resultType="map">
        /* getAbsentUserList - mariaDB */
        SELECT
            AVF.C_UIUSERKEY AS C_UIUSERKEY,
            AVF.C_OIORGCODE AS C_OIORGCODE
        FROM
            DJ_CAMTIC.A_ABSENTINFO AF
        JOIN
            DJ_CAMTIC.A_VICARIOUSINFO AVF
        ON  AF.C_UIUSERKEY =  AVF.C_UIUSERKEY AND AF.C_OIORGCODE = AVF.C_OIORGCODE AND AF.C_AISEQNUM = AVF.C_AISEQNUM AND AVF.C_VIUSERKEY = #{empSeq}
        <if test="np307 == 2">
            JOIN
                CAM_HR.DJ_DEPT_INFO D ON AVF.C_VIORGCODE = D.DEPT_SEQ
        </if>
        <if test="np307 != 2">
            AND AVF.C_VIORGCODE = #{deptSeq}
        </if>
        WHERE
            DATE_FORMAT(NOW(),'%Y%m%d%H%i') BETWEEN CONCAT(DATE_FORMAT(AF.C_AISDAY, '%Y%m%d'), REPLACE(AF.C_AISTIME , ':', '')) AND
            CONCAT( DATE_FORMAT(AF.C_AIEDAY ,'%Y%m%d'), REPLACE(AF.C_AIETIME  , ':', '') )
        AND AF.C_AISTATUS = '1'
        AND AVF.C_VIAUTHORITY  = 'apprv'
    </select>

    <select id="getDeptPathList" parameterType="map" resultType="map">
        /* getDeptPathList */
--         SELECT
--             'd' AS GBN_ORG,
--             GROUP_SEQ AS GROUP_SEQ,
--             COMP_SEQ AS COMP_SEQ,
--             DEPT_SEQ AS DEPT_SEQ,
--             '0' AS EMP_SEQ
--         FROM
--             CAM_HR.DJ_DEPT_INFO
--         ORDER BY DEPT_LEVEL, ORDER_SN

        SELECT
            LOWER(B.ORG_TYPE) AS GBN_ORG,
            b.GROUP_SEQ AS GROUP_SEQ,
            B.COMP_SEQ AS COMP_SEQ,
            (CASE WHEN B.ORG_TYPE = 'c' THEN '0' ELSE IFNULL(B.DEPT_SEQ, '0') END) AS DEPT_SEQ,
            '0' AS EMP_SEQ
        FROM
            CAM_HR.DJ_DEPT_INFO B
        INNER JOIN
            CAM_HR.DJ_DEPT_INFO A ON CONCAT(A.PATH, '|')  LIKE CONCAT(B.PATH, '|%') AND A.ORG_TYPE = 'D' AND A.DEPT_SEQ = '1205'
    </select>

    <select id="getApproveDocBoxList" parameterType="map" resultType="map">
        /* getApproveDocBoxList */
        SELECT RRE.* FROM (
        SELECT
            RE.*,
        <![CDATA[
            CASE
            WHEN DOC_MENU_CD = 'rndDelv' THEN '수주보고_R&D'
            WHEN DOC_MENU_CD = 'unRndDelv' THEN '수주보고_비R&D'
            WHEN DOC_MENU_CD = 'rndDev' THEN '수행계획서_R&D'
            WHEN DOC_MENU_CD = 'unRndDev' THEN '수행계획서_비R&D'
            WHEN DOC_MENU_CD = 'rndRes' THEN '결과보고서_R&D'
            WHEN DOC_MENU_CD = 'unRndRes' THEN '결과보고서_비R&D'
            WHEN DOC_MENU_CD = 'delv' AND BUSN_CLASS = 'D' THEN '수주보고_엔지니어링'
            WHEN DOC_MENU_CD = 'dev' AND BUSN_CLASS = 'D' THEN '수행계획서_엔지니어링'
            WHEN DOC_MENU_CD = 'pjtRes' AND BUSN_CLASS = 'D' THEN '결과보고서_엔지니어링'
            WHEN DOC_MENU_CD = 'delv' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
            WHEN DOC_MENU_CD = 'dev' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
            WHEN DOC_MENU_CD = 'pjtRes' AND BUSN_CLASS = 'V' THEN '수주보고_용역/기타'
            ELSE FORM_NAME2
            END AS FORM_NAME
        ]]>
        FROM (
        SELECT
            DAR.APPROVE_EMP_SEQ,
            DI.DOC_ID,
            DI.DOC_MENU_CD,
            DI.APPRO_KEY,
            DO.SECURITY_TYPE,
            FORM.FORM_NAME AS FORM_NAME2,
            DI.DOC_NO,
            DI.DOC_TITLE,
            DI.REPTIT_DRFT_YN,
            DATE_FORMAT(DI.DRAFT_DT, '%Y-%m-%d') AS DRAFT_DT,
            DATE_FORMAT(DI.REPTIT_DRFT_DT, '%Y-%m-%d') AS REPTIT_DRFT_DT,
            DATE_FORMAT(DI.LAST_APPROVE_DT, '%Y-%m-%d') AS LAST_APPROVE_DT,
            DI.DRAFT_DT AS DRAFT_DT2,
            DI.APPROVE_DT AS APPROVE_DT2,
            DI.LAST_APPROVE_DT AS LAST_APPROVE_DT2,
            DI.DRAFT_DEPT_NAME,
            DI.DRAFT_EMP_NAME,
            CASE WHEN DI.LAST_APPROVE_EMP_SEQ = '32' and DI.APPROVE_STAT_CODE_DESC = '전결' THEN '최종결재' ELSE DI.APPROVE_STAT_CODE_DESC END AS APPROVE_STAT_CODE_DESC,
            CASE
                WHEN DI.DOC_MENU_CD = 'dev'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = (SELECT PJT_SN FROM CAM_PJT_MNG.DJ_PJT_DEV WHERE DEV_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1)))

                WHEN DI.DOC_MENU_CD = 'delv' OR DI.DOC_MENU_CD = 'res'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1))

                ELSE NULL
            END AS BUSN_CLASS
        <choose>
            <when test='approveType != null and ("wait".equals(approveType) or "tobe".equals(approveType))'>
                , CASE WHEN AF.C_UIUSERKEY = #{empSeq} THEN 'N' ELSE 'Y' END AS SUB_APPROVAL
            </when>
            <when test='approveType != null and ("completion".equals(approveType) or "return".equals(approveType))'>
                , CASE WHEN DAR.PROXY_APPROVE_DEPT_SEQ IS NOT NULL THEN 'Y' ELSE 'N' END AS SUB_APPROVAL
            </when>
        </choose>
        FROM
            DJ_CAMTIC.A_DOC_APPROVE_ROUTE DAR
        JOIN
            DJ_CAMTIC.A_DOC_INFO DI
        ON DAR.DOC_ID = DI.DOC_ID
        JOIN
            DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        <choose>
            <when test='approveType != null and "wait".equals(approveType)'>
                AND DI.APPROVE_ORDER = DAR.APPROVE_ORDER AND (DI.APPROVE_STAT_CODE = 10 OR DI.APPROVE_STAT_CODE = 20 OR DI.APPROVE_STAT_CODE = 50)

                STRAIGHT_JOIN
                (${absentUserQuery})AF
                ON DAR.APPROVE_DEPT_SEQ = AF.C_OIORGCODE AND DAR.APPROVE_EMP_SEQ = AF.C_UIUSERKEY
            </when>
            <when test='approveType != null and "tobe".equals(approveType)'>
                AND DI.APPROVE_ORDER != DAR.APPROVE_ORDER AND (DI.APPROVE_STAT_CODE = 10 OR DI.APPROVE_STAT_CODE = 20 OR DI.APPROVE_STAT_CODE = 50)

                STRAIGHT_JOIN
                (${absentUserQuery})AF
                ON DAR.APPROVE_DEPT_SEQ = AF.C_OIORGCODE AND DAR.APPROVE_EMP_SEQ = AF.C_UIUSERKEY
            </when>
        </choose>
        JOIN
            DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        <if test='empName != null and !"".equals(empName)'>
            AND
                DI.DRAFT_EMP_NAME LIKE CONCAT('%', #{empName}, '%')
        </if>

        AND
            DI.ACTIVE = 'Y'
        AND
            DI.DEL_FLAG = 'N'

        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
             AND
                 DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT), '%Y%m%d')
             AND
                 DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT), '%Y%m%d')
             ]]>
        </if>

        <choose>
            <when test='approveType != null and "completion".equals(approveType)'>
                AND (
                DAR.APPROVE_STAT_CODE = 20 OR
                DAR.APPROVE_STAT_CODE = 30 OR
                DAR.APPROVE_STAT_CODE = 100 OR
                DAR.APPROVE_STAT_CODE = 101 OR
                DAR.APPROVE_STAT_CODE = 102
                )
                AND (
                DI.APPROVE_STAT_CODE = 20 OR
                DI.APPROVE_STAT_CODE = 30 OR
                DI.APPROVE_STAT_CODE = 100 OR
                DI.APPROVE_STAT_CODE = 101 OR
                DI.APPROVE_STAT_CODE = 102
                )
                AND (
                (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                )
            </when>
            <when test='approveType != null and "return".equals(approveType)'>
                AND
                DAR.APPROVE_STAT_CODE = 30
                AND
                DI.APPROVE_STAT_CODE = 30
                AND (
                (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                )
            </when>
            <when test='approveType != null and "reference".equals(approveType)'>
                AND DI.APPROVE_STAT_CODE IN (100, 101)
                <if test='pageType != null and !"".equals(pageType)'>
                    AND (
                        (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                        (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                    )
                </if>
            </when>
            <otherwise>
                AND DAR.APPROVE_STAT_CODE IS NULL
            </otherwise>
        </choose>

        GROUP BY DI.DOC_ID
        ) RE
        WHERE 1=1
        <if test='approveStatCodeDesc != null and !"".equals(approveStatCodeDesc)'>
            AND RE.APPROVE_STAT_CODE_DESC = #{approveStatCodeDesc}
        </if>
        ) RRE
        WHERE 1=1
        <if test='searchKeyword != null and !"".equals(searchKeyword)'>
            <choose>
                <when test='"A".equals(searchKeyword)'>
                    AND
                        RRE.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
                </when>
                <when test='"B".equals(searchKeyword)'>
                    AND
                        RRE.DOC_NO LIKE CONCAT('%', #{docTitle},'%')
                </when>
                <when test='"C".equals(searchKeyword)'>
                    AND
                        RRE.FORM_NAME LIKE CONCAT('%', #{docTitle},'%')
                </when>
                <when test='"D".equals(searchKeyword)'>
                    AND
                        RRE.DRAFT_EMP_NAME LIKE CONCAT('%', #{docTitle},'%')
                </when>
                <otherwise>
                    AND
                    (
                        RRE.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
                        OR RRE.DOC_NO LIKE CONCAT('%', #{docTitle},'%')
                        OR RRE.FORM_NAME LIKE CONCAT('%', #{docTitle},'%')
                        OR RRE.DRAFT_EMP_NAME LIKE CONCAT('%', #{docTitle},'%')
                    )
                </otherwise>
            </choose>
        </if>
        <choose>
            <when test='approveType != null and "completion".equals(approveType)'>
                <if test='docTitle != null and !"".equals(docTitle)'>
                    AND
                        RRE.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
                </if>
                <if test='empName != null and !"".equals(empName)'>
                    AND
                        RRE.DRAFT_EMP_NAME LIKE CONCAT('%', #{empName},'%')
                </if>
                ORDER BY (
                CASE WHEN RRE.APPROVE_STAT_CODE_DESC in ('결재') THEN 1 WHEN RRE.APPROVE_STAT_CODE_DESC in ('반려') THEN 3 ELSE 2 END
                ),  IFNULL(RRE.LAST_APPROVE_DT2, RRE.DRAFT_DT) DESC
            </when>
            <when test='approveType != null and "wait".equals(approveType)'>
                ORDER BY IFNULL(RRE.APPROVE_DT2, RRE.DRAFT_DT2) DESC
            </when>
            <otherwise>
                ORDER BY IFNULL(RRE.LAST_APPROVE_DT2, RRE.DRAFT_DT) DESC
            </otherwise>
        </choose>
        /*ORDER BY IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT) DESC*/
    </select>

    <select id="getApproveDocBoxListMobile" parameterType="map" resultType="map">
        /* getApproveDocBoxListMobile */
        SELECT
        DAR.APPROVE_EMP_SEQ,
        DI.DOC_ID,
        DI.DOC_MENU_CD,
        DI.APPRO_KEY,
        DO.SECURITY_TYPE,
        FORM.FORM_NAME,
        DI.DOC_NO,
        DI.DOC_TITLE,
        DI.REPTIT_DRFT_YN,
        DATE_FORMAT(DI.DRAFT_DT, '%Y-%m-%d') AS DRAFT_DT,
        DATE_FORMAT(DI.REPTIT_DRFT_DT, '%Y-%m-%d') AS REPTIT_DRFT_DT,
        DATE_FORMAT(DI.LAST_APPROVE_DT, '%Y-%m-%d') AS LAST_APPROVE_DT,
        DI.DRAFT_DEPT_NAME,
        DI.DRAFT_EMP_NAME,
        CASE WHEN DI.LAST_APPROVE_EMP_SEQ = '32' and DI.APPROVE_STAT_CODE_DESC = '전결' THEN '최종결재' ELSE DI.APPROVE_STAT_CODE_DESC END AS APPROVE_STAT_CODE_DESC
        <choose>
            <when test='approveType != null and ("wait".equals(approveType) or "tobe".equals(approveType))'>
                , CASE WHEN AF.C_UIUSERKEY = #{empSeq} THEN 'N' ELSE 'Y' END AS SUB_APPROVAL
            </when>
            <when test='approveType != null and ("completion".equals(approveType) or "return".equals(approveType))'>
                , CASE WHEN DAR.PROXY_APPROVE_DEPT_SEQ IS NOT NULL THEN 'Y' ELSE 'N' END AS SUB_APPROVAL
            </when>
        </choose>
        FROM
        DJ_CAMTIC.A_DOC_APPROVE_ROUTE DAR
        JOIN
        DJ_CAMTIC.A_DOC_INFO DI
        ON DAR.DOC_ID = DI.DOC_ID
        JOIN
        DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        <choose>
            <when test='approveType != null and "wait".equals(approveType)'>
                AND DI.APPROVE_ORDER = DAR.APPROVE_ORDER AND (DI.APPROVE_STAT_CODE = 10 OR DI.APPROVE_STAT_CODE = 20 OR DI.APPROVE_STAT_CODE = 50)

                STRAIGHT_JOIN
                (${absentUserQuery})AF
                ON DAR.APPROVE_DEPT_SEQ = AF.C_OIORGCODE AND DAR.APPROVE_EMP_SEQ = AF.C_UIUSERKEY
            </when>
            <when test='approveType != null and "tobe".equals(approveType)'>
                AND DI.APPROVE_ORDER != DAR.APPROVE_ORDER AND (DI.APPROVE_STAT_CODE = 10 OR DI.APPROVE_STAT_CODE = 20 OR DI.APPROVE_STAT_CODE = 50)

                STRAIGHT_JOIN
                (${absentUserQuery})AF
                ON DAR.APPROVE_DEPT_SEQ = AF.C_OIORGCODE AND DAR.APPROVE_EMP_SEQ = AF.C_UIUSERKEY
            </when>
        </choose>
        JOIN
        DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        AND
        DI.ACTIVE = 'Y'
        AND
        DI.DEL_FLAG = 'N'

        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
             AND
                 DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
             AND
                 DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
             ]]>
        </if>

        <if test='docTitle != null and !"".equals(docTitle)'>
            AND
            DI.DOC_TITLE LIKE CONCAT('%', #{docTitle}, '%')
        </if>
        <if test='mTitle != null and !"".equals(mTitle)'>
            AND
            DI.DOC_TITLE LIKE CONCAT('%', #{mTitle}, '%')
        </if>

        <choose>
            <when test='approveType != null and "completion".equals(approveType)'>
                AND (
                DAR.APPROVE_STAT_CODE = 20 OR
                DAR.APPROVE_STAT_CODE = 30 OR
                DAR.APPROVE_STAT_CODE = 100 OR
                DAR.APPROVE_STAT_CODE = 101 OR
                DAR.APPROVE_STAT_CODE = 102
                )
                AND (
                DI.APPROVE_STAT_CODE = 20 OR
                DI.APPROVE_STAT_CODE = 30 OR
                DI.APPROVE_STAT_CODE = 100 OR
                DI.APPROVE_STAT_CODE = 101 OR
                DI.APPROVE_STAT_CODE = 102
                )
                AND (
                (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                )
            </when>
            <when test='approveType != null and "return".equals(approveType)'>
                AND
                DAR.APPROVE_STAT_CODE = 30
                AND
                DI.APPROVE_STAT_CODE = 30
                AND (
                (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                )
            </when>
            <when test='approveType != null and "reference".equals(approveType)'>
                AND DI.APPROVE_STAT_CODE IN (100, 101)
                <if test='pageType != null and !"".equals(pageType)'>
                    AND (
                    (DAR.APPROVE_EMP_SEQ = #{empSeq} AND DAR.APPROVE_DEPT_SEQ = #{deptSeq}) OR
                    (DAR.PROXY_APPROVE_EMP_SEQ = #{empSeq} AND DAR.PROXY_APPROVE_DEPT_SEQ = #{deptSeq})
                    )
                </if>
            </when>
            <otherwise>
                AND DAR.APPROVE_STAT_CODE IS NULL
            </otherwise>
        </choose>
        GROUP BY DI.DOC_ID
        ORDER BY IFNULL(LAST_APPROVE_DT, DRAFT_DT) DESC
        <if test='startPage != null and !"".equals(startPage)'>
            LIMIT #{startPage}, 5
        </if>
    </select>

    <!-- 결재함 -->
    <select id="getEmpDeptList" parameterType="map" resultType="map">
        /* getEmpDeptList */
        SELECT
            'camtic_new' AS GROUP_SEQ,
            DI.COMP_SEQ AS COMP_SEQ,
            DI.DEPT_SEQ AS DEPT_SEQ,
            EI.EMP_SEQ AS EMP_SEQ
        FROM
            CAM_HR.DJ_EMP_INFO EI
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO DI ON EI.DEPT_SEQ = DI.DEPT_SEQ
        WHERE
            DI.DEPT_SEQ NOT IN (#{deptSeq})
        ORDER BY DI.DEPT_LEVEL, DI.ORDER_SN
    </select>

    <insert id="setUserFavApproveRoute" parameterType="map">
        /* setUserFavApproveRoute */
        INSERT INTO DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
            (
                FAV_APPROVE_ROUTE_NAME,
                FAV_EMP_SEQ,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{favApproveRouteName},
                #{empSeq},
                #{empSeq}
            )

        <selectKey keyProperty="FAV_ROUTE_ID" resultType="Integer" order="BEFORE">
            SELECT
                AUTO_INCREMENT
            FROM
                INFORMATION_SCHEMA.TABLES
            WHERE
                TABLE_SCHEMA = 'DJ_CAMTIC'
            AND
                TABLE_NAME = 'V_USER_FAV_APPROVE_ROUTE'
        </selectKey>
    </insert>

    <update id="setUserFavApproveRouteActiveN" parameterType="map">
        /* setUserFavApproveRouteActiveN */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        SET
            ACTIVE = 'N',
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID IN
            (
            <foreach collection="favArr" item="item" separator=",">
                #{item}
            </foreach>
            )
    </update>

    <insert id="setUserFavApproveRouteDetail" parameterType="map">
        /* setUserFavApproveRouteDetail */
        INSERT INTO DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
            (
                FAV_ROUTE_ID,
                APPROVE_EMP_SEQ,
                APPROVE_EMP_NAME,
                APPROVE_POSITION_NAME,
                APPROVE_DUTY_NAME,
                APPROVE_DEPT_NAME,
                APPROVE_DEPT_SEQ,
                APPROVE_ORDER,
                APPROVE_TYPE,
                REG_EMP_SEQ
            )
        VALUES
            (
                #{favRouteId},
                #{approveEmpSeq},
                #{approveEmpName},
                #{approvePositionName},
                #{approveDutyName},
                #{approveDeptName},
                #{approveDeptSeq},
                #{approveOrder},
                #{approveType},
                #{empSeq}
            )
    </insert>

    <update id="setUserFavApproveRouteUpdate" parameterType="map">
        /* setUserFavApproveRouteUpdate */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE
        SET
        <if test='favApproveRouteName != null and !"".equals(favApproveRouteName)'>
            FAV_APPROVE_ROUTE_NAME = #{favApproveRouteName},
        </if>
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID = #{favRouteId}
    </update>

    <update id="setUserFavApproveRouteDetailActiveN" parameterType="map">
        /* setUserFavApproveRouteDetailActiveN */
        UPDATE
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
        SET
            ACTIVE = 'N',
            MOD_EMP_SEQ = #{empSeq},
            MOD_DATE = NOW()
        WHERE
            FAV_ROUTE_ID IN
            (
            <foreach collection="favArr" item="item" separator=",">
                #{item}
            </foreach>
            )
    </update>

    <select id="getUserFavApproveRouteDetail" parameterType="map" resultType="map">
        /* getUserFavApproveRouteDetail */
        SELECT
            UFARD.*
        FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL UFARD
                JOIN
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE UFAR
            ON UFARD.FAV_ROUTE_ID = UFAR.FAV_ROUTE_ID
        WHERE
            UFAR.FAV_EMP_SEQ = #{empSeq}
          AND
            UFARD.FAV_ROUTE_ID = #{favRouteId}
          AND
            UFAR.ACTIVE = 'Y'
        ORDER BY
            APPROVE_ORDER ASC;
    </select>

    <delete id="setUserFavApproveRouteDetailDel" parameterType="map">
        /* setUserFavApproveRouteDetailDel */
        DELETE FROM
            DJ_CAMTIC.V_USER_FAV_APPROVE_ROUTE_DETAIL
        WHERE
            FAV_ROUTE_ID = #{favRouteId}
    </delete>

    <select id="getApprovalDocSearchList" resultType="map" parameterType="map">
        /* getApprovalDocSearchList */
        SELECT
            DI.DOC_ID,
            DO.DOC_OPT_ID,
            DI.DOC_GBN_SN,
            IF(DI.DOC_GBN_SN = '000', '생산문서', '접수문서') AS DOC_GBN_KR,
            DO.SECURITY_TYPE,
            DI.DOC_MENU_CD,
            DI.APPRO_KEY,
            FORM.FORM_NAME,
            FORM.LINKAGE_TYPE,
            DI.DOC_NO,
            DI.DOC_TITLE,
            DI.APPROVE_STAT_CODE,
            DI.DRAFT_EMP_NAME,
            DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
            DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE,
            DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS APPROVE_DT,
            (SELECT CM_CODE_NM FROM DJ_CAMTIC.V_COM_CODE CC WHERE CC.CM_GROUP_CODE_ID = 30 AND CC.CM_CODE = DO.DOC_GBN) AS DOC_GBN,
            DI.DOC_FLAG,
            DI.DEL_FLAG,
            CASE
                WHEN DI.DOC_MENU_CD = 'dev'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = (SELECT PJT_SN FROM CAM_PJT_MNG.DJ_PJT_DEV WHERE DEV_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1)))

                WHEN DI.DOC_MENU_CD = 'delv' OR DI.DOC_MENU_CD = 'res'
                THEN (SELECT BUSN_CLASS FROM CAM_PJT_MNG.DJ_PROJECT WHERE PJT_SN = SUBSTRING_INDEX(DI.APPRO_KEY, '_', -1))

                ELSE NULL
            END AS BUSN_CLASS
        FROM
            DJ_CAMTIC.A_DOC_INFO DI
        JOIN
            DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
            DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        LEFT JOIN (
            SELECT
                DOC_ID,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d')) AS READER_DAY,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%H%i%s')) AS READER_TIME,
                ACTIVE AS ACTIVE,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d') = DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'), DATE_FORMAT(DRD.REG_DATE, '%Y%m%d'), DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'))) as RDDAY ,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%H%i%s') = DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'), DATE_FORMAT(DRD.REG_DATE, '%H%i%s'), DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'))) as RDTIME
            FROM
                DJ_CAMTIC.A_DOC_READER DRD
            INNER JOIN (
                ${deptPathQuery}
            )OC
            ON OC.GBN_ORG = DRD.SEQ_TYPE AND OC.GROUP_SEQ = 'camtic_new' AND OC.COMP_SEQ = '1000' AND OC.DEPT_SEQ = DRD.READER_DEPT_SEQ AND OC.EMP_SEQ = DRD.READER_EMP_SEQ
            WHERE 1=1
            <![CDATA[
                AND
                    DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(DRD.READING_START_DT, '%Y%m%d')
                AND
                    DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(DRD.READING_END_DT, '%Y%m%d')
            ]]>
            GROUP BY DOC_ID
        ) DRD
        ON DI.DOC_ID = DRD.DOC_ID
        WHERE
            DI.ACTIVE = 'Y'
        <if test='deptSeq != null and !"".equals(deptSeq)'>
        AND
            DI.DRAFT_DEPT_SEQ IN (
                SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO
                    WHERE
                        CASE
                            WHEN (SELECT DEPT_LEVEL FROM CAM_HR.DJ_DEPT_INFO WHERE DEPT_SEQ = #{deptSeq}) = 1
                            THEN (
                                DEPT_SEQ = #{deptSeq}
                                OR DEPT_SEQ IN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO WHERE PARENT_DEPT_SEQ = (#{deptSeq}))
                            )
                            WHEN (SELECT DEPT_LEVEL FROM CAM_HR.DJ_DEPT_INFO WHERE DEPT_SEQ = #{deptSeq}) = 2
                            THEN (
                                DEPT_SEQ = (SELECT PARENT_DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO WHERE DEPT_SEQ = #{deptSeq})
                                OR DEPT_SEQ IN (SELECT DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO WHERE PARENT_DEPT_SEQ = (SELECT PARENT_DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO WHERE DEPT_SEQ = #{deptSeq}))
                            )
                            ELSE PATH LIKE CONCAT('%', #{deptSeq} ,'%')
                        END
            )
        </if>
        AND (
                DI.APPROVE_STAT_CODE = 100 OR
                DI.APPROVE_STAT_CODE = 101
            )
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
                AND
                    DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
                AND
                    DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
            ]]>
        </if>
        <if test='searchCategory != null and !"".equals(searchCategory)'>
            AND DOC_GBN_SN = #{searchCategory}
        </if>
        <choose>
            <when test='searchKeyWord != null and "T".equals(searchKeyWord)'>
                AND DI.DOC_TITLE REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "N".equals(searchKeyWord)'>
                AND DI.DOC_NO REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "DN".equals(searchKeyWord)'>
                AND DI.DRAFT_EMP_NAME REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "FN".equals(searchKeyWord)'>
                AND FORM.FORM_NAME REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "SE".equals(searchKeyWord)'>
                AND AAA.ORGAN LIKE REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "RE".equals(searchKeyWord)'>
                AND BBB.C_SIRECEIVENAME REGEXP #{searchContent}
            </when>
            <otherwise>
                AND (
                    DI.DOC_TITLE REGEXP #{searchContent} OR
                    DI.DOC_NO REGEXP #{searchContent} OR
                    DI.DRAFT_EMP_NAME REGEXP #{searchContent} OR
                    FORM.FORM_NAME REGEXP #{searchContent}
                )
            </otherwise>
        </choose>
        ORDER BY IFNULL(DI.LAST_APPROVE_DT, DI.DRAFT_DT) DESC
        /*ORDER BY IF(DI.DRAFT_DT IS NULL, DI.REG_DATE, IF(DI.REPTIT_DRFT_DT IS NULL, DI.DRAFT_DT, DI.REPTIT_DRFT_DT)) DESC*/
    </select>

    <select id="getApprovalDocSearchListLimitDept" resultType="map" parameterType="map">
        /* getApprovalDocSearchListLimitDept */
        SELECT
            DI.DOC_ID,
            DO.DOC_OPT_ID,
            DI.DOC_GBN_SN,
            DO.SECURITY_TYPE,
            DI.DOC_MENU_CD,
            DI.APPRO_KEY,
            FORM.FORM_NAME,
            FORM.LINKAGE_TYPE,
            DI.DOC_NO,
            DI.DOC_TITLE,
            DI.APPROVE_STAT_CODE,
            DI.DRAFT_EMP_NAME,
            DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
            DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE,
            DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS APPROVE_DT,
            (SELECT CM_CODE_NM FROM DJ_CAMTIC.V_COM_CODE CC WHERE CC.CM_GROUP_CODE_ID = 30 AND CC.CM_CODE = DO.DOC_GBN) AS DOC_GBN,
            DI.DOC_FLAG,
            DI.DEL_FLAG,
            AAA.ORGAN,
            BBB.C_SIRECEIVENAME
        FROM
            DJ_CAMTIC.A_DOC_INFO DI
        JOIN
            DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
            DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        LEFT JOIN (
            SELECT
                DOC_ID,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d')) AS READER_DAY,
                MIN(DATE_FORMAT(DRD.REG_DATE, '%H%i%s')) AS READER_TIME,
                ACTIVE AS ACTIVE,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%Y%m%d') = DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'), DATE_FORMAT(DRD.REG_DATE, '%Y%m%d'), DATE_FORMAT(DRD.MOD_DATE, '%Y%m%d'))) as RDDAY ,
                MIN(IF(DATE_FORMAT(DRD.REG_DATE, '%H%i%s') = DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'), DATE_FORMAT(DRD.REG_DATE, '%H%i%s'), DATE_FORMAT(DRD.MOD_DATE, '%H%i%s'))) as RDTIME
            FROM
                DJ_CAMTIC.A_DOC_READER DRD
            INNER JOIN (
                ${deptPathQuery}
            )OC
            ON OC.GBN_ORG = DRD.SEQ_TYPE AND OC.COMP_SEQ = '1000' AND OC.DEPT_SEQ = DRD.READER_DEPT_SEQ AND OC.EMP_SEQ = DRD.READER_EMP_SEQ
            WHERE 1=1
            <![CDATA[
                AND
                    DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(DRD.READING_START_DT, '%Y%m%d')
                AND
                    DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(DRD.READING_END_DT, '%Y%m%d')
            ]]>
            GROUP BY DOC_ID
        )DRD
        ON DI.DOC_ID = DRD.DOC_ID
        WHERE
            DI.ACTIVE = 'Y'
        AND
            DI.DRAFT_DEPT_SEQ NOT IN (SELECT dept.DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO dept WHERE dept.PATH LIKE CONCAT('%', '1204' ,'%'))
        AND
            DI.DRAFT_DEPT_SEQ NOT IN (SELECT dept.DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO dept WHERE dept.PATH LIKE CONCAT('%', '1236' ,'%'))
        <if test='deptSeq != null and !"".equals(deptSeq)'>
            AND
                DI.DRAFT_DEPT_SEQ IN (SELECT dept.DEPT_SEQ FROM CAM_HR.DJ_DEPT_INFO dept WHERE dept.PATH LIKE CONCAT('%', #{deptSeq} ,'%'))
        </if>
        AND (
            DI.APPROVE_STAT_CODE = 100 OR
            DI.APPROVE_STAT_CODE = 101
        )
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
            AND
                DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
            AND
                DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        ]]>
        </if>
        <if test='searchCategory != null and !"".equals(searchCategory)'>
            AND DOC_GBN_SN = #{searchCategory}
        </if>
        <choose>
            <when test='searchKeyWord != null and "T".equals(searchKeyWord)'>
                AND DI.DOC_TITLE REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "N".equals(searchKeyWord)'>
                AND DI.DOC_NO REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "DN".equals(searchKeyWord)'>
                AND DI.DRAFT_EMP_NAME REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "FN".equals(searchKeyWord)'>
                AND FORM.FORM_NAME REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "SE".equals(searchKeyWord)'>
                AND AAA.ORGAN REGEXP #{searchContent}
            </when>
            <when test='searchKeyWord != null and "RE".equals(searchKeyWord)'>
                AND BBB.C_SIRECEIVENAME REGEXP #{searchContent}
            </when>
            <otherwise>
                AND (
                    DI.DOC_TITLE REGEXP #{searchContent} OR
                    DI.DOC_NO REGEXP #{searchContent} OR
                    DI.DRAFT_EMP_NAME REGEXP #{searchContent} OR
                    FORM.FORM_NAME REGEXP #{searchContent} OR
                    AAA.ORGAN REGEXP #{searchContent} OR
                    BBB.C_SIRECEIVENAME REGEXP #{searchContent}
                )
            </otherwise>
        </choose>
        ORDER BY IF(DI.DRAFT_DT IS NULL, DI.REG_DATE, IF(DI.REPTIT_DRFT_DT IS NULL, DI.DRAFT_DT, DI.REPTIT_DRFT_DT)) DESC
    </select>

    <select id="getMainUserDocStorageBoxList" parameterType="map" resultType="map">
        /* getMainUserDocStorageBoxList */
        SELECT
        DI.DOC_ID,
        DO.SECURITY_TYPE,
        FORM.FORM_NAME,
        FORM.LINKAGE_TYPE,
        FORM.LINKAGE_PROCESS_ID,
        DI.DOC_MENU_CD,
        DI.APPRO_KEY,
        DI.DOC_NO,
        DI.DOC_TITLE,
        DI.APPROVE_STAT_CODE_DESC,
        DI.APPROVE_STAT_CODE,
        DI.REPTIT_DRFT_YN,
        DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
        DATE_FORMAT(DI.REPTIT_DRFT_DT,'%Y-%m-%d') AS REPTIT_DRFT_DT,
        DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS LAST_APPROVE_DT,
        DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE
        FROM
        DJ_CAMTIC.A_DOC_INFO DI
        JOIN
        DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
        DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND
                DI.APPROVE_STAT_CODE = 111
            </when>
            <when test='approveStat != null and "draft".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 10 OR
                DI.APPROVE_STAT_CODE = 20 OR
                DI.APPROVE_STAT_CODE = 50
                )
            </when>
            <when test='approveStat != null and "returnRetrieve".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 30 OR
                DI.APPROVE_STAT_CODE = 40
                )
            </when>
        </choose>
        AND
        DI.ACTIVE = 'Y'
        AND
        DI.DEL_FLAG = 'N'
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
        AND
            DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        AND
            DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
        ]]>
        </if>

        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                ORDER BY DI.REG_DATE DESC
            </when>
            <otherwise>
                ORDER BY IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT) DESC
            </otherwise>
        </choose>
    </select>

    <select id="getMainUserDocStorageBoxListMobile" parameterType="map" resultType="map">
        /* getMainUserDocStorageBoxListMobile */
        SELECT
        DI.DOC_ID,
        DO.SECURITY_TYPE,
        FORM.FORM_NAME,
        FORM.LINKAGE_TYPE,
        FORM.LINKAGE_PROCESS_ID,
        DI.DOC_MENU_CD,
        DI.APPRO_KEY,
        DI.DOC_NO,
        DI.DOC_TITLE,
        DI.APPROVE_STAT_CODE_DESC,
        DI.APPROVE_STAT_CODE,
        DI.REPTIT_DRFT_YN,
        DATE_FORMAT(DI.DRAFT_DT,'%Y-%m-%d') AS DRAFT_DT,
        DATE_FORMAT(DI.REPTIT_DRFT_DT,'%Y-%m-%d') AS REPTIT_DRFT_DT,
        DATE_FORMAT(DI.LAST_APPROVE_DT,'%Y-%m-%d') AS LAST_APPROVE_DT,
        DATE_FORMAT(DI.REG_DATE, '%Y-%m-%d') AS REG_DATE
        FROM
        DJ_CAMTIC.A_DOC_INFO DI
        JOIN
        DJ_CAMTIC.A_DOC_OPT DO
        ON DI.DOC_ID = DO.DOC_ID
        JOIN
        DJ_CAMTIC.A_FORM FORM
        ON DI.FORM_ID = FORM.FORM_ID
        WHERE 1=1
        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND
                DI.APPROVE_STAT_CODE = 111
            </when>
            <when test='approveStat != null and "draft".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 10 OR
                DI.APPROVE_STAT_CODE = 20 OR
                DI.APPROVE_STAT_CODE = 50
                )
            </when>
            <when test='approveStat != null and "returnRetrieve".equals(approveStat)'>
                AND
                DI.DRAFT_EMP_SEQ = #{empSeq}
                AND (
                DI.APPROVE_STAT_CODE = 30 OR
                DI.APPROVE_STAT_CODE = 40
                )
            </when>
        </choose>
        AND
        DI.ACTIVE = 'Y'
        AND
        DI.DEL_FLAG = 'N'
        <if test='mTitle != null and !"".equals(mTitle)'>
            AND
                DI.DOC_TITLE LIKE CONCAT('%', #{mTitle}, '%')
        </if>
        <if test='startDay != null and !"".equals(startDay)'>
            <![CDATA[
                AND
                    DATE_FORMAT(#{startDay}, '%Y%m%d') <= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
                AND
                    DATE_FORMAT(#{endDay}, '%Y%m%d') >= DATE_FORMAT(DI.REG_DATE, '%Y%m%d')
            ]]>
        </if>

        <choose>
            <when test='approveStat != null and "temp".equals(approveStat)'>
                ORDER BY DI.REG_DATE DESC
            </when>
            <otherwise>
                ORDER BY IFNULL(DI.REPTIT_DRFT_DT, DI.DRAFT_DT) DESC
            </otherwise>
        </choose>
        LIMIT #{startPage}, 5
    </select>

    <!-- 부재설정 -->
    <!-- 부재 설정 -->
    <select id="getAbsentSetList" parameterType="map" resultType="map">
        /* getAbsentSetList */
        SELECT
            AA.C_UIUSERKEY AS C_UIUSERKEY,
            AA.C_AISTATUS AS C_AISTATUS,
            AA.C_AISEQNUM AS C_AISEQNUM,
            AA.C_CIKEYCODE AS C_CIKEYCODE,
            (SELECT CM_CODE_NM FROM CAM_COMMON.DJ_COM_CODE WHERE CM_CODE = AA.C_CIKEYCODE AND CM_GROUP_CODE_ID = 23) AS C_CIKEYNM,
            AA.C_OIORGCODE AS C_OIORGCODE,
            AA.C_AIMEMO AS C_AIMEMO,
            AA.C_AIFLAG AS C_AIFLAG,
            DATE_FORMAT(AA.C_AISDAY, '%Y-%m-%d') AS C_AISDAY,
            AA.C_AISTIME AS C_AISTIME,
            DATE_FORMAT(AA.C_AIEDAY, '%Y-%m-%d') AS C_AIEDAY,
            AA.C_AIETIME AS C_AIETIME,
            AA.C_MDAY AS C_MDAY,
            AA.C_MTIME AS C_MTIME,
            AA.C_OIORGCODE AS DEPT_SEQ,
            AA.DEPT_NAME,
            AA.C_UIUSERKEY AS EMP_SEQ,
            AA.EMP_NAME_KR AS EMP_NAME,
            AA.LOGIN_ID AS LOGIN_ID,
            CONCAT(AA.EMP_NAME_KR,'(', AA.LOGIN_ID, ')') AS USERINFO,
            AA.DUTY_NAME AS DUTY_NM,
            AA.POSITION_NAME AS POSITION_NM,
            IFNULL(C_AIALIM, '0') AS C_AIALIM,
            <!-- 	    대결자 정보 -->
            AA.C_VIORGCODE AS C_VIORGCODE,
            AA.C_VIORGNAME,
            AA.C_VIUSERKEY AS C_VIUSERKEY,
            AA.C_VIUSERID AS C_VIUSERID,
            AA.C_VIUSERNAME,
            CONCAT(AA.C_VIUSERNAME,'(', AA.C_VIUSERID, ')') AS C_VIUSERINFO,
            AA.C_VIAUTHORITY AS C_VIAUTHORITY,
            AA.VIDUTY_NM,
            AA.VIPOSITION_NM,
            AA.C_VICOMPSEQ,
            AA.C_VIGROUPSEQ,
            <!-- 	    수정자 정보 -->
            AA.C_MODIFYUSERKEY AS C_MODIFYUSERKEY,
            AA.C_MODIFYDEPTKEY AS C_MODIFYDEPTKEY,
            CONCAT((SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE emp_seq = AA.C_MODIFYUSERKEY),  '(', (SELECT login_id FROM CAM_HR.DJ_EMP_INFO WHERE emp_seq = AA.C_MODIFYUSERKEY), ')') AS C_MODIFYUSERNAME
        FROM (
        SELECT
            A.*,
            e.EMP_NAME_KR,
            IFNULL(e.DEPT_TEAM_NAME, e.DEPT_NAME) AS DEPT_NAME,
            e.login_id,
            e.DUTY_NAME,
            e.duty_code,
            e.POSITION_NAME,
            e.position_code,
            B.C_VIORGCODE,
            IFNULL(ve.DEPT_TEAM_NAME, ve.DEPT_NAME) AS C_VIORGNAME,
            B.C_VIUSERKEY,
            ve.EMP_NAME_KR AS C_VIUSERNAME,
            B.C_VIAUTHORITY,
            ve.login_id AS C_VIUSERID,
            ve.duty_code AS VI_duty_code,
            ve.DUTY_NAME AS VIDUTY_NM,
            ve.position_code AS VI_position_code,
            ve.POSITION_NAME AS VIPOSITION_NM,
            B.c_dutycode AS C_VIdutycode,
            B.c_positioncode AS C_VIpositioncode,
            B.C_COMPSEQ AS C_VICOMPSEQ,
            B.C_GROUPSEQ AS C_VIGROUPSEQ
        FROM
            DJ_CAMTIC.A_ABSENTINFO A
        <!-- 	    부재자 정보 -->
        INNER JOIN
            CAM_HR.DJ_EMP_INFO e
        ON A.C_UIUSERKEY = E.emp_seq <!-- AND e.use_yn = 'Y'   -->
        LEFT OUTER JOIN
            DJ_CAMTIC.A_VICARIOUSINFO B
        ON A.C_OIORGCODE = B.C_OIORGCODE AND A.C_UIUSERKEY = B.C_UIUSERKEY AND A.C_AISEQNUM = B.C_AISEQNUM
        LEFT OUTER JOIN
            CAM_HR.DJ_EMP_INFO ve
        ON B.C_VIUSERKEY = ve.emp_seq <!-- AND ve.use_yn = 'Y'  -->
        LEFT OUTER JOIN
            DJ_CAMTIC.A_ABSENTINFO A1
        ON A.C_AISDAY = A1.C_AISDAY AND DATE_FORMAT(A1.C_AIEDAY, '%Y-%m-%d') &lt; DATE_FORMAT(#{aisday}, '%Y-%m-%d')
        LEFT OUTER JOIN
            DJ_CAMTIC.A_ABSENTINFO A2
        ON A.C_AIEDAY = A2.C_AIEDAY AND DATE_FORMAT(A2.C_AISDAY, '%Y-%m-%d') &gt; DATE_FORMAT(#{aieday}, '%Y-%m-%d')
        WHERE 1=1
        AND
            (A.C_AISTATUS != 'd' OR A.C_AISTATUS IS NULL)
        AND
            A.C_AISDAY IS NOT NULL
        AND
            A.C_AIEDAY IS NOT NULL
        AND
            A1.C_AISDAY IS NULL
        AND
            A2.C_AIEDAY IS NULL
        <if test="userSe == 'USER'">
            AND
                IFNULL(A.C_compseq, ed.comp_seq) = #{loginVO.organId}
            AND
            (
                (A.C_UIUSERKEY = #{loginVO.uniqId} AND A.C_OIORGCODE =  #{loginVO.orgnztId} ) OR
                (B.C_VIUSERKEY = #{loginVO.uniqId} AND B.C_VIORGCODE =  #{loginVO.orgnztId} )
            )
        </if>
        <if test="absenceSeq != null and absenceSeq != ''">
            AND
                A.C_UIUSERKEY =  #{absenceSeq}
        </if>


        <if test="deptSeq != null and deptSeq != ''">
            AND
                A.C_OIORGCODE =  #{deptSeq}
        </if>

        <if test='deptComp != null and !"".equals(deptComp)'>
            AND
                e.DEPT_SEQ = #{deptComp}
            <if test='deptTeam == deptTeam or "".equals(deptTeam)'>
                OR
                e.DEPT_SEQ IN (
                    SELECT
                        DEPT_SEQ
                    FROM
                        CAM_HR.DJ_DEPT_INFO
                    WHERE
                        DEPT_SEQ = #{deptComp}
                    OR
                        PARENT_DEPT_SEQ = #{deptComp}
                )
            </if>
        </if>

        <if test="absentSeq != null and absentSeq != ''">     <!-- 대결자 -->
            AND
                B.C_VIUSERKEY =  #{absentSeq}
        </if>
        <if test="viDeptSeq != null and viDeptSeq != ''">
            AND
                B.C_VIORGCODE =  #{viDeptSeq}
        </if>
        <if test="modifySeq != null and modifySeq != ''">
            AND
                A.C_MODIFYUSERKEY =  #{modifySeq}
        </if>
        <if test="absenceCode != null and absenceCode != ''">   <!-- 부재사유 -->
            AND
                A.C_CIKEYCODE =  #{absenceCode}
        </if>
        <if test="absentCode != null and absentCode != ''">    <!-- 부재상태 -->
            <if test="absentCode == 1">
                AND A.C_AISTATUS = '1'
            </if>
            <if test="absentCode == 2">
                AND A.C_AISTATUS = '2'
            </if>
            <if test="absentCode == 3">
                AND A.C_AISTATUS IS NULL
                AND A.C_AIFLAG = '0'
            </if>
            <if test="absentCode == 4">
                AND A.C_AISTATUS IS NULL
                AND A.C_AIFLAG = '1'
            </if>
        </if>
        ) AA
        ORDER BY CONCAT(AA.C_AISDAY , AA.C_AISTIME, AA.C_AIEDAY , AA.C_AIETIME, AA.C_AISEQNUM) DESC
    </select>

    <select id="getMaxAiSeqNum" parameterType="map" resultType="String">
        /* getMaxAiSeqNum */
        SELECT
            LPAD(CAST(IFNULL(C_AISEQNUM,0) AS UNSIGNED)  + 1 ,'10', '0')
        FROM (
            SELECT
                CASE WHEN MAX(AI.C_AISEQNUM) &gt;= MAX(VI.C_AISEQNUM) THEN MAX(AI.C_AISEQNUM)
                     ELSE MAX(VI.C_AISEQNUM) END AS C_AISEQNUM
            FROM
                DJ_CAMTIC.A_ABSENTINFO AI
            INNER JOIN
                DJ_CAMTIC.A_VICARIOUSINFO VI
            ON AI.C_UIUSERKEY = VI.C_UIUSERKEY AND AI.C_OIORGCODE = VI.C_OIORGCODE
            WHERE
                AI.c_uiuserkey = #{c_uiuserkey}
            AND
                AI.c_oiorgcode = #{c_oiorgcode}
        ) A
    </select>

    <insert id="setAbsentInfo" parameterType="map">
        /* setAbsentInfo */
        INSERT INTO DJ_CAMTIC.A_ABSENTINFO
        (
            C_OIORGCODE,
            C_UIUSERKEY,
            C_AISEQNUM,
            C_CIKEYCODE,
            C_AISDAY,
            C_AISTIME,
            C_AIEDAY,
            C_AIETIME,
            C_AIMEMO,
            C_AISTATUS,
            C_AIFLAG,
            <if test="c_aiflag == 1">
                C_MDAY,
                C_MTIME,
            </if>
            C_MODIFYUSERKEY,
            C_MODIFYDEPTKEY,
            C_AIALIM,
            C_DUTYCODE,
            C_POSITIONCODE
        )
        SELECT
            #{c_oiorgcode},
            #{c_uiuserkey},
            #{c_aiseqnum},
            #{c_cikeycode},
            #{c_aisday},
            #{c_aistime},
            #{c_aieday},
            #{c_aietime},
            <if test="c_aimemo == null or c_aimemo == ''">
                '',
            </if>
            <if test="c_aimemo != null and c_aimemo != ''">
                #{c_aimemo},
            </if>
            CASE WHEN DATE_FORMAT(NOW(), '%Y-%m-%d') &gt; #{c_aieday} THEN NULL
            ELSE #{c_aistatus} END,
            #{c_aiflag},
            <if test="c_aiflag == 1">
                #{c_mday},
                #{c_mtime},
            </if>
            #{loginVO.uniqId},
            #{loginVO.orgnztId},
            #{c_aialim},
            DUTY_CODE,
            POSITION_CODE
        FROM
            CAM_HR.DJ_EMP_INFO A
        WHERE
            EMP_SEQ = #{c_uiuserkey}
        AND
            DEPT_SEQ = #{c_oiorgcode}
    </insert>

    <update id="setAbsentInfoUpd" parameterType="map">
        /* setAbsentInfoUpd */
        UPDATE
            DJ_CAMTIC.A_ABSENTINFO
        SET
            <if test="c_aistatus == &quot;d&quot;">
                C_AISTATUS      = #{c_aistatus},
            </if>
            <if test="c_aistatus != &quot;d&quot;">
                C_CIKEYCODE     = #{c_cikeycode},
                C_AISDAY        = #{c_aisday},
                C_AISTIME       = #{c_aistime},
                C_AIEDAY        = #{c_aieday},
                C_AIETIME       = #{c_aietime},
                C_AIMEMO        = #{c_aimemo},
                C_AISTATUS      = #{c_aistatus},
                C_AIFLAG        = #{c_aiflag},
                C_AIALIM        = #{c_aialim},
                <if test="c_aiflag == 1">
                    C_MDAY          = DATE_FORMAT(NOW(), '%Y-%m-%d'),
                    C_MTIME         = DATE_FORMAT(NOW(), '%H:%i'),
                </if>
            </if>
            C_MODIFYUSERKEY = #{loginVO.uniqId},
            C_MODIFYDEPTKEY = #{loginVO.orgnztId}
        WHERE
            C_UIUSERKEY = #{c_uiuserkey}
        AND
            C_OIORGCODE = #{c_oiorgcode}
        AND
            C_AISEQNUM = #{c_aiseqnum}
    </update>

    <insert id="setVicariousInfo" parameterType="map">
        /* setVicariousInfo */
        INSERT INTO DJ_CAMTIC.A_VICARIOUSINFO
        (
            C_OIORGCODE,
            C_UIUSERKEY,
            C_AISEQNUM,
            C_VISEQNUM,
            C_VIORGCODE,
            C_VIUSERKEY,
            C_VIAUTHORITY,
            C_DUTYCODE,
            C_POSITIONCODE
        )
        SELECT
            #{c_oiorgcode},
            #{c_uiuserkey},
            #{c_aiseqnum},
            #{c_viseqnum},
            #{c_viorgcode},
            #{c_viuserkey},
            #{c_viauthority},
            DUTY_CODE,
            POSITION_CODE
        FROM
            CAM_HR.DJ_EMP_INFO A
        WHERE
            EMP_SEQ = #{c_viuserkey}
        AND
            DEPT_SEQ = #{c_viorgcode}
    </insert>

    <update id="setVicariousInfoUpd" parameterType="map">
        /* setVicariousInfoUpd */
        UPDATE
            DJ_CAMTIC.A_VICARIOUSINFO
        SET
            C_OIORGCODE    = #{c_oiorgcode},
            C_UIUSERKEY    = #{c_uiuserkey},
            C_VIORGCODE    = #{c_viorgcode},
            C_VIUSERKEY    = #{c_viuserkey},
            C_VIAUTHORITY  = #{c_viauthority},
            C_DUTYCODE     = (SELECT DUTY_CODE FROM CAM_HR.DJ_EMP_INFO A WHERE EMP_SEQ = #{c_viuserkey} AND DEPT_SEQ = #{c_viorgcode}),
            C_POSITIONCODE = (SELECT POSITION_CODE FROM CAM_HR.DJ_EMP_INFO A WHERE EMP_SEQ = #{c_viuserkey} AND DEPT_SEQ = #{c_viorgcode})
        WHERE
            C_UIUSERKEY = #{c_uiuserkey}
        AND
            C_OIORGCODE = #{c_oiorgcode}
        AND
            C_AISEQNUM = #{c_aiseqnum}
        AND
            C_VIAUTHORITY = #{c_viauthority}
    </update>

    <select id="getOrgPullPath" parameterType="map" resultType="String">
        /* getOrgPullPath */
        SELECT
            if(PARENT_DI.DEPT_NAME IS NULL, DI.DEPT_NAME, CONCAT(PARENT_DI.DEPT_NAME, ' ', DI.DEPT_NAME))
        FROM
            CAM_HR.DJ_DEPT_INFO DI
        LEFT JOIN
            CAM_HR.DJ_DEPT_INFO PARENT_DI
        on DI.PARENT_DEPT_SEQ = PARENT_DI.DEPT_SEQ
        WHERE
            DI.DEPT_SEQ = #{c_oiorgcode}
    </select>

    <select id="getAbsentDuplicate" parameterType="map" resultType="map">
        /* getAbsentDuplicate */
        SELECT
            AA.C_UIUSERKEY,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = VI.C_VIUSERKEY) AS EMP_NAME,
            DATE_FORMAT(CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME), '%Y-%m-%d %H:%i') AS C_AISDAY,
            DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') AS C_AIEDAY,
            (SELECT CM_CODE_NM FROM CAM_COMMON.DJ_COM_CODE WHERE CM_GROUP_CODE_ID = 23 AND CM_CODE = C_CIKEYCODE) AS C_CIKEYNM
        FROM
            DJ_CAMTIC.A_ABSENTINFO AA, DJ_CAMTIC.A_VICARIOUSINFO VI
        WHERE
            AA.C_UIUSERKEY = VI.C_UIUSERKEY
        AND
            AA.C_OIORGCODE = VI.C_OIORGCODE
        AND
            AA.C_AISEQNUM = VI.C_AISEQNUM
        AND
            AA.C_UIUSERKEY =  #{c_uiuserkey}
        AND
            AA.C_OIORGCODE = #{c_oiorgcode}
        AND (
                (
                    DATE_FORMAT(CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME), '%Y-%m-%d %H:%i') BETWEEN
                        DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aisday}, '%Y-%m-%d'), ' ', #{c_aistime}), '%Y-%m-%d %H:%i') AND
                        DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aieday}, '%Y-%m-%d'), ' ', #{c_aietime}), '%Y-%m-%d %H:%i') OR
                    DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') BETWEEN
                        DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aisday}, '%Y-%m-%d'), ' ', #{c_aistime}), '%Y-%m-%d %H:%i') AND
                        DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aieday}, '%Y-%m-%d'), ' ', #{c_aietime}), '%Y-%m-%d %H:%i')
                ) OR
                DATE_FORMAT(CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME), '%Y-%m-%d %H:%i') &lt; DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aisday}, '%Y-%m-%d'), ' ', #{c_aistime}), '%Y-%m-%d %H:%i')
                    AND
                DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') &gt; DATE_FORMAT(CONCAT(DATE_FORMAT(#{c_aieday}, '%Y-%m-%d'), ' ', #{c_aietime}), '%Y-%m-%d %H:%i')
        )
        AND AA.C_AISTATUS IN ('1', '2')
    </select>

    <update id="setAbsentStartUpd">
        /* setAbsentStartUpd */
        UPDATE
            DJ_CAMTIC.A_ABSENTINFO
        SET
            C_AISTATUS = '1',
            C_MDAY = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            C_MTIME = DATE_FORMAT(NOW(), '%H:%i')
        WHERE
            DATE_FORMAT(CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME), '%Y-%m-%d %H:%i') &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
        AND
            DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') &gt; DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
        AND
            C_AISTATUS = '2'
        AND
            C_AIFLAG = '0'
    </update>

    <update id="setAbsentEndUpd">
        /*setAbsentEndUpd */
        UPDATE
            DJ_CAMTIC.A_ABSENTINFO
        SET
            C_AISTATUS = NULL,
            C_MDAY = DATE_FORMAT(NOW(), '%Y-%m-%d'),
            C_MTIME = DATE_FORMAT(NOW(), '%H:%i')
        WHERE
            DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
        AND
            C_AISTATUS IN ('1', '2')
        AND
            C_AIFLAG = '0'
    </update>

    <select id="getAbsentUpdateList" resultType="map">
        /* getAbsentUpdateList */
        SELECT
            B.C_GROUPSEQ AS groupSeq,
            B.C_COMPSEQ AS compSeq,
            C_VIORGCODE AS deptSeq,
            C_VIUSERKEY AS empSeq,
            C_AIALIM,
            B.C_UIUSERKEY AS sdEmpSeq,
            (SELECT EMP_NAME_KR FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = B.C_UIUSERKEY) AS SND_EMP_NM,
            B.C_OIORGCODE AS SND_DEPT_SEQ,
            (SELECT IFNULL(DEPT_TEAM_NAME, DEPT_NAME) FROM CAM_HR.DJ_EMP_INFO WHERE EMP_SEQ = B.C_UIUSERKEY) AS SND_DEPT_NM,
            CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME, ' ~ ', DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME) AS ABSENT_DT
        FROM (
            SELECT
                *
            FROM
                DJ_CAMTIC.A_ABSENTINFO
            WHERE
                DATE_FORMAT(CONCAT(DATE_FORMAT(C_AISDAY, '%Y-%m-%d'), ' ', C_AISTIME), '%Y-%m-%d %H:%i') &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
            AND
                DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') &gt; DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
            AND
                C_AISTATUS = '2'
            AND
                C_AIFLAG = '0'
            UNION
            SELECT
                *
            FROM
                DJ_CAMTIC.A_ABSENTINFO
            WHERE
                DATE_FORMAT(CONCAT(DATE_FORMAT(C_AIEDAY, '%Y-%m-%d'), ' ', C_AIETIME), '%Y-%m-%d %H:%i') &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i')
            AND
                C_AISTATUS IN ('1', '2')
            AND
                C_AIFLAG = '0'
            ) A
        INNER JOIN
             DJ_CAMTIC.A_VICARIOUSINFO B
        ON A.C_OIORGCODE = B.C_OIORGCODE AND A.C_UIUSERKEY = B.C_UIUSERKEY AND A.C_AISEQNUM = B.C_AISEQNUM
    </select>
</mapper>